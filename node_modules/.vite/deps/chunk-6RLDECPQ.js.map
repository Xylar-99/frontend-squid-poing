{
  "version": 3,
  "sources": ["../../../dev/core/src/Materials/materialDefines.ts"],
  "sourcesContent": ["/**\r\n * Manages the defines for the Material\r\n */\r\nexport class MaterialDefines {\r\n    /** @internal */\r\n    protected _keys: string[] = [];\r\n    private _isDirty = true;\r\n    /** @internal */\r\n    public _renderId: number;\r\n\r\n    /** @internal */\r\n    public _areLightsDirty = true;\r\n    /** @internal */\r\n    public _areLightsDisposed = false;\r\n    /** @internal */\r\n    public _areAttributesDirty = true;\r\n    /** @internal */\r\n    public _areTexturesDirty = true;\r\n    /** @internal */\r\n    public _areFresnelDirty = true;\r\n    /** @internal */\r\n    public _areMiscDirty = true;\r\n    /** @internal */\r\n    public _arePrePassDirty = true;\r\n    /** @internal */\r\n    public _areImageProcessingDirty = true;\r\n\r\n    /** @internal */\r\n    public _normals = false;\r\n    /** @internal */\r\n    public _uvs = false;\r\n\r\n    /** @internal */\r\n    public _needNormals = false;\r\n    /** @internal */\r\n    public _needUVs = false;\r\n\r\n    protected _externalProperties?: { [name: string]: { type: string; default: any } };\r\n\r\n    [id: string]: any;\r\n\r\n    /**\r\n     * Creates a new instance\r\n     * @param externalProperties list of external properties to inject into the object\r\n     */\r\n    constructor(externalProperties?: { [name: string]: { type: string; default: any } }) {\r\n        this._externalProperties = externalProperties;\r\n\r\n        // Initialize External Properties\r\n        if (externalProperties) {\r\n            for (const prop in externalProperties) {\r\n                if (Object.prototype.hasOwnProperty.call(externalProperties, prop)) {\r\n                    this._setDefaultValue(prop);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Specifies if the material needs to be re-calculated\r\n     */\r\n    public get isDirty(): boolean {\r\n        return this._isDirty;\r\n    }\r\n\r\n    /**\r\n     * Marks the material to indicate that it has been re-calculated\r\n     */\r\n    public markAsProcessed() {\r\n        this._isDirty = false;\r\n        this._areAttributesDirty = false;\r\n        this._areTexturesDirty = false;\r\n        this._areFresnelDirty = false;\r\n        this._areLightsDirty = false;\r\n        this._areLightsDisposed = false;\r\n        this._areMiscDirty = false;\r\n        this._arePrePassDirty = false;\r\n        this._areImageProcessingDirty = false;\r\n    }\r\n\r\n    /**\r\n     * Marks the material to indicate that it needs to be re-calculated\r\n     */\r\n    public markAsUnprocessed() {\r\n        this._isDirty = true;\r\n    }\r\n\r\n    /**\r\n     * Marks the material to indicate all of its defines need to be re-calculated\r\n     */\r\n    public markAllAsDirty() {\r\n        this._areTexturesDirty = true;\r\n        this._areAttributesDirty = true;\r\n        this._areLightsDirty = true;\r\n        this._areFresnelDirty = true;\r\n        this._areMiscDirty = true;\r\n        this._arePrePassDirty = true;\r\n        this._areImageProcessingDirty = true;\r\n        this._isDirty = true;\r\n    }\r\n\r\n    /**\r\n     * Marks the material to indicate that image processing needs to be re-calculated\r\n     */\r\n    public markAsImageProcessingDirty() {\r\n        this._areImageProcessingDirty = true;\r\n        this._isDirty = true;\r\n    }\r\n\r\n    /**\r\n     * Marks the material to indicate the lights need to be re-calculated\r\n     * @param disposed Defines whether the light is dirty due to dispose or not\r\n     */\r\n    public markAsLightDirty(disposed = false) {\r\n        this._areLightsDirty = true;\r\n        this._areLightsDisposed = this._areLightsDisposed || disposed;\r\n        this._isDirty = true;\r\n    }\r\n\r\n    /**\r\n     * Marks the attribute state as changed\r\n     */\r\n    public markAsAttributesDirty() {\r\n        this._areAttributesDirty = true;\r\n        this._isDirty = true;\r\n    }\r\n\r\n    /**\r\n     * Marks the texture state as changed\r\n     */\r\n    public markAsTexturesDirty() {\r\n        this._areTexturesDirty = true;\r\n        this._isDirty = true;\r\n    }\r\n\r\n    /**\r\n     * Marks the fresnel state as changed\r\n     */\r\n    public markAsFresnelDirty() {\r\n        this._areFresnelDirty = true;\r\n        this._isDirty = true;\r\n    }\r\n\r\n    /**\r\n     * Marks the misc state as changed\r\n     */\r\n    public markAsMiscDirty() {\r\n        this._areMiscDirty = true;\r\n        this._isDirty = true;\r\n    }\r\n\r\n    /**\r\n     * Marks the prepass state as changed\r\n     */\r\n    public markAsPrePassDirty() {\r\n        this._arePrePassDirty = true;\r\n        this._isDirty = true;\r\n    }\r\n\r\n    /**\r\n     * Rebuilds the material defines\r\n     */\r\n    public rebuild() {\r\n        this._keys.length = 0;\r\n\r\n        for (const key of Object.keys(this)) {\r\n            if (key[0] === \"_\") {\r\n                continue;\r\n            }\r\n\r\n            this._keys.push(key);\r\n        }\r\n\r\n        if (this._externalProperties) {\r\n            for (const name in this._externalProperties) {\r\n                if (this._keys.indexOf(name) === -1) {\r\n                    this._keys.push(name);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Specifies if two material defines are equal\r\n     * @param other - A material define instance to compare to\r\n     * @returns - Boolean indicating if the material defines are equal (true) or not (false)\r\n     */\r\n    public isEqual(other: MaterialDefines): boolean {\r\n        if (this._keys.length !== other._keys.length) {\r\n            return false;\r\n        }\r\n\r\n        for (let index = 0; index < this._keys.length; index++) {\r\n            const prop = this._keys[index];\r\n\r\n            if ((<any>this)[prop] !== (<any>other)[prop]) {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Clones this instance's defines to another instance\r\n     * @param other - material defines to clone values to\r\n     */\r\n    public cloneTo(other: MaterialDefines): void {\r\n        if (this._keys.length !== other._keys.length) {\r\n            other._keys = this._keys.slice(0);\r\n        }\r\n\r\n        for (let index = 0; index < this._keys.length; index++) {\r\n            const prop = this._keys[index];\r\n\r\n            (<any>other)[prop] = (<any>this)[prop];\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Resets the material define values\r\n     */\r\n    public reset(): void {\r\n        this._keys.forEach((prop) => this._setDefaultValue(prop));\r\n    }\r\n\r\n    private _setDefaultValue(prop: string): void {\r\n        const type = this._externalProperties?.[prop]?.type ?? typeof (<any>this)[prop];\r\n        const defValue = this._externalProperties?.[prop]?.default;\r\n\r\n        switch (type) {\r\n            case \"number\":\r\n                (<any>this)[prop] = defValue ?? 0;\r\n                break;\r\n            case \"string\":\r\n                (<any>this)[prop] = defValue ?? \"\";\r\n                break;\r\n            default:\r\n                (<any>this)[prop] = defValue ?? false;\r\n                break;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Converts the material define values to a string\r\n     * @returns - String of material define information\r\n     */\r\n    public toString(): string {\r\n        let result = \"\";\r\n        for (let index = 0; index < this._keys.length; index++) {\r\n            const prop = this._keys[index];\r\n            const value = (<any>this)[prop];\r\n            const type = typeof value;\r\n\r\n            switch (type) {\r\n                case \"number\":\r\n                case \"string\":\r\n                    result += \"#define \" + prop + \" \" + value + \"\\n\";\r\n                    break;\r\n                default:\r\n                    if (value) {\r\n                        result += \"#define \" + prop + \"\\n\";\r\n                    }\r\n                    break;\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }\r\n}\r\n"],
  "mappings": "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",
  "names": []
}
