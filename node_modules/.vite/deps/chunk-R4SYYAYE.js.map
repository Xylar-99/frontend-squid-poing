{
  "version": 3,
  "sources": ["../../../dev/core/src/Materials/drawWrapper.functions.ts", "../../../dev/core/src/Engines/WebGL/webGLShaderProcessors.ts", "../../../dev/core/src/Engines/WebGL/webGL2ShaderProcessors.ts", "../../../dev/core/src/Meshes/WebGL/webGLDataBuffer.ts", "../../../dev/core/src/Engines/WebGL/webGLHardwareTexture.ts", "../../../dev/core/src/Materials/Textures/textureHelper.functions.ts", "../../../dev/core/src/Engines/thinEngine.ts"],
  "sourcesContent": ["import type { DrawWrapper } from \"./drawWrapper\";\r\nimport type { Effect } from \"./effect\";\r\n\r\n/**\r\n * Detect if the effect is a DrawWrapper\r\n * @param effect defines the entity to test\r\n * @returns if the entity is a DrawWrapper\r\n */\r\nexport function IsWrapper(effect: Effect | DrawWrapper): effect is DrawWrapper {\r\n    return (effect as Effect).getPipelineContext === undefined;\r\n}\r\n", "import { ShaderLanguage } from \"../../Materials/shaderLanguage\";\r\nimport type { Nullable } from \"../../types\";\r\nimport type { IShaderProcessor } from \"../Processors/iShaderProcessor\";\r\nimport type { ShaderProcessingContext } from \"../Processors/shaderProcessingOptions\";\r\n\r\n/** @internal */\r\nexport class WebGLShaderProcessor implements IShaderProcessor {\r\n    public shaderLanguage = ShaderLanguage.GLSL;\r\n\r\n    public postProcessor(\r\n        code: string,\r\n        defines: string[],\r\n        isFragment: boolean,\r\n        processingContext: Nullable<ShaderProcessingContext>,\r\n        parameters: { [key: string]: number | string | boolean | undefined }\r\n    ) {\r\n        // Remove extensions\r\n        if (parameters.drawBuffersExtensionDisabled) {\r\n            // even if enclosed in #if/#endif, IE11 does parse the #extension declaration, so we need to remove it altogether\r\n            const regex = /#extension.+GL_EXT_draw_buffers.+(enable|require)/g;\r\n            code = code.replace(regex, \"\");\r\n        }\r\n\r\n        return code;\r\n    }\r\n}\r\n", "import { ShaderLanguage } from \"../../Materials/shaderLanguage\";\r\nimport type { IShaderProcessor } from \"../Processors/iShaderProcessor\";\r\n\r\nconst varyingRegex = /(flat\\s)?\\s*varying\\s*.*/;\r\n\r\n/** @internal */\r\nexport class WebGL2ShaderProcessor implements IShaderProcessor {\r\n    public shaderLanguage = ShaderLanguage.GLSL;\r\n\r\n    public attributeProcessor(attribute: string) {\r\n        return attribute.replace(\"attribute\", \"in\");\r\n    }\r\n\r\n    public varyingCheck(varying: string, _isFragment: boolean) {\r\n        return varyingRegex.test(varying);\r\n    }\r\n\r\n    public varyingProcessor(varying: string, isFragment: boolean) {\r\n        return varying.replace(\"varying\", isFragment ? \"in\" : \"out\");\r\n    }\r\n\r\n    public postProcessor(code: string, defines: string[], isFragment: boolean) {\r\n        const hasDrawBuffersExtension = code.search(/#extension.+GL_EXT_draw_buffers.+require/) !== -1;\r\n\r\n        // Remove extensions\r\n        const regex = /#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g;\r\n        code = code.replace(regex, \"\");\r\n\r\n        // Replace instructions\r\n        code = code.replace(/texture2D\\s*\\(/g, \"texture(\");\r\n        if (isFragment) {\r\n            const hasOutput = code.search(/layout *\\(location *= *0\\) *out/g) !== -1;\r\n\r\n            code = code.replace(/texture2DLodEXT\\s*\\(/g, \"textureLod(\");\r\n            code = code.replace(/textureCubeLodEXT\\s*\\(/g, \"textureLod(\");\r\n            code = code.replace(/textureCube\\s*\\(/g, \"texture(\");\r\n            code = code.replace(/gl_FragDepthEXT/g, \"gl_FragDepth\");\r\n            code = code.replace(/gl_FragColor/g, \"glFragColor\");\r\n            code = code.replace(/gl_FragData/g, \"glFragData\");\r\n            code = code.replace(/void\\s+?main\\s*\\(/g, (hasDrawBuffersExtension || hasOutput ? \"\" : \"layout(location = 0) out vec4 glFragColor;\\n\") + \"void main(\");\r\n        } else {\r\n            const hasMultiviewExtension = defines.indexOf(\"#define MULTIVIEW\") !== -1;\r\n            if (hasMultiviewExtension) {\r\n                return \"#extension GL_OVR_multiview2 : require\\nlayout (num_views = 2) in;\\n\" + code;\r\n            }\r\n        }\r\n\r\n        return code;\r\n    }\r\n}\r\n", "import { DataBuffer } from \"../../Buffers/dataBuffer\";\r\nimport type { Nullable } from \"../../types\";\r\n\r\n/** @internal */\r\nexport class WebGLDataBuffer extends DataBuffer {\r\n    private _buffer: Nullable<WebGLBuffer>;\r\n\r\n    public constructor(resource: WebGLBuffer) {\r\n        super();\r\n        this._buffer = resource;\r\n    }\r\n\r\n    public override get underlyingResource(): any {\r\n        return this._buffer;\r\n    }\r\n}\r\n", "import type { HardwareTextureWrapper } from \"../../Materials/Textures/hardwareTextureWrapper\";\r\nimport type { Nullable } from \"../../types\";\r\n\r\n/** @internal */\r\nexport class WebGLHardwareTexture implements HardwareTextureWrapper {\r\n    private _webGLTexture: WebGLTexture;\r\n    private _context: WebGLRenderingContext;\r\n\r\n    // There can be multiple buffers for a single WebGL texture because different layers of a 2DArrayTexture / 3DTexture\r\n    // or different faces of a cube texture can be bound to different render targets at the same time.\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    private _MSAARenderBuffers: Nullable<WebGLRenderbuffer[]> = null;\r\n\r\n    public get underlyingResource(): Nullable<WebGLTexture> {\r\n        return this._webGLTexture;\r\n    }\r\n\r\n    constructor(existingTexture: Nullable<WebGLTexture> = null, context: WebGLRenderingContext) {\r\n        this._context = context as WebGLRenderingContext;\r\n        if (!existingTexture) {\r\n            existingTexture = context.createTexture();\r\n            if (!existingTexture) {\r\n                throw new Error(\"Unable to create webGL texture\");\r\n            }\r\n        }\r\n        this.set(existingTexture);\r\n    }\r\n\r\n    public setUsage(): void {}\r\n\r\n    public set(hardwareTexture: WebGLTexture) {\r\n        this._webGLTexture = hardwareTexture;\r\n    }\r\n\r\n    public reset() {\r\n        this._webGLTexture = null as any;\r\n        this._MSAARenderBuffers = null;\r\n    }\r\n\r\n    public addMSAARenderBuffer(buffer: WebGLRenderbuffer) {\r\n        if (!this._MSAARenderBuffers) {\r\n            this._MSAARenderBuffers = [];\r\n        }\r\n        this._MSAARenderBuffers.push(buffer);\r\n    }\r\n\r\n    public releaseMSAARenderBuffers() {\r\n        if (this._MSAARenderBuffers) {\r\n            for (const buffer of this._MSAARenderBuffers) {\r\n                this._context.deleteRenderbuffer(buffer);\r\n            }\r\n            this._MSAARenderBuffers = null;\r\n        }\r\n    }\r\n\r\n    public getMSAARenderBuffer(index = 0) {\r\n        return this._MSAARenderBuffers?.[index] ?? null;\r\n    }\r\n\r\n    public release() {\r\n        this.releaseMSAARenderBuffers();\r\n\r\n        if (this._webGLTexture) {\r\n            this._context.deleteTexture(this._webGLTexture);\r\n        }\r\n        this.reset();\r\n    }\r\n}\r\n", "import { Constants } from \"core/Engines/constants\";\r\n\r\n/**\r\n * Checks if a given format is a depth texture format\r\n * @param format Format to check\r\n * @returns True if the format is a depth texture format\r\n */\r\nexport function IsDepthTexture(format: number): boolean {\r\n    return (\r\n        format === Constants.TEXTUREFORMAT_DEPTH24_STENCIL8 ||\r\n        format === Constants.TEXTUREFORMAT_DEPTH32_FLOAT ||\r\n        format === Constants.TEXTUREFORMAT_DEPTH16 ||\r\n        format === Constants.TEXTUREFORMAT_DEPTH24 ||\r\n        format === Constants.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8 ||\r\n        format === Constants.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8 ||\r\n        format === Constants.TEXTUREFORMAT_STENCIL8\r\n    );\r\n}\r\n\r\n/**\r\n * Gets the type of a depth texture for a given format\r\n * @param format Format of the texture\r\n * @returns The type of the depth texture\r\n */\r\nexport function GetTypeForDepthTexture(format: number): number {\r\n    switch (format) {\r\n        case Constants.TEXTUREFORMAT_DEPTH24_STENCIL8:\r\n        case Constants.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8:\r\n        case Constants.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8:\r\n        case Constants.TEXTUREFORMAT_DEPTH32_FLOAT:\r\n        case Constants.TEXTUREFORMAT_DEPTH24:\r\n            return Constants.TEXTURETYPE_FLOAT;\r\n        case Constants.TEXTUREFORMAT_DEPTH16:\r\n            return Constants.TEXTURETYPE_UNSIGNED_SHORT;\r\n        case Constants.TEXTUREFORMAT_STENCIL8:\r\n            return Constants.TEXTURETYPE_UNSIGNED_BYTE;\r\n    }\r\n\r\n    return Constants.TEXTURETYPE_UNSIGNED_BYTE;\r\n}\r\n\r\n/**\r\n * Checks if a given format has a stencil aspect\r\n * @param format Format to check\r\n * @returns True if the format has a stencil aspect\r\n */\r\nexport function HasStencilAspect(format: number): boolean {\r\n    return (\r\n        format === Constants.TEXTUREFORMAT_DEPTH24_STENCIL8 ||\r\n        format === Constants.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8 ||\r\n        format === Constants.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8 ||\r\n        format === Constants.TEXTUREFORMAT_STENCIL8\r\n    );\r\n}\r\n", "/* eslint-disable @typescript-eslint/no-unused-vars */\r\nimport type { IEffectCreationOptions, IShaderPath } from \"../Materials/effect\";\r\nimport type { ShaderProcessingContext } from \"./Processors/shaderProcessingOptions\";\r\nimport type { Nullable, DataArray, IndicesArray, FloatArray, DeepImmutable } from \"../types\";\r\nimport type { IColor4Like } from \"../Maths/math.like\";\r\nimport type { DataBuffer } from \"../Buffers/dataBuffer\";\r\nimport type { IPipelineContext } from \"./IPipelineContext\";\r\nimport type { WebGLPipelineContext } from \"./WebGL/webGLPipelineContext\";\r\nimport type { VertexBuffer } from \"../Buffers/buffer\";\r\nimport type { InstancingAttributeInfo } from \"./instancingAttributeInfo\";\r\nimport type { ThinTexture } from \"../Materials/Textures/thinTexture\";\r\nimport type { IEffectFallbacks } from \"../Materials/iEffectFallbacks\";\r\nimport type { HardwareTextureWrapper } from \"../Materials/Textures/hardwareTextureWrapper\";\r\nimport type { DrawWrapper } from \"../Materials/drawWrapper\";\r\nimport type { IMaterialContext } from \"./IMaterialContext\";\r\nimport type { IDrawContext } from \"./IDrawContext\";\r\nimport type { ICanvas, ICanvasRenderingContext } from \"./ICanvas\";\r\nimport type { IStencilState } from \"../States/IStencilState\";\r\nimport type { InternalTextureCreationOptions, TextureSize } from \"../Materials/Textures/textureCreationOptions\";\r\nimport type { RenderTargetWrapper } from \"./renderTargetWrapper\";\r\nimport type { WebGLRenderTargetWrapper } from \"./WebGL/webGLRenderTargetWrapper\";\r\nimport type { VideoTexture } from \"../Materials/Textures/videoTexture\";\r\nimport type { RenderTargetTexture } from \"../Materials/Textures/renderTargetTexture\";\r\nimport {\r\n    createPipelineContext,\r\n    createRawShaderProgram,\r\n    createShaderProgram,\r\n    _finalizePipelineContext,\r\n    _preparePipelineContext,\r\n    _setProgram,\r\n    _executeWhenRenderingStateIsCompiled,\r\n    getStateObject,\r\n    _createShaderProgram,\r\n    deleteStateObject,\r\n    _isRenderingStateCompiled,\r\n} from \"./thinEngine.functions\";\r\n\r\nimport type { AbstractEngineOptions, ISceneLike, PrepareTextureFunction, PrepareTextureProcessFunction } from \"./abstractEngine\";\r\nimport type { PerformanceMonitor } from \"../Misc/performanceMonitor\";\r\nimport { IsWrapper } from \"../Materials/drawWrapper.functions\";\r\nimport { Logger } from \"../Misc/logger\";\r\nimport { IsWindowObjectExist } from \"../Misc/domManagement\";\r\nimport { WebGLShaderProcessor } from \"./WebGL/webGLShaderProcessors\";\r\nimport { WebGL2ShaderProcessor } from \"./WebGL/webGL2ShaderProcessors\";\r\nimport { WebGLDataBuffer } from \"../Meshes/WebGL/webGLDataBuffer\";\r\nimport { GetExponentOfTwo } from \"../Misc/tools.functions\";\r\nimport { AbstractEngine } from \"./abstractEngine\";\r\nimport { Constants } from \"./constants\";\r\nimport { WebGLHardwareTexture } from \"./WebGL/webGLHardwareTexture\";\r\nimport { ShaderLanguage } from \"../Materials/shaderLanguage\";\r\nimport { InternalTexture, InternalTextureSource } from \"../Materials/Textures/internalTexture\";\r\nimport { Effect } from \"../Materials/effect\";\r\nimport { _ConcatenateShader, _getGlobalDefines } from \"./abstractEngine.functions\";\r\nimport { resetCachedPipeline } from \"core/Materials/effect.functions\";\r\nimport { HasStencilAspect, IsDepthTexture } from \"core/Materials/Textures/textureHelper.functions\";\r\n\r\n/**\r\n * Keeps track of all the buffer info used in engine.\r\n */\r\nclass BufferPointer {\r\n    public active: boolean;\r\n    public index: number;\r\n    public size: number;\r\n    public type: number;\r\n    public normalized: boolean;\r\n    public stride: number;\r\n    public offset: number;\r\n    public buffer: WebGLBuffer;\r\n}\r\n\r\n/** Interface defining initialization parameters for Engine class */\r\nexport interface EngineOptions extends AbstractEngineOptions, WebGLContextAttributes {\r\n    /**\r\n     * Defines if webgl2 should be turned off even if supported\r\n     * @see https://doc.babylonjs.com/setup/support/webGL2\r\n     */\r\n    disableWebGL2Support?: boolean;\r\n\r\n    /**\r\n     * Defines that engine should compile shaders with high precision floats (if supported). True by default\r\n     */\r\n    useHighPrecisionFloats?: boolean;\r\n    /**\r\n     * Make the canvas XR Compatible for XR sessions\r\n     */\r\n    xrCompatible?: boolean;\r\n\r\n    /**\r\n     * Will prevent the system from falling back to software implementation if a hardware device cannot be created\r\n     */\r\n    failIfMajorPerformanceCaveat?: boolean;\r\n\r\n    /**\r\n     * If sRGB Buffer support is not set during construction, use this value to force a specific state\r\n     * This is added due to an issue when processing textures in chrome/edge/firefox\r\n     * This will not influence NativeEngine and WebGPUEngine which set the behavior to true during construction.\r\n     */\r\n    forceSRGBBufferSupportState?: boolean;\r\n\r\n    /**\r\n     * Defines if the gl context should be released.\r\n     * It's false by default for backward compatibility, but you should probably pass true (see https://registry.khronos.org/webgl/extensions/WEBGL_lose_context/)\r\n     */\r\n    loseContextOnDispose?: boolean;\r\n}\r\n\r\n/**\r\n * The base engine class (root of all engines)\r\n */\r\nexport class ThinEngine extends AbstractEngine {\r\n    private static _TempClearColorUint32 = new Uint32Array(4);\r\n    private static _TempClearColorInt32 = new Int32Array(4);\r\n\r\n    /** Use this array to turn off some WebGL2 features on known buggy browsers version */\r\n    public static ExceptionList = [\r\n        { key: \"Chrome/63.0\", capture: \"63\\\\.0\\\\.3239\\\\.(\\\\d+)\", captureConstraint: 108, targets: [\"uniformBuffer\"] },\r\n        { key: \"Firefox/58\", capture: null, captureConstraint: null, targets: [\"uniformBuffer\"] },\r\n        { key: \"Firefox/59\", capture: null, captureConstraint: null, targets: [\"uniformBuffer\"] },\r\n        { key: \"Chrome/72.+?Mobile\", capture: null, captureConstraint: null, targets: [\"vao\"] },\r\n        { key: \"Chrome/73.+?Mobile\", capture: null, captureConstraint: null, targets: [\"vao\"] },\r\n        { key: \"Chrome/74.+?Mobile\", capture: null, captureConstraint: null, targets: [\"vao\"] },\r\n        { key: \"Mac OS.+Chrome/71\", capture: null, captureConstraint: null, targets: [\"vao\"] },\r\n        { key: \"Mac OS.+Chrome/72\", capture: null, captureConstraint: null, targets: [\"vao\"] },\r\n        { key: \"Mac OS.+Chrome\", capture: null, captureConstraint: null, targets: [\"uniformBuffer\"] },\r\n        { key: \"Chrome/12\\\\d\\\\..+?Mobile\", capture: null, captureConstraint: null, targets: [\"uniformBuffer\"] },\r\n        // desktop osx safari 15.4\r\n        { key: \".*AppleWebKit.*(15.4).*Safari\", capture: null, captureConstraint: null, targets: [\"antialias\", \"maxMSAASamples\"] },\r\n        // mobile browsers using safari 15.4 on ios\r\n        { key: \".*(15.4).*AppleWebKit.*Safari\", capture: null, captureConstraint: null, targets: [\"antialias\", \"maxMSAASamples\"] },\r\n    ];\r\n\r\n    /** @internal */\r\n    protected override _name = \"WebGL\";\r\n\r\n    /**\r\n     * Gets or sets the name of the engine\r\n     */\r\n    public override get name(): string {\r\n        return this._name;\r\n    }\r\n\r\n    public override set name(value: string) {\r\n        this._name = value;\r\n    }\r\n\r\n    /**\r\n     * Returns the version of the engine\r\n     */\r\n    public get version(): number {\r\n        return this._webGLVersion;\r\n    }\r\n\r\n    /**\r\n     * Gets or sets the relative url used to load shaders if using the engine in non-minified mode\r\n     */\r\n    public static get ShadersRepository(): string {\r\n        return Effect.ShadersRepository;\r\n    }\r\n    public static set ShadersRepository(value: string) {\r\n        Effect.ShadersRepository = value;\r\n    }\r\n\r\n    /**\r\n     * Gets or sets a boolean that indicates if textures must be forced to power of 2 size even if not required\r\n     */\r\n    public forcePOTTextures = false;\r\n\r\n    /** Gets or sets a boolean indicating if the engine should validate programs after compilation */\r\n    public validateShaderPrograms = false;\r\n\r\n    /**\r\n     * Gets or sets a boolean indicating that uniform buffers must be disabled even if they are supported\r\n     */\r\n    public disableUniformBuffers = false;\r\n\r\n    /**\r\n     * Gets a boolean indicating that the engine supports uniform buffers\r\n     * @see https://doc.babylonjs.com/setup/support/webGL2#uniform-buffer-objets\r\n     */\r\n    public get supportsUniformBuffers(): boolean {\r\n        return this.webGLVersion > 1 && !this.disableUniformBuffers;\r\n    }\r\n\r\n    // Private Members\r\n\r\n    /** @internal */\r\n    public _gl: WebGL2RenderingContext;\r\n    /** @internal */\r\n    public _webGLVersion = 1.0;\r\n\r\n    /** @internal */\r\n    public _glSRGBExtensionValues: {\r\n        SRGB: typeof WebGL2RenderingContext.SRGB;\r\n        SRGB8: typeof WebGL2RenderingContext.SRGB8 | EXT_sRGB[\"SRGB_ALPHA_EXT\"];\r\n        SRGB8_ALPHA8: typeof WebGL2RenderingContext.SRGB8_ALPHA8 | EXT_sRGB[\"SRGB_ALPHA_EXT\"];\r\n    };\r\n\r\n    /**\r\n     * Gets a boolean indicating that only power of 2 textures are supported\r\n     * Please note that you can still use non power of 2 textures but in this case the engine will forcefully convert them\r\n     */\r\n    public get needPOTTextures(): boolean {\r\n        return this._webGLVersion < 2 || this.forcePOTTextures;\r\n    }\r\n\r\n    private _glVersion: string;\r\n    private _glRenderer: string;\r\n    private _glVendor: string;\r\n\r\n    // Cache\r\n\r\n    /** @internal */\r\n    public _currentMaterialContext: IMaterialContext;\r\n    /** @internal */\r\n    protected _currentProgram: Nullable<WebGLProgram>;\r\n    private _vertexAttribArraysEnabled: boolean[] = [];\r\n    private _cachedVertexArrayObject: Nullable<WebGLVertexArrayObject>;\r\n\r\n    private _uintIndicesCurrentlySet = false;\r\n    protected _currentBoundBuffer = new Array<Nullable<DataBuffer>>();\r\n    /** @internal */\r\n    public _currentFramebuffer: Nullable<WebGLFramebuffer> = null;\r\n    /** @internal */\r\n    public _dummyFramebuffer: Nullable<WebGLFramebuffer> = null;\r\n    private _currentBufferPointers = new Array<BufferPointer>();\r\n    private _currentInstanceLocations = new Array<number>();\r\n    private _currentInstanceBuffers = new Array<DataBuffer>();\r\n    private _textureUnits: Int32Array;\r\n\r\n    /** @internal */\r\n    public _workingCanvas: Nullable<ICanvas>;\r\n    /** @internal */\r\n    public _workingContext: Nullable<ICanvasRenderingContext>;\r\n\r\n    private _vaoRecordInProgress = false;\r\n    private _mustWipeVertexAttributes = false;\r\n\r\n    private _nextFreeTextureSlots = new Array<number>();\r\n    private _maxSimultaneousTextures = 0;\r\n    private _maxMSAASamplesOverride: Nullable<number> = null;\r\n\r\n    protected get _supportsHardwareTextureRescaling() {\r\n        return false;\r\n    }\r\n\r\n    protected _framebufferDimensionsObject: Nullable<{ framebufferWidth: number; framebufferHeight: number }>;\r\n\r\n    /**\r\n     * sets the object from which width and height will be taken from when getting render width and height\r\n     * Will fallback to the gl object\r\n     * @param dimensions the framebuffer width and height that will be used.\r\n     */\r\n    public set framebufferDimensionsObject(dimensions: Nullable<{ framebufferWidth: number; framebufferHeight: number }>) {\r\n        this._framebufferDimensionsObject = dimensions;\r\n    }\r\n\r\n    /**\r\n     * Creates a new snapshot at the next frame using the current snapshotRenderingMode\r\n     */\r\n    public snapshotRenderingReset(): void {\r\n        this.snapshotRendering = false;\r\n    }\r\n\r\n    /**\r\n     * Creates a new engine\r\n     * @param canvasOrContext defines the canvas or WebGL context to use for rendering. If you provide a WebGL context, Babylon.js will not hook events on the canvas (like pointers, keyboards, etc...) so no event observables will be available. This is mostly used when Babylon.js is used as a plugin on a system which already used the WebGL context\r\n     * @param antialias defines whether anti-aliasing should be enabled (default value is \"undefined\", meaning that the browser may or may not enable it)\r\n     * @param options defines further options to be sent to the getContext() function\r\n     * @param adaptToDeviceRatio defines whether to adapt to the device's viewport characteristics (default: false)\r\n     */\r\n    constructor(\r\n        canvasOrContext: Nullable<HTMLCanvasElement | OffscreenCanvas | WebGLRenderingContext | WebGL2RenderingContext>,\r\n        antialias?: boolean,\r\n        options?: EngineOptions,\r\n        adaptToDeviceRatio?: boolean\r\n    ) {\r\n        options = options || {};\r\n        super(antialias ?? options.antialias, options, adaptToDeviceRatio);\r\n\r\n        if (!canvasOrContext) {\r\n            return;\r\n        }\r\n\r\n        let canvas: Nullable<HTMLCanvasElement> = null;\r\n        if ((canvasOrContext as any).getContext) {\r\n            canvas = <HTMLCanvasElement>canvasOrContext;\r\n\r\n            if (options.preserveDrawingBuffer === undefined) {\r\n                options.preserveDrawingBuffer = false;\r\n            }\r\n\r\n            if (options.xrCompatible === undefined) {\r\n                options.xrCompatible = false;\r\n            }\r\n\r\n            // Exceptions\r\n            if (navigator && navigator.userAgent) {\r\n                this._setupMobileChecks();\r\n\r\n                const ua = navigator.userAgent;\r\n                for (const exception of ThinEngine.ExceptionList) {\r\n                    const key = exception.key;\r\n                    const targets = exception.targets;\r\n                    const check = new RegExp(key);\r\n\r\n                    if (check.test(ua)) {\r\n                        if (exception.capture && exception.captureConstraint) {\r\n                            const capture = exception.capture;\r\n                            const constraint = exception.captureConstraint;\r\n\r\n                            const regex = new RegExp(capture);\r\n                            const matches = regex.exec(ua);\r\n\r\n                            if (matches && matches.length > 0) {\r\n                                const capturedValue = parseInt(matches[matches.length - 1]);\r\n                                if (capturedValue >= constraint) {\r\n                                    continue;\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                        for (const target of targets) {\r\n                            switch (target) {\r\n                                case \"uniformBuffer\":\r\n                                    this.disableUniformBuffers = true;\r\n                                    break;\r\n                                case \"vao\":\r\n                                    this.disableVertexArrayObjects = true;\r\n                                    break;\r\n                                case \"antialias\":\r\n                                    options.antialias = false;\r\n                                    break;\r\n                                case \"maxMSAASamples\":\r\n                                    this._maxMSAASamplesOverride = 1;\r\n                                    break;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            // Context lost\r\n            if (!this._doNotHandleContextLost) {\r\n                this._onContextLost = (evt: Event) => {\r\n                    evt.preventDefault();\r\n                    this._contextWasLost = true;\r\n                    deleteStateObject(this._gl);\r\n                    Logger.Warn(\"WebGL context lost.\");\r\n\r\n                    this.onContextLostObservable.notifyObservers(this);\r\n                };\r\n\r\n                this._onContextRestored = () => {\r\n                    this._restoreEngineAfterContextLost(() => this._initGLContext());\r\n                };\r\n\r\n                canvas.addEventListener(\"webglcontextrestored\", this._onContextRestored, false);\r\n\r\n                options.powerPreference = options.powerPreference || \"high-performance\";\r\n            } else {\r\n                this._onContextLost = () => {\r\n                    deleteStateObject(this._gl);\r\n                };\r\n            }\r\n\r\n            canvas.addEventListener(\"webglcontextlost\", this._onContextLost, false);\r\n\r\n            if (this._badDesktopOS) {\r\n                options.xrCompatible = false;\r\n            }\r\n\r\n            // GL\r\n            if (!options.disableWebGL2Support) {\r\n                try {\r\n                    this._gl = <any>(canvas.getContext(\"webgl2\", options) || canvas.getContext(\"experimental-webgl2\", options));\r\n                    if (this._gl) {\r\n                        this._webGLVersion = 2.0;\r\n                        this._shaderPlatformName = \"WEBGL2\";\r\n\r\n                        // Prevent weird browsers to lie (yeah that happens!)\r\n                        if (!this._gl.deleteQuery) {\r\n                            this._webGLVersion = 1.0;\r\n                            this._shaderPlatformName = \"WEBGL1\";\r\n                        }\r\n                    }\r\n                } catch (e) {\r\n                    // Do nothing\r\n                }\r\n            }\r\n\r\n            if (!this._gl) {\r\n                if (!canvas) {\r\n                    throw new Error(\"The provided canvas is null or undefined.\");\r\n                }\r\n                try {\r\n                    this._gl = <WebGL2RenderingContext>(canvas.getContext(\"webgl\", options) || canvas.getContext(\"experimental-webgl\", options));\r\n                } catch (e) {\r\n                    throw new Error(\"WebGL not supported\");\r\n                }\r\n            }\r\n\r\n            if (!this._gl) {\r\n                throw new Error(\"WebGL not supported\");\r\n            }\r\n        } else {\r\n            this._gl = <WebGL2RenderingContext>canvasOrContext;\r\n            canvas = this._gl.canvas as HTMLCanvasElement;\r\n\r\n            if ((this._gl as any).renderbufferStorageMultisample) {\r\n                this._webGLVersion = 2.0;\r\n                this._shaderPlatformName = \"WEBGL2\";\r\n            } else {\r\n                this._shaderPlatformName = \"WEBGL1\";\r\n            }\r\n\r\n            const attributes = this._gl.getContextAttributes();\r\n            if (attributes) {\r\n                options.stencil = attributes.stencil;\r\n            }\r\n        }\r\n\r\n        this._sharedInit(canvas);\r\n\r\n        // Ensures a consistent color space unpacking of textures cross browser.\r\n        this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL, this._gl.NONE);\r\n\r\n        if (options.useHighPrecisionFloats !== undefined) {\r\n            this._highPrecisionShadersAllowed = options.useHighPrecisionFloats;\r\n        }\r\n\r\n        this.resize();\r\n\r\n        this._initGLContext();\r\n        this._initFeatures();\r\n\r\n        // Prepare buffer pointers\r\n        for (let i = 0; i < this._caps.maxVertexAttribs; i++) {\r\n            this._currentBufferPointers[i] = new BufferPointer();\r\n        }\r\n\r\n        // Shader processor\r\n        this._shaderProcessor = this.webGLVersion > 1 ? new WebGL2ShaderProcessor() : new WebGLShaderProcessor();\r\n\r\n        // Starting with iOS 14, we can trust the browser\r\n        // let matches = navigator.userAgent.match(/Version\\/(\\d+)/);\r\n\r\n        // if (matches && matches.length === 2) {\r\n        //     if (parseInt(matches[1]) >= 14) {\r\n        //         this._badOS = false;\r\n        //     }\r\n        // }\r\n\r\n        const versionToLog = `Babylon.js v${ThinEngine.Version}`;\r\n        Logger.Log(versionToLog + ` - ${this.description}`);\r\n\r\n        // Check setAttribute in case of workers\r\n        if (this._renderingCanvas && this._renderingCanvas.setAttribute) {\r\n            this._renderingCanvas.setAttribute(\"data-engine\", versionToLog);\r\n        }\r\n        const stateObject = getStateObject(this._gl);\r\n        // update state object with the current engine state\r\n        stateObject.validateShaderPrograms = this.validateShaderPrograms;\r\n        stateObject.parallelShaderCompile = this._caps.parallelShaderCompile;\r\n    }\r\n\r\n    protected override _clearEmptyResources(): void {\r\n        this._dummyFramebuffer = null;\r\n        super._clearEmptyResources();\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _getShaderProcessingContext(shaderLanguage: ShaderLanguage): Nullable<ShaderProcessingContext> {\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * Gets a boolean indicating if all created effects are ready\r\n     * @returns true if all effects are ready\r\n     */\r\n    public areAllEffectsReady(): boolean {\r\n        for (const key in this._compiledEffects) {\r\n            const effect = <Effect>this._compiledEffects[key];\r\n\r\n            if (!effect.isReady()) {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    protected _initGLContext(): void {\r\n        // Caps\r\n        this._caps = {\r\n            maxTexturesImageUnits: this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),\r\n            maxCombinedTexturesImageUnits: this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),\r\n            maxVertexTextureImageUnits: this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),\r\n            maxTextureSize: this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),\r\n            maxSamples: this._webGLVersion > 1 ? this._gl.getParameter(this._gl.MAX_SAMPLES) : 1,\r\n            maxCubemapTextureSize: this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),\r\n            maxRenderTextureSize: this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),\r\n            maxVertexAttribs: this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),\r\n            maxVaryingVectors: this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),\r\n            maxFragmentUniformVectors: this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),\r\n            maxVertexUniformVectors: this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),\r\n            parallelShaderCompile: this._gl.getExtension(\"KHR_parallel_shader_compile\") || undefined,\r\n            standardDerivatives: this._webGLVersion > 1 || this._gl.getExtension(\"OES_standard_derivatives\") !== null,\r\n            maxAnisotropy: 1,\r\n            astc: this._gl.getExtension(\"WEBGL_compressed_texture_astc\") || this._gl.getExtension(\"WEBKIT_WEBGL_compressed_texture_astc\"),\r\n            bptc: this._gl.getExtension(\"EXT_texture_compression_bptc\") || this._gl.getExtension(\"WEBKIT_EXT_texture_compression_bptc\"),\r\n            s3tc: this._gl.getExtension(\"WEBGL_compressed_texture_s3tc\") || this._gl.getExtension(\"WEBKIT_WEBGL_compressed_texture_s3tc\"),\r\n            // eslint-disable-next-line @typescript-eslint/naming-convention\r\n            s3tc_srgb: this._gl.getExtension(\"WEBGL_compressed_texture_s3tc_srgb\") || this._gl.getExtension(\"WEBKIT_WEBGL_compressed_texture_s3tc_srgb\"),\r\n            pvrtc: this._gl.getExtension(\"WEBGL_compressed_texture_pvrtc\") || this._gl.getExtension(\"WEBKIT_WEBGL_compressed_texture_pvrtc\"),\r\n            etc1: this._gl.getExtension(\"WEBGL_compressed_texture_etc1\") || this._gl.getExtension(\"WEBKIT_WEBGL_compressed_texture_etc1\"),\r\n            etc2:\r\n                this._gl.getExtension(\"WEBGL_compressed_texture_etc\") ||\r\n                this._gl.getExtension(\"WEBKIT_WEBGL_compressed_texture_etc\") ||\r\n                this._gl.getExtension(\"WEBGL_compressed_texture_es3_0\"), // also a requirement of OpenGL ES 3\r\n            textureAnisotropicFilterExtension:\r\n                this._gl.getExtension(\"EXT_texture_filter_anisotropic\") ||\r\n                this._gl.getExtension(\"WEBKIT_EXT_texture_filter_anisotropic\") ||\r\n                this._gl.getExtension(\"MOZ_EXT_texture_filter_anisotropic\"),\r\n            uintIndices: this._webGLVersion > 1 || this._gl.getExtension(\"OES_element_index_uint\") !== null,\r\n            fragmentDepthSupported: this._webGLVersion > 1 || this._gl.getExtension(\"EXT_frag_depth\") !== null,\r\n            highPrecisionShaderSupported: false,\r\n            timerQuery: this._gl.getExtension(\"EXT_disjoint_timer_query_webgl2\") || this._gl.getExtension(\"EXT_disjoint_timer_query\"),\r\n            supportOcclusionQuery: this._webGLVersion > 1,\r\n            canUseTimestampForTimerQuery: false,\r\n            drawBuffersExtension: false,\r\n            maxMSAASamples: 1,\r\n            colorBufferFloat: !!(this._webGLVersion > 1 && this._gl.getExtension(\"EXT_color_buffer_float\")),\r\n            supportFloatTexturesResolve: false,\r\n            rg11b10ufColorRenderable: false,\r\n            colorBufferHalfFloat: !!(this._webGLVersion > 1 && this._gl.getExtension(\"EXT_color_buffer_half_float\")),\r\n            textureFloat: this._webGLVersion > 1 || this._gl.getExtension(\"OES_texture_float\") ? true : false,\r\n            textureHalfFloat: this._webGLVersion > 1 || this._gl.getExtension(\"OES_texture_half_float\") ? true : false,\r\n            textureHalfFloatRender: false,\r\n            textureFloatLinearFiltering: false,\r\n            textureFloatRender: false,\r\n            textureHalfFloatLinearFiltering: false,\r\n            vertexArrayObject: false,\r\n            instancedArrays: false,\r\n            textureLOD: this._webGLVersion > 1 || this._gl.getExtension(\"EXT_shader_texture_lod\") ? true : false,\r\n            texelFetch: this._webGLVersion !== 1,\r\n            blendMinMax: false,\r\n            multiview: this._gl.getExtension(\"OVR_multiview2\"),\r\n            oculusMultiview: this._gl.getExtension(\"OCULUS_multiview\"),\r\n            depthTextureExtension: false,\r\n            canUseGLInstanceID: this._webGLVersion > 1,\r\n            canUseGLVertexID: this._webGLVersion > 1,\r\n            supportComputeShaders: false,\r\n            supportSRGBBuffers: false,\r\n            supportTransformFeedbacks: this._webGLVersion > 1,\r\n            textureMaxLevel: this._webGLVersion > 1,\r\n            texture2DArrayMaxLayerCount: this._webGLVersion > 1 ? this._gl.getParameter(this._gl.MAX_ARRAY_TEXTURE_LAYERS) : 128,\r\n            disableMorphTargetTexture: false,\r\n            textureNorm16: this._gl.getExtension(\"EXT_texture_norm16\") ? true : false,\r\n        };\r\n\r\n        this._caps.supportFloatTexturesResolve = this._caps.colorBufferFloat;\r\n        this._caps.rg11b10ufColorRenderable = this._caps.colorBufferFloat;\r\n\r\n        // Infos\r\n        this._glVersion = this._gl.getParameter(this._gl.VERSION);\r\n\r\n        const rendererInfo: any = this._gl.getExtension(\"WEBGL_debug_renderer_info\");\r\n        if (rendererInfo != null) {\r\n            this._glRenderer = this._gl.getParameter(rendererInfo.UNMASKED_RENDERER_WEBGL);\r\n            this._glVendor = this._gl.getParameter(rendererInfo.UNMASKED_VENDOR_WEBGL);\r\n        }\r\n\r\n        if (!this._glVendor) {\r\n            this._glVendor = this._gl.getParameter(this._gl.VENDOR) || \"Unknown vendor\";\r\n        }\r\n\r\n        if (!this._glRenderer) {\r\n            this._glRenderer = this._gl.getParameter(this._gl.RENDERER) || \"Unknown renderer\";\r\n        }\r\n\r\n        // Constants\r\n        if (this._gl.HALF_FLOAT_OES !== 0x8d61) {\r\n            this._gl.HALF_FLOAT_OES = 0x8d61; // Half floating-point type (16-bit).\r\n        }\r\n        if (this._gl.RGBA16F !== 0x881a) {\r\n            this._gl.RGBA16F = 0x881a; // RGBA 16-bit floating-point color-renderable internal sized format.\r\n        }\r\n        if (this._gl.RGBA32F !== 0x8814) {\r\n            this._gl.RGBA32F = 0x8814; // RGBA 32-bit floating-point color-renderable internal sized format.\r\n        }\r\n        if (this._gl.DEPTH24_STENCIL8 !== 35056) {\r\n            this._gl.DEPTH24_STENCIL8 = 35056;\r\n        }\r\n\r\n        // Extensions\r\n        if (this._caps.timerQuery) {\r\n            if (this._webGLVersion === 1) {\r\n                this._gl.getQuery = (<any>this._caps.timerQuery).getQueryEXT.bind(this._caps.timerQuery);\r\n            }\r\n            // WebGLQuery casted to number to avoid TS error\r\n            this._caps.canUseTimestampForTimerQuery = ((this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT, this._caps.timerQuery.QUERY_COUNTER_BITS_EXT) as number) ?? 0) > 0;\r\n        }\r\n\r\n        this._caps.maxAnisotropy = this._caps.textureAnisotropicFilterExtension\r\n            ? this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT)\r\n            : 0;\r\n        this._caps.textureFloatLinearFiltering = this._caps.textureFloat && this._gl.getExtension(\"OES_texture_float_linear\") ? true : false;\r\n        this._caps.textureFloatRender = this._caps.textureFloat && this._canRenderToFloatFramebuffer() ? true : false;\r\n        this._caps.textureHalfFloatLinearFiltering =\r\n            this._webGLVersion > 1 || (this._caps.textureHalfFloat && this._gl.getExtension(\"OES_texture_half_float_linear\")) ? true : false;\r\n\r\n        if (this._caps.textureNorm16) {\r\n            this._gl.R16_EXT = 0x822a;\r\n            this._gl.RG16_EXT = 0x822c;\r\n            this._gl.RGB16_EXT = 0x8054;\r\n            this._gl.RGBA16_EXT = 0x805b;\r\n            this._gl.R16_SNORM_EXT = 0x8f98;\r\n            this._gl.RG16_SNORM_EXT = 0x8f99;\r\n            this._gl.RGB16_SNORM_EXT = 0x8f9a;\r\n            this._gl.RGBA16_SNORM_EXT = 0x8f9b;\r\n        }\r\n\r\n        // Compressed formats\r\n        if (this._caps.astc) {\r\n            this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR = this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;\r\n        }\r\n        if (this._caps.bptc) {\r\n            this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT = this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;\r\n        }\r\n        if (this._caps.s3tc_srgb) {\r\n            this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT = this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT;\r\n            this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT = this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;\r\n            this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT = this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;\r\n        }\r\n        if (this._caps.etc2) {\r\n            this._gl.COMPRESSED_SRGB8_ETC2 = this._caps.etc2.COMPRESSED_SRGB8_ETC2;\r\n            this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC = this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC;\r\n        }\r\n\r\n        // Checks if some of the format renders first to allow the use of webgl inspector.\r\n        if (this._webGLVersion > 1) {\r\n            if (this._gl.HALF_FLOAT_OES !== 0x140b) {\r\n                this._gl.HALF_FLOAT_OES = 0x140b;\r\n            }\r\n        }\r\n        this._caps.textureHalfFloatRender = this._caps.textureHalfFloat && this._canRenderToHalfFloatFramebuffer();\r\n        // Draw buffers\r\n        if (this._webGLVersion > 1) {\r\n            this._caps.drawBuffersExtension = true;\r\n            this._caps.maxMSAASamples = this._maxMSAASamplesOverride !== null ? this._maxMSAASamplesOverride : this._gl.getParameter(this._gl.MAX_SAMPLES);\r\n            this._caps.maxDrawBuffers = this._gl.getParameter(this._gl.MAX_DRAW_BUFFERS);\r\n        } else {\r\n            const drawBuffersExtension = this._gl.getExtension(\"WEBGL_draw_buffers\");\r\n\r\n            if (drawBuffersExtension !== null) {\r\n                this._caps.drawBuffersExtension = true;\r\n                this._gl.drawBuffers = drawBuffersExtension.drawBuffersWEBGL.bind(drawBuffersExtension);\r\n                this._caps.maxDrawBuffers = this._gl.getParameter(drawBuffersExtension.MAX_DRAW_BUFFERS_WEBGL);\r\n                (this._gl.DRAW_FRAMEBUFFER as any) = this._gl.FRAMEBUFFER;\r\n\r\n                for (let i = 0; i < 16; i++) {\r\n                    (<any>this._gl)[\"COLOR_ATTACHMENT\" + i + \"_WEBGL\"] = (<any>drawBuffersExtension)[\"COLOR_ATTACHMENT\" + i + \"_WEBGL\"];\r\n                }\r\n            }\r\n        }\r\n\r\n        // Depth Texture\r\n        if (this._webGLVersion > 1) {\r\n            this._caps.depthTextureExtension = true;\r\n        } else {\r\n            const depthTextureExtension = this._gl.getExtension(\"WEBGL_depth_texture\");\r\n\r\n            if (depthTextureExtension != null) {\r\n                this._caps.depthTextureExtension = true;\r\n                this._gl.UNSIGNED_INT_24_8 = depthTextureExtension.UNSIGNED_INT_24_8_WEBGL;\r\n            }\r\n        }\r\n\r\n        // Vertex array object\r\n        if (this.disableVertexArrayObjects) {\r\n            this._caps.vertexArrayObject = false;\r\n        } else if (this._webGLVersion > 1) {\r\n            this._caps.vertexArrayObject = true;\r\n        } else {\r\n            const vertexArrayObjectExtension = this._gl.getExtension(\"OES_vertex_array_object\");\r\n\r\n            if (vertexArrayObjectExtension != null) {\r\n                this._caps.vertexArrayObject = true;\r\n                this._gl.createVertexArray = vertexArrayObjectExtension.createVertexArrayOES.bind(vertexArrayObjectExtension);\r\n                this._gl.bindVertexArray = vertexArrayObjectExtension.bindVertexArrayOES.bind(vertexArrayObjectExtension);\r\n                this._gl.deleteVertexArray = vertexArrayObjectExtension.deleteVertexArrayOES.bind(vertexArrayObjectExtension);\r\n            }\r\n        }\r\n\r\n        // Instances count\r\n        if (this._webGLVersion > 1) {\r\n            this._caps.instancedArrays = true;\r\n        } else {\r\n            const instanceExtension = <ANGLE_instanced_arrays>this._gl.getExtension(\"ANGLE_instanced_arrays\");\r\n\r\n            if (instanceExtension != null) {\r\n                this._caps.instancedArrays = true;\r\n                this._gl.drawArraysInstanced = instanceExtension.drawArraysInstancedANGLE.bind(instanceExtension);\r\n                this._gl.drawElementsInstanced = instanceExtension.drawElementsInstancedANGLE.bind(instanceExtension);\r\n                this._gl.vertexAttribDivisor = instanceExtension.vertexAttribDivisorANGLE.bind(instanceExtension);\r\n            } else {\r\n                this._caps.instancedArrays = false;\r\n            }\r\n        }\r\n\r\n        if (this._gl.getShaderPrecisionFormat) {\r\n            const vertexhighp = this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER, this._gl.HIGH_FLOAT);\r\n            const fragmenthighp = this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER, this._gl.HIGH_FLOAT);\r\n\r\n            if (vertexhighp && fragmenthighp) {\r\n                this._caps.highPrecisionShaderSupported = vertexhighp.precision !== 0 && fragmenthighp.precision !== 0;\r\n            }\r\n        }\r\n\r\n        if (this._webGLVersion > 1) {\r\n            this._caps.blendMinMax = true;\r\n        } else {\r\n            const blendMinMaxExtension = this._gl.getExtension(\"EXT_blend_minmax\");\r\n            if (blendMinMaxExtension != null) {\r\n                this._caps.blendMinMax = true;\r\n                this._gl.MAX = blendMinMaxExtension.MAX_EXT as typeof WebGL2RenderingContext.MAX;\r\n                this._gl.MIN = blendMinMaxExtension.MIN_EXT as typeof WebGL2RenderingContext.MIN;\r\n            }\r\n        }\r\n\r\n        // sRGB buffers\r\n        // only run this if not already set to true (in the constructor, for example)\r\n        if (!this._caps.supportSRGBBuffers) {\r\n            if (this._webGLVersion > 1) {\r\n                this._caps.supportSRGBBuffers = true;\r\n                this._glSRGBExtensionValues = {\r\n                    SRGB: WebGL2RenderingContext.SRGB,\r\n                    SRGB8: WebGL2RenderingContext.SRGB8,\r\n                    SRGB8_ALPHA8: WebGL2RenderingContext.SRGB8_ALPHA8,\r\n                };\r\n            } else {\r\n                const sRGBExtension = this._gl.getExtension(\"EXT_sRGB\");\r\n\r\n                if (sRGBExtension != null) {\r\n                    this._caps.supportSRGBBuffers = true;\r\n                    this._glSRGBExtensionValues = {\r\n                        SRGB: sRGBExtension.SRGB_EXT as typeof WebGL2RenderingContext.SRGB | EXT_sRGB[\"SRGB_EXT\"],\r\n                        SRGB8: sRGBExtension.SRGB_ALPHA_EXT as typeof WebGL2RenderingContext.SRGB8 | EXT_sRGB[\"SRGB_ALPHA_EXT\"],\r\n                        SRGB8_ALPHA8: sRGBExtension.SRGB_ALPHA_EXT as typeof WebGL2RenderingContext.SRGB8_ALPHA8 | EXT_sRGB[\"SRGB8_ALPHA8_EXT\"],\r\n                    };\r\n                }\r\n            }\r\n            // take into account the forced state that was provided in options\r\n            if (this._creationOptions) {\r\n                const forceSRGBBufferSupportState = (this._creationOptions as EngineOptions).forceSRGBBufferSupportState;\r\n                if (forceSRGBBufferSupportState !== undefined) {\r\n                    this._caps.supportSRGBBuffers = this._caps.supportSRGBBuffers && forceSRGBBufferSupportState;\r\n                }\r\n            }\r\n        }\r\n\r\n        // Depth buffer\r\n        this._depthCullingState.depthTest = true;\r\n        this._depthCullingState.depthFunc = this._gl.LEQUAL;\r\n        this._depthCullingState.depthMask = true;\r\n\r\n        // Texture maps\r\n        this._maxSimultaneousTextures = this._caps.maxCombinedTexturesImageUnits;\r\n        for (let slot = 0; slot < this._maxSimultaneousTextures; slot++) {\r\n            this._nextFreeTextureSlots.push(slot);\r\n        }\r\n\r\n        if (this._glRenderer === \"Mali-G72\") {\r\n            // Overcome a bug when using a texture to store morph targets on Mali-G72\r\n            this._caps.disableMorphTargetTexture = true;\r\n        }\r\n    }\r\n\r\n    protected _initFeatures(): void {\r\n        this._features = {\r\n            forceBitmapOverHTMLImageElement: typeof HTMLImageElement === \"undefined\",\r\n            supportRenderAndCopyToLodForFloatTextures: this._webGLVersion !== 1,\r\n            supportDepthStencilTexture: this._webGLVersion !== 1,\r\n            supportShadowSamplers: this._webGLVersion !== 1,\r\n            uniformBufferHardCheckMatrix: false,\r\n            allowTexturePrefiltering: this._webGLVersion !== 1,\r\n            trackUbosInFrame: false,\r\n            checkUbosContentBeforeUpload: false,\r\n            supportCSM: this._webGLVersion !== 1,\r\n            basisNeedsPOT: this._webGLVersion === 1,\r\n            support3DTextures: this._webGLVersion !== 1,\r\n            needTypeSuffixInShaderConstants: this._webGLVersion !== 1,\r\n            supportMSAA: this._webGLVersion !== 1,\r\n            supportSSAO2: this._webGLVersion !== 1,\r\n            supportIBLShadows: this._webGLVersion !== 1,\r\n            supportExtendedTextureFormats: this._webGLVersion !== 1,\r\n            supportSwitchCaseInShader: this._webGLVersion !== 1,\r\n            supportSyncTextureRead: true,\r\n            needsInvertingBitmap: true,\r\n            useUBOBindingCache: true,\r\n            needShaderCodeInlining: false,\r\n            needToAlwaysBindUniformBuffers: false,\r\n            supportRenderPasses: false,\r\n            supportSpriteInstancing: true,\r\n            forceVertexBufferStrideAndOffsetMultiple4Bytes: false,\r\n            _checkNonFloatVertexBuffersDontRecreatePipelineContext: false,\r\n            _collectUbosUpdatedInFrame: false,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Gets version of the current webGL context\r\n     * Keep it for back compat - use version instead\r\n     */\r\n    public get webGLVersion(): number {\r\n        return this._webGLVersion;\r\n    }\r\n\r\n    /**\r\n     * Gets a string identifying the name of the class\r\n     * @returns \"Engine\" string\r\n     */\r\n    public override getClassName(): string {\r\n        return \"ThinEngine\";\r\n    }\r\n\r\n    /** @internal */\r\n    public _prepareWorkingCanvas(): void {\r\n        if (this._workingCanvas) {\r\n            return;\r\n        }\r\n\r\n        this._workingCanvas = this.createCanvas(1, 1);\r\n        const context = this._workingCanvas.getContext(\"2d\");\r\n\r\n        if (context) {\r\n            this._workingContext = context;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Gets an object containing information about the current engine context\r\n     * @returns an object containing the vendor, the renderer and the version of the current engine context\r\n     */\r\n    public getInfo() {\r\n        return this.getGlInfo();\r\n    }\r\n\r\n    /**\r\n     * Gets an object containing information about the current webGL context\r\n     * @returns an object containing the vendor, the renderer and the version of the current webGL context\r\n     */\r\n    public getGlInfo() {\r\n        return {\r\n            vendor: this._glVendor,\r\n            renderer: this._glRenderer,\r\n            version: this._glVersion,\r\n        };\r\n    }\r\n\r\n    /**Gets driver info if available */\r\n    public extractDriverInfo() {\r\n        const glInfo = this.getGlInfo();\r\n        if (glInfo && glInfo.renderer) {\r\n            return glInfo.renderer;\r\n        }\r\n\r\n        return \"\";\r\n    }\r\n\r\n    /**\r\n     * Gets the current render width\r\n     * @param useScreen defines if screen size must be used (or the current render target if any)\r\n     * @returns a number defining the current render width\r\n     */\r\n    public getRenderWidth(useScreen = false): number {\r\n        if (!useScreen && this._currentRenderTarget) {\r\n            return this._currentRenderTarget.width;\r\n        }\r\n\r\n        return this._framebufferDimensionsObject ? this._framebufferDimensionsObject.framebufferWidth : this._gl.drawingBufferWidth;\r\n    }\r\n\r\n    /**\r\n     * Gets the current render height\r\n     * @param useScreen defines if screen size must be used (or the current render target if any)\r\n     * @returns a number defining the current render height\r\n     */\r\n    public getRenderHeight(useScreen = false): number {\r\n        if (!useScreen && this._currentRenderTarget) {\r\n            return this._currentRenderTarget.height;\r\n        }\r\n\r\n        return this._framebufferDimensionsObject ? this._framebufferDimensionsObject.framebufferHeight : this._gl.drawingBufferHeight;\r\n    }\r\n\r\n    /**\r\n     * Clear the current render buffer or the current render target (if any is set up)\r\n     * @param color defines the color to use\r\n     * @param backBuffer defines if the back buffer must be cleared\r\n     * @param depth defines if the depth buffer must be cleared\r\n     * @param stencil defines if the stencil buffer must be cleared\r\n     */\r\n    public clear(color: Nullable<IColor4Like>, backBuffer: boolean, depth: boolean, stencil: boolean = false): void {\r\n        const useStencilGlobalOnly = this.stencilStateComposer.useStencilGlobalOnly;\r\n        this.stencilStateComposer.useStencilGlobalOnly = true; // make sure the stencil mask is coming from the global stencil and not from a material (effect) which would currently be in effect\r\n\r\n        this.applyStates();\r\n\r\n        this.stencilStateComposer.useStencilGlobalOnly = useStencilGlobalOnly;\r\n\r\n        let mode = 0;\r\n        if (backBuffer && color) {\r\n            let setBackBufferColor = true;\r\n            if (this._currentRenderTarget) {\r\n                const textureFormat = this._currentRenderTarget.texture?.format;\r\n                if (\r\n                    textureFormat === Constants.TEXTUREFORMAT_RED_INTEGER ||\r\n                    textureFormat === Constants.TEXTUREFORMAT_RG_INTEGER ||\r\n                    textureFormat === Constants.TEXTUREFORMAT_RGB_INTEGER ||\r\n                    textureFormat === Constants.TEXTUREFORMAT_RGBA_INTEGER\r\n                ) {\r\n                    const textureType = this._currentRenderTarget.texture?.type;\r\n                    if (textureType === Constants.TEXTURETYPE_UNSIGNED_INTEGER || textureType === Constants.TEXTURETYPE_UNSIGNED_SHORT) {\r\n                        ThinEngine._TempClearColorUint32[0] = color.r * 255;\r\n                        ThinEngine._TempClearColorUint32[1] = color.g * 255;\r\n                        ThinEngine._TempClearColorUint32[2] = color.b * 255;\r\n                        ThinEngine._TempClearColorUint32[3] = color.a * 255;\r\n                        this._gl.clearBufferuiv(this._gl.COLOR, 0, ThinEngine._TempClearColorUint32);\r\n                        setBackBufferColor = false;\r\n                    } else {\r\n                        ThinEngine._TempClearColorInt32[0] = color.r * 255;\r\n                        ThinEngine._TempClearColorInt32[1] = color.g * 255;\r\n                        ThinEngine._TempClearColorInt32[2] = color.b * 255;\r\n                        ThinEngine._TempClearColorInt32[3] = color.a * 255;\r\n                        this._gl.clearBufferiv(this._gl.COLOR, 0, ThinEngine._TempClearColorInt32);\r\n                        setBackBufferColor = false;\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (setBackBufferColor) {\r\n                this._gl.clearColor(color.r, color.g, color.b, color.a !== undefined ? color.a : 1.0);\r\n                mode |= this._gl.COLOR_BUFFER_BIT;\r\n            }\r\n        }\r\n\r\n        if (depth) {\r\n            if (this.useReverseDepthBuffer) {\r\n                this._depthCullingState.depthFunc = this._gl.GEQUAL;\r\n                this._gl.clearDepth(0.0);\r\n            } else {\r\n                this._gl.clearDepth(1.0);\r\n            }\r\n            mode |= this._gl.DEPTH_BUFFER_BIT;\r\n        }\r\n        if (stencil) {\r\n            this._gl.clearStencil(0);\r\n            mode |= this._gl.STENCIL_BUFFER_BIT;\r\n        }\r\n        this._gl.clear(mode);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _viewport(x: number, y: number, width: number, height: number): void {\r\n        if (x !== this._viewportCached.x || y !== this._viewportCached.y || width !== this._viewportCached.z || height !== this._viewportCached.w) {\r\n            this._viewportCached.x = x;\r\n            this._viewportCached.y = y;\r\n            this._viewportCached.z = width;\r\n            this._viewportCached.w = height;\r\n\r\n            this._gl.viewport(x, y, width, height);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * End the current frame\r\n     */\r\n    public override endFrame(): void {\r\n        super.endFrame();\r\n        // Force a flush in case we are using a bad OS.\r\n        if (this._badOS) {\r\n            this.flushFramebuffer();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Gets the performance monitor attached to this engine\r\n     * @see https://doc.babylonjs.com/features/featuresDeepDive/scene/optimize_your_scene#engineinstrumentation\r\n     */\r\n    public get performanceMonitor(): PerformanceMonitor {\r\n        throw new Error(\"Not Supported by ThinEngine\");\r\n    }\r\n\r\n    /**\r\n     * Binds the frame buffer to the specified texture.\r\n     * @param rtWrapper The render target wrapper to render to\r\n     * @param faceIndex The face of the texture to render to in case of cube texture and if the render target wrapper is not a multi render target\r\n     * @param requiredWidth The width of the target to render to\r\n     * @param requiredHeight The height of the target to render to\r\n     * @param forceFullscreenViewport Forces the viewport to be the entire texture/screen if true\r\n     * @param lodLevel Defines the lod level to bind to the frame buffer\r\n     * @param layer Defines the 2d array index to bind to the frame buffer if the render target wrapper is not a multi render target\r\n     */\r\n    public bindFramebuffer(\r\n        rtWrapper: RenderTargetWrapper,\r\n        faceIndex: number = 0,\r\n        requiredWidth?: number,\r\n        requiredHeight?: number,\r\n        forceFullscreenViewport?: boolean,\r\n        lodLevel = 0,\r\n        layer = 0\r\n    ): void {\r\n        const webglRTWrapper = rtWrapper as WebGLRenderTargetWrapper;\r\n\r\n        if (this._currentRenderTarget) {\r\n            this.unBindFramebuffer(this._currentRenderTarget);\r\n        }\r\n        this._currentRenderTarget = rtWrapper;\r\n        this._bindUnboundFramebuffer(webglRTWrapper._framebuffer);\r\n\r\n        const gl = this._gl;\r\n        if (!rtWrapper.isMulti) {\r\n            if (rtWrapper.is2DArray || rtWrapper.is3D) {\r\n                gl.framebufferTextureLayer(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, rtWrapper.texture!._hardwareTexture?.underlyingResource, lodLevel, layer);\r\n                webglRTWrapper._currentLOD = lodLevel;\r\n            } else if (rtWrapper.isCube) {\r\n                gl.framebufferTexture2D(\r\n                    gl.FRAMEBUFFER,\r\n                    gl.COLOR_ATTACHMENT0,\r\n                    gl.TEXTURE_CUBE_MAP_POSITIVE_X + faceIndex,\r\n                    rtWrapper.texture!._hardwareTexture?.underlyingResource,\r\n                    lodLevel\r\n                );\r\n            } else if (webglRTWrapper._currentLOD !== lodLevel) {\r\n                gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, rtWrapper.texture!._hardwareTexture?.underlyingResource, lodLevel);\r\n                webglRTWrapper._currentLOD = lodLevel;\r\n            }\r\n        }\r\n\r\n        const depthStencilTexture = rtWrapper._depthStencilTexture;\r\n        if (depthStencilTexture) {\r\n            if (rtWrapper.is3D) {\r\n                if (\r\n                    rtWrapper.texture!.width !== depthStencilTexture.width ||\r\n                    rtWrapper.texture!.height !== depthStencilTexture.height ||\r\n                    rtWrapper.texture!.depth !== depthStencilTexture.depth\r\n                ) {\r\n                    Logger.Warn(\"Depth/Stencil attachment for 3D target must have same dimensions as color attachment\");\r\n                }\r\n            }\r\n            const attachment = rtWrapper._depthStencilTextureWithStencil ? gl.DEPTH_STENCIL_ATTACHMENT : gl.DEPTH_ATTACHMENT;\r\n            if (rtWrapper.is2DArray || rtWrapper.is3D) {\r\n                gl.framebufferTextureLayer(gl.FRAMEBUFFER, attachment, depthStencilTexture._hardwareTexture?.underlyingResource, lodLevel, layer);\r\n            } else if (rtWrapper.isCube) {\r\n                gl.framebufferTexture2D(gl.FRAMEBUFFER, attachment, gl.TEXTURE_CUBE_MAP_POSITIVE_X + faceIndex, depthStencilTexture._hardwareTexture?.underlyingResource, lodLevel);\r\n            } else {\r\n                gl.framebufferTexture2D(gl.FRAMEBUFFER, attachment, gl.TEXTURE_2D, depthStencilTexture._hardwareTexture?.underlyingResource, lodLevel);\r\n            }\r\n        }\r\n\r\n        if (webglRTWrapper._MSAAFramebuffer) {\r\n            this._bindUnboundFramebuffer(webglRTWrapper._MSAAFramebuffer);\r\n        }\r\n\r\n        if (this._cachedViewport && !forceFullscreenViewport) {\r\n            this.setViewport(this._cachedViewport, requiredWidth, requiredHeight);\r\n        } else {\r\n            if (!requiredWidth) {\r\n                requiredWidth = rtWrapper.width;\r\n                if (lodLevel) {\r\n                    requiredWidth = requiredWidth / Math.pow(2, lodLevel);\r\n                }\r\n            }\r\n            if (!requiredHeight) {\r\n                requiredHeight = rtWrapper.height;\r\n                if (lodLevel) {\r\n                    requiredHeight = requiredHeight / Math.pow(2, lodLevel);\r\n                }\r\n            }\r\n\r\n            this._viewport(0, 0, requiredWidth, requiredHeight);\r\n        }\r\n\r\n        this.wipeCaches();\r\n    }\r\n\r\n    public override setStateCullFaceType(cullBackFaces?: boolean, force?: boolean): void {\r\n        const cullFace = (this.cullBackFaces ?? cullBackFaces ?? true) ? this._gl.BACK : this._gl.FRONT;\r\n        if (this._depthCullingState.cullFace !== cullFace || force) {\r\n            this._depthCullingState.cullFace = cullFace;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Set various states to the webGL context\r\n     * @param culling defines culling state: true to enable culling, false to disable it\r\n     * @param zOffset defines the value to apply to zOffset (0 by default)\r\n     * @param force defines if states must be applied even if cache is up to date\r\n     * @param reverseSide defines if culling must be reversed (CCW if false, CW if true)\r\n     * @param cullBackFaces true to cull back faces, false to cull front faces (if culling is enabled)\r\n     * @param stencil stencil states to set\r\n     * @param zOffsetUnits defines the value to apply to zOffsetUnits (0 by default)\r\n     */\r\n    public setState(culling: boolean, zOffset: number = 0, force?: boolean, reverseSide = false, cullBackFaces?: boolean, stencil?: IStencilState, zOffsetUnits: number = 0): void {\r\n        // Culling\r\n        if (this._depthCullingState.cull !== culling || force) {\r\n            this._depthCullingState.cull = culling;\r\n        }\r\n\r\n        // Cull face\r\n        this.setStateCullFaceType(cullBackFaces, force);\r\n\r\n        // Z offset\r\n        this.setZOffset(zOffset);\r\n        this.setZOffsetUnits(zOffsetUnits);\r\n\r\n        // Front face\r\n        const frontFace = reverseSide ? this._gl.CW : this._gl.CCW;\r\n        if (this._depthCullingState.frontFace !== frontFace || force) {\r\n            this._depthCullingState.frontFace = frontFace;\r\n        }\r\n\r\n        this._stencilStateComposer.stencilMaterial = stencil;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _bindUnboundFramebuffer(framebuffer: Nullable<WebGLFramebuffer>) {\r\n        if (this._currentFramebuffer !== framebuffer) {\r\n            this._gl.bindFramebuffer(this._gl.FRAMEBUFFER, framebuffer);\r\n            this._currentFramebuffer = framebuffer;\r\n        }\r\n    }\r\n\r\n    /** @internal */\r\n    public _currentFrameBufferIsDefaultFrameBuffer() {\r\n        return this._currentFramebuffer === null;\r\n    }\r\n\r\n    /**\r\n     * Generates the mipmaps for a texture\r\n     * @param texture texture to generate the mipmaps for\r\n     */\r\n    public generateMipmaps(texture: InternalTexture): void {\r\n        const target = this._getTextureTarget(texture);\r\n        this._bindTextureDirectly(target, texture, true);\r\n        this._gl.generateMipmap(target);\r\n        this._bindTextureDirectly(target, null);\r\n    }\r\n\r\n    /**\r\n     * Unbind the current render target texture from the webGL context\r\n     * @param texture defines the render target wrapper to unbind\r\n     * @param disableGenerateMipMaps defines a boolean indicating that mipmaps must not be generated\r\n     * @param onBeforeUnbind defines a function which will be called before the effective unbind\r\n     */\r\n    public unBindFramebuffer(texture: RenderTargetWrapper, disableGenerateMipMaps = false, onBeforeUnbind?: () => void): void {\r\n        const webglRTWrapper = texture as WebGLRenderTargetWrapper;\r\n\r\n        this._currentRenderTarget = null;\r\n\r\n        if (!webglRTWrapper.disableAutomaticMSAAResolve) {\r\n            if (texture.isMulti) {\r\n                this.resolveMultiFramebuffer(texture);\r\n            } else {\r\n                this.resolveFramebuffer(texture);\r\n            }\r\n        }\r\n\r\n        if (!disableGenerateMipMaps) {\r\n            if (texture.isMulti) {\r\n                this.generateMipMapsMultiFramebuffer(texture);\r\n            } else {\r\n                this.generateMipMapsFramebuffer(texture);\r\n            }\r\n        }\r\n\r\n        if (onBeforeUnbind) {\r\n            if (webglRTWrapper._MSAAFramebuffer) {\r\n                // Bind the correct framebuffer\r\n                this._bindUnboundFramebuffer(webglRTWrapper._framebuffer);\r\n            }\r\n            onBeforeUnbind();\r\n        }\r\n\r\n        this._bindUnboundFramebuffer(null);\r\n    }\r\n\r\n    /**\r\n     * Generates mipmaps for the texture of the (single) render target\r\n     * @param texture The render target containing the texture to generate the mipmaps for\r\n     */\r\n    public generateMipMapsFramebuffer(texture: RenderTargetWrapper): void {\r\n        if (!texture.isMulti && texture.texture?.generateMipMaps && !texture.isCube) {\r\n            this.generateMipmaps(texture.texture);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Resolves the MSAA texture of the (single) render target into its non-MSAA version.\r\n     * Note that if \"texture\" is not a MSAA render target, no resolve is performed.\r\n     * @param texture  The render target texture containing the MSAA textures to resolve\r\n     */\r\n    public resolveFramebuffer(texture: RenderTargetWrapper): void {\r\n        const rtWrapper = texture as WebGLRenderTargetWrapper;\r\n        const gl = this._gl;\r\n\r\n        if (!rtWrapper._MSAAFramebuffer || rtWrapper.isMulti) {\r\n            return;\r\n        }\r\n\r\n        let bufferBits = rtWrapper.resolveMSAAColors ? gl.COLOR_BUFFER_BIT : 0;\r\n        bufferBits |= rtWrapper._generateDepthBuffer && rtWrapper.resolveMSAADepth ? gl.DEPTH_BUFFER_BIT : 0;\r\n        bufferBits |= rtWrapper._generateStencilBuffer && rtWrapper.resolveMSAAStencil ? gl.STENCIL_BUFFER_BIT : 0;\r\n\r\n        gl.bindFramebuffer(gl.READ_FRAMEBUFFER, rtWrapper._MSAAFramebuffer);\r\n        gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER, rtWrapper._framebuffer);\r\n        gl.blitFramebuffer(0, 0, texture.width, texture.height, 0, 0, texture.width, texture.height, bufferBits, gl.NEAREST);\r\n    }\r\n\r\n    /**\r\n     * Force a webGL flush (ie. a flush of all waiting webGL commands)\r\n     */\r\n    public flushFramebuffer(): void {\r\n        this._gl.flush();\r\n    }\r\n\r\n    /**\r\n     * Unbind the current render target and bind the default framebuffer\r\n     */\r\n    public restoreDefaultFramebuffer(): void {\r\n        if (this._currentRenderTarget) {\r\n            this.unBindFramebuffer(this._currentRenderTarget);\r\n        } else {\r\n            this._bindUnboundFramebuffer(null);\r\n        }\r\n        if (this._cachedViewport) {\r\n            this.setViewport(this._cachedViewport);\r\n        }\r\n\r\n        this.wipeCaches();\r\n    }\r\n\r\n    // VBOs\r\n\r\n    /** @internal */\r\n    protected _resetVertexBufferBinding(): void {\r\n        this.bindArrayBuffer(null);\r\n        this._cachedVertexBuffers = null;\r\n    }\r\n\r\n    /**\r\n     * Creates a vertex buffer\r\n     * @param data the data or size for the vertex buffer\r\n     * @param _updatable whether the buffer should be created as updatable\r\n     * @param _label defines the label of the buffer (for debug purpose)\r\n     * @returns the new WebGL static buffer\r\n     */\r\n    public createVertexBuffer(data: DataArray | number, _updatable?: boolean, _label?: string): DataBuffer {\r\n        return this._createVertexBuffer(data, this._gl.STATIC_DRAW);\r\n    }\r\n\r\n    private _createVertexBuffer(data: DataArray | number, usage: number): DataBuffer {\r\n        const vbo = this._gl.createBuffer();\r\n\r\n        if (!vbo) {\r\n            throw new Error(\"Unable to create vertex buffer\");\r\n        }\r\n\r\n        const dataBuffer = new WebGLDataBuffer(vbo);\r\n        this.bindArrayBuffer(dataBuffer);\r\n\r\n        if (typeof data !== \"number\") {\r\n            if (data instanceof Array) {\r\n                this._gl.bufferData(this._gl.ARRAY_BUFFER, new Float32Array(data), usage);\r\n                dataBuffer.capacity = data.length * 4;\r\n            } else {\r\n                this._gl.bufferData(this._gl.ARRAY_BUFFER, <ArrayBuffer>data, usage);\r\n                dataBuffer.capacity = data.byteLength;\r\n            }\r\n        } else {\r\n            this._gl.bufferData(this._gl.ARRAY_BUFFER, new Uint8Array(data), usage);\r\n            dataBuffer.capacity = data;\r\n        }\r\n\r\n        this._resetVertexBufferBinding();\r\n\r\n        dataBuffer.references = 1;\r\n        return dataBuffer;\r\n    }\r\n\r\n    /**\r\n     * Creates a dynamic vertex buffer\r\n     * @param data the data for the dynamic vertex buffer\r\n     * @param _label defines the label of the buffer (for debug purpose)\r\n     * @returns the new WebGL dynamic buffer\r\n     */\r\n    public createDynamicVertexBuffer(data: DataArray | number, _label?: string): DataBuffer {\r\n        return this._createVertexBuffer(data, this._gl.DYNAMIC_DRAW);\r\n    }\r\n\r\n    protected _resetIndexBufferBinding(): void {\r\n        this.bindIndexBuffer(null);\r\n        this._cachedIndexBuffer = null;\r\n    }\r\n\r\n    /**\r\n     * Creates a new index buffer\r\n     * @param indices defines the content of the index buffer\r\n     * @param updatable defines if the index buffer must be updatable\r\n     * @param _label defines the label of the buffer (for debug purpose)\r\n     * @returns a new webGL buffer\r\n     */\r\n    public createIndexBuffer(indices: IndicesArray, updatable?: boolean, _label?: string): DataBuffer {\r\n        const vbo = this._gl.createBuffer();\r\n        const dataBuffer = new WebGLDataBuffer(vbo!);\r\n\r\n        if (!vbo) {\r\n            throw new Error(\"Unable to create index buffer\");\r\n        }\r\n\r\n        this.bindIndexBuffer(dataBuffer);\r\n\r\n        const data = this._normalizeIndexData(indices);\r\n        this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER, data, updatable ? this._gl.DYNAMIC_DRAW : this._gl.STATIC_DRAW);\r\n        this._resetIndexBufferBinding();\r\n        dataBuffer.references = 1;\r\n        dataBuffer.is32Bits = data.BYTES_PER_ELEMENT === 4;\r\n        return dataBuffer;\r\n    }\r\n\r\n    protected _normalizeIndexData(indices: IndicesArray): Uint16Array | Uint32Array {\r\n        const bytesPerElement = (indices as Exclude<IndicesArray, number[]>).BYTES_PER_ELEMENT;\r\n        if (bytesPerElement === 2) {\r\n            return indices as Uint16Array;\r\n        }\r\n\r\n        // Check 32 bit support\r\n        if (this._caps.uintIndices) {\r\n            if (indices instanceof Uint32Array) {\r\n                return indices;\r\n            } else {\r\n                // number[] or Int32Array, check if 32 bit is necessary\r\n                for (let index = 0; index < indices.length; index++) {\r\n                    if (indices[index] >= 65535) {\r\n                        return new Uint32Array(indices);\r\n                    }\r\n                }\r\n\r\n                return new Uint16Array(indices);\r\n            }\r\n        }\r\n\r\n        // No 32 bit support, force conversion to 16 bit (values greater 16 bit are lost)\r\n        return new Uint16Array(indices);\r\n    }\r\n\r\n    /**\r\n     * Bind a webGL buffer to the webGL context\r\n     * @param buffer defines the buffer to bind\r\n     */\r\n    public bindArrayBuffer(buffer: Nullable<DataBuffer>): void {\r\n        if (!this._vaoRecordInProgress) {\r\n            this._unbindVertexArrayObject();\r\n        }\r\n        this._bindBuffer(buffer, this._gl.ARRAY_BUFFER);\r\n    }\r\n\r\n    /**\r\n     * Bind a specific block at a given index in a specific shader program\r\n     * @param pipelineContext defines the pipeline context to use\r\n     * @param blockName defines the block name\r\n     * @param index defines the index where to bind the block\r\n     */\r\n    public bindUniformBlock(pipelineContext: IPipelineContext, blockName: string, index: number): void {\r\n        const program = (pipelineContext as WebGLPipelineContext).program!;\r\n\r\n        const uniformLocation = this._gl.getUniformBlockIndex(program, blockName);\r\n\r\n        this._gl.uniformBlockBinding(program, uniformLocation, index);\r\n    }\r\n\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    protected bindIndexBuffer(buffer: Nullable<DataBuffer>): void {\r\n        if (!this._vaoRecordInProgress) {\r\n            this._unbindVertexArrayObject();\r\n        }\r\n        this._bindBuffer(buffer, this._gl.ELEMENT_ARRAY_BUFFER);\r\n    }\r\n\r\n    private _bindBuffer(buffer: Nullable<DataBuffer>, target: number): void {\r\n        if (this._vaoRecordInProgress || this._currentBoundBuffer[target] !== buffer) {\r\n            this._gl.bindBuffer(target, buffer ? buffer.underlyingResource : null);\r\n            this._currentBoundBuffer[target] = buffer;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * update the bound buffer with the given data\r\n     * @param data defines the data to update\r\n     */\r\n    public updateArrayBuffer(data: Float32Array): void {\r\n        this._gl.bufferSubData(this._gl.ARRAY_BUFFER, 0, data);\r\n    }\r\n\r\n    private _vertexAttribPointer(buffer: DataBuffer, indx: number, size: number, type: number, normalized: boolean, stride: number, offset: number): void {\r\n        const pointer = this._currentBufferPointers[indx];\r\n        if (!pointer) {\r\n            return;\r\n        }\r\n\r\n        let changed = false;\r\n        if (!pointer.active) {\r\n            changed = true;\r\n            pointer.active = true;\r\n            pointer.index = indx;\r\n            pointer.size = size;\r\n            pointer.type = type;\r\n            pointer.normalized = normalized;\r\n            pointer.stride = stride;\r\n            pointer.offset = offset;\r\n            pointer.buffer = buffer;\r\n        } else {\r\n            if (pointer.buffer !== buffer) {\r\n                pointer.buffer = buffer;\r\n                changed = true;\r\n            }\r\n            if (pointer.size !== size) {\r\n                pointer.size = size;\r\n                changed = true;\r\n            }\r\n            if (pointer.type !== type) {\r\n                pointer.type = type;\r\n                changed = true;\r\n            }\r\n            if (pointer.normalized !== normalized) {\r\n                pointer.normalized = normalized;\r\n                changed = true;\r\n            }\r\n            if (pointer.stride !== stride) {\r\n                pointer.stride = stride;\r\n                changed = true;\r\n            }\r\n            if (pointer.offset !== offset) {\r\n                pointer.offset = offset;\r\n                changed = true;\r\n            }\r\n        }\r\n\r\n        if (changed || this._vaoRecordInProgress) {\r\n            this.bindArrayBuffer(buffer);\r\n            if (type === this._gl.UNSIGNED_INT || type === this._gl.INT) {\r\n                this._gl.vertexAttribIPointer(indx, size, type, stride, offset);\r\n            } else {\r\n                this._gl.vertexAttribPointer(indx, size, type, normalized, stride, offset);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _bindIndexBufferWithCache(indexBuffer: Nullable<DataBuffer>): void {\r\n        if (indexBuffer == null) {\r\n            return;\r\n        }\r\n        if (this._cachedIndexBuffer !== indexBuffer) {\r\n            this._cachedIndexBuffer = indexBuffer;\r\n            this.bindIndexBuffer(indexBuffer);\r\n            this._uintIndicesCurrentlySet = indexBuffer.is32Bits;\r\n        }\r\n    }\r\n\r\n    private _bindVertexBuffersAttributes(\r\n        vertexBuffers: { [key: string]: Nullable<VertexBuffer> },\r\n        effect: Effect,\r\n        overrideVertexBuffers?: { [kind: string]: Nullable<VertexBuffer> }\r\n    ): void {\r\n        const attributes = effect.getAttributesNames();\r\n\r\n        if (!this._vaoRecordInProgress) {\r\n            this._unbindVertexArrayObject();\r\n        }\r\n\r\n        this.unbindAllAttributes();\r\n\r\n        for (let index = 0; index < attributes.length; index++) {\r\n            const order = effect.getAttributeLocation(index);\r\n\r\n            if (order >= 0) {\r\n                const ai = attributes[index];\r\n                let vertexBuffer: Nullable<VertexBuffer> = null;\r\n\r\n                if (overrideVertexBuffers) {\r\n                    vertexBuffer = overrideVertexBuffers[ai];\r\n                }\r\n\r\n                if (!vertexBuffer) {\r\n                    vertexBuffer = vertexBuffers[ai];\r\n                }\r\n\r\n                if (!vertexBuffer) {\r\n                    continue;\r\n                }\r\n\r\n                this._gl.enableVertexAttribArray(order);\r\n                if (!this._vaoRecordInProgress) {\r\n                    this._vertexAttribArraysEnabled[order] = true;\r\n                }\r\n\r\n                const buffer = vertexBuffer.getBuffer();\r\n                if (buffer) {\r\n                    this._vertexAttribPointer(buffer, order, vertexBuffer.getSize(), vertexBuffer.type, vertexBuffer.normalized, vertexBuffer.byteStride, vertexBuffer.byteOffset);\r\n\r\n                    if (vertexBuffer.getIsInstanced()) {\r\n                        this._gl.vertexAttribDivisor(order, vertexBuffer.getInstanceDivisor());\r\n                        if (!this._vaoRecordInProgress) {\r\n                            this._currentInstanceLocations.push(order);\r\n                            this._currentInstanceBuffers.push(buffer);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Records a vertex array object\r\n     * @see https://doc.babylonjs.com/setup/support/webGL2#vertex-array-objects\r\n     * @param vertexBuffers defines the list of vertex buffers to store\r\n     * @param indexBuffer defines the index buffer to store\r\n     * @param effect defines the effect to store\r\n     * @param overrideVertexBuffers defines optional list of avertex buffers that overrides the entries in vertexBuffers\r\n     * @returns the new vertex array object\r\n     */\r\n    public recordVertexArrayObject(\r\n        vertexBuffers: { [key: string]: VertexBuffer },\r\n        indexBuffer: Nullable<DataBuffer>,\r\n        effect: Effect,\r\n        overrideVertexBuffers?: { [kind: string]: Nullable<VertexBuffer> }\r\n    ): WebGLVertexArrayObject {\r\n        const vao = this._gl.createVertexArray();\r\n\r\n        if (!vao) {\r\n            throw new Error(\"Unable to create VAO\");\r\n        }\r\n\r\n        this._vaoRecordInProgress = true;\r\n\r\n        this._gl.bindVertexArray(vao);\r\n\r\n        this._mustWipeVertexAttributes = true;\r\n        this._bindVertexBuffersAttributes(vertexBuffers, effect, overrideVertexBuffers);\r\n\r\n        this.bindIndexBuffer(indexBuffer);\r\n\r\n        this._vaoRecordInProgress = false;\r\n        this._gl.bindVertexArray(null);\r\n\r\n        return vao;\r\n    }\r\n\r\n    /**\r\n     * Bind a specific vertex array object\r\n     * @see https://doc.babylonjs.com/setup/support/webGL2#vertex-array-objects\r\n     * @param vertexArrayObject defines the vertex array object to bind\r\n     * @param indexBuffer defines the index buffer to bind\r\n     */\r\n    public bindVertexArrayObject(vertexArrayObject: WebGLVertexArrayObject, indexBuffer: Nullable<DataBuffer>): void {\r\n        if (this._cachedVertexArrayObject !== vertexArrayObject) {\r\n            this._cachedVertexArrayObject = vertexArrayObject;\r\n\r\n            this._gl.bindVertexArray(vertexArrayObject);\r\n            this._cachedVertexBuffers = null;\r\n            this._cachedIndexBuffer = null;\r\n\r\n            this._uintIndicesCurrentlySet = indexBuffer != null && indexBuffer.is32Bits;\r\n            this._mustWipeVertexAttributes = true;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Bind webGl buffers directly to the webGL context\r\n     * @param vertexBuffer defines the vertex buffer to bind\r\n     * @param indexBuffer defines the index buffer to bind\r\n     * @param vertexDeclaration defines the vertex declaration to use with the vertex buffer\r\n     * @param vertexStrideSize defines the vertex stride of the vertex buffer\r\n     * @param effect defines the effect associated with the vertex buffer\r\n     */\r\n    public bindBuffersDirectly(vertexBuffer: DataBuffer, indexBuffer: DataBuffer, vertexDeclaration: number[], vertexStrideSize: number, effect: Effect): void {\r\n        if (this._cachedVertexBuffers !== vertexBuffer || this._cachedEffectForVertexBuffers !== effect) {\r\n            this._cachedVertexBuffers = vertexBuffer;\r\n            this._cachedEffectForVertexBuffers = effect;\r\n\r\n            const attributesCount = effect.getAttributesCount();\r\n\r\n            this._unbindVertexArrayObject();\r\n            this.unbindAllAttributes();\r\n\r\n            let offset = 0;\r\n            for (let index = 0; index < attributesCount; index++) {\r\n                if (index < vertexDeclaration.length) {\r\n                    const order = effect.getAttributeLocation(index);\r\n\r\n                    if (order >= 0) {\r\n                        this._gl.enableVertexAttribArray(order);\r\n                        this._vertexAttribArraysEnabled[order] = true;\r\n                        this._vertexAttribPointer(vertexBuffer, order, vertexDeclaration[index], this._gl.FLOAT, false, vertexStrideSize, offset);\r\n                    }\r\n\r\n                    offset += vertexDeclaration[index] * 4;\r\n                }\r\n            }\r\n        }\r\n\r\n        this._bindIndexBufferWithCache(indexBuffer);\r\n    }\r\n\r\n    private _unbindVertexArrayObject(): void {\r\n        if (!this._cachedVertexArrayObject) {\r\n            return;\r\n        }\r\n\r\n        this._cachedVertexArrayObject = null;\r\n        this._gl.bindVertexArray(null);\r\n    }\r\n\r\n    /**\r\n     * Bind a list of vertex buffers to the webGL context\r\n     * @param vertexBuffers defines the list of vertex buffers to bind\r\n     * @param indexBuffer defines the index buffer to bind\r\n     * @param effect defines the effect associated with the vertex buffers\r\n     * @param overrideVertexBuffers defines optional list of avertex buffers that overrides the entries in vertexBuffers\r\n     */\r\n    public bindBuffers(\r\n        vertexBuffers: { [key: string]: Nullable<VertexBuffer> },\r\n        indexBuffer: Nullable<DataBuffer>,\r\n        effect: Effect,\r\n        overrideVertexBuffers?: { [kind: string]: Nullable<VertexBuffer> }\r\n    ): void {\r\n        if (this._cachedVertexBuffers !== vertexBuffers || this._cachedEffectForVertexBuffers !== effect) {\r\n            this._cachedVertexBuffers = vertexBuffers;\r\n            this._cachedEffectForVertexBuffers = effect;\r\n\r\n            this._bindVertexBuffersAttributes(vertexBuffers, effect, overrideVertexBuffers);\r\n        }\r\n\r\n        this._bindIndexBufferWithCache(indexBuffer);\r\n    }\r\n\r\n    /**\r\n     * Unbind all instance attributes\r\n     */\r\n    public unbindInstanceAttributes() {\r\n        let boundBuffer;\r\n        for (let i = 0, ul = this._currentInstanceLocations.length; i < ul; i++) {\r\n            const instancesBuffer = this._currentInstanceBuffers[i];\r\n            if (boundBuffer != instancesBuffer && instancesBuffer.references) {\r\n                boundBuffer = instancesBuffer;\r\n                this.bindArrayBuffer(instancesBuffer);\r\n            }\r\n            const offsetLocation = this._currentInstanceLocations[i];\r\n            this._gl.vertexAttribDivisor(offsetLocation, 0);\r\n        }\r\n        this._currentInstanceBuffers.length = 0;\r\n        this._currentInstanceLocations.length = 0;\r\n    }\r\n\r\n    /**\r\n     * Release and free the memory of a vertex array object\r\n     * @param vao defines the vertex array object to delete\r\n     */\r\n    public releaseVertexArrayObject(vao: WebGLVertexArrayObject) {\r\n        this._gl.deleteVertexArray(vao);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _releaseBuffer(buffer: DataBuffer): boolean {\r\n        buffer.references--;\r\n\r\n        if (buffer.references === 0) {\r\n            this._deleteBuffer(buffer);\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    protected _deleteBuffer(buffer: DataBuffer): void {\r\n        this._gl.deleteBuffer(buffer.underlyingResource);\r\n    }\r\n\r\n    /**\r\n     * Update the content of a webGL buffer used with instantiation and bind it to the webGL context\r\n     * @param instancesBuffer defines the webGL buffer to update and bind\r\n     * @param data defines the data to store in the buffer\r\n     * @param offsetLocations defines the offsets or attributes information used to determine where data must be stored in the buffer\r\n     */\r\n    public updateAndBindInstancesBuffer(instancesBuffer: DataBuffer, data: Float32Array, offsetLocations: number[] | InstancingAttributeInfo[]): void {\r\n        this.bindArrayBuffer(instancesBuffer);\r\n        if (data) {\r\n            this._gl.bufferSubData(this._gl.ARRAY_BUFFER, 0, data);\r\n        }\r\n\r\n        if ((<any>offsetLocations[0]).index !== undefined) {\r\n            this.bindInstancesBuffer(instancesBuffer, offsetLocations as any, true);\r\n        } else {\r\n            for (let index = 0; index < 4; index++) {\r\n                const offsetLocation = <number>offsetLocations[index];\r\n\r\n                if (!this._vertexAttribArraysEnabled[offsetLocation]) {\r\n                    this._gl.enableVertexAttribArray(offsetLocation);\r\n                    this._vertexAttribArraysEnabled[offsetLocation] = true;\r\n                }\r\n\r\n                this._vertexAttribPointer(instancesBuffer, offsetLocation, 4, this._gl.FLOAT, false, 64, index * 16);\r\n                this._gl.vertexAttribDivisor(offsetLocation, 1);\r\n                this._currentInstanceLocations.push(offsetLocation);\r\n                this._currentInstanceBuffers.push(instancesBuffer);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Bind the content of a webGL buffer used with instantiation\r\n     * @param instancesBuffer defines the webGL buffer to bind\r\n     * @param attributesInfo defines the offsets or attributes information used to determine where data must be stored in the buffer\r\n     * @param computeStride defines Whether to compute the strides from the info or use the default 0\r\n     */\r\n    public bindInstancesBuffer(instancesBuffer: DataBuffer, attributesInfo: InstancingAttributeInfo[], computeStride = true): void {\r\n        this.bindArrayBuffer(instancesBuffer);\r\n\r\n        let stride = 0;\r\n        if (computeStride) {\r\n            for (let i = 0; i < attributesInfo.length; i++) {\r\n                const ai = attributesInfo[i];\r\n                stride += ai.attributeSize * 4;\r\n            }\r\n        }\r\n\r\n        for (let i = 0; i < attributesInfo.length; i++) {\r\n            const ai = attributesInfo[i];\r\n            if (ai.index === undefined) {\r\n                ai.index = this._currentEffect!.getAttributeLocationByName(ai.attributeName);\r\n            }\r\n\r\n            if (ai.index < 0) {\r\n                continue;\r\n            }\r\n\r\n            if (!this._vertexAttribArraysEnabled[ai.index]) {\r\n                this._gl.enableVertexAttribArray(ai.index);\r\n                this._vertexAttribArraysEnabled[ai.index] = true;\r\n            }\r\n\r\n            this._vertexAttribPointer(instancesBuffer, ai.index, ai.attributeSize, ai.attributeType || this._gl.FLOAT, ai.normalized || false, stride, ai.offset);\r\n            this._gl.vertexAttribDivisor(ai.index, ai.divisor === undefined ? 1 : ai.divisor);\r\n            this._currentInstanceLocations.push(ai.index);\r\n            this._currentInstanceBuffers.push(instancesBuffer);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Disable the instance attribute corresponding to the name in parameter\r\n     * @param name defines the name of the attribute to disable\r\n     */\r\n    public disableInstanceAttributeByName(name: string) {\r\n        if (!this._currentEffect) {\r\n            return;\r\n        }\r\n\r\n        const attributeLocation = this._currentEffect.getAttributeLocationByName(name);\r\n        this.disableInstanceAttribute(attributeLocation);\r\n    }\r\n\r\n    /**\r\n     * Disable the instance attribute corresponding to the location in parameter\r\n     * @param attributeLocation defines the attribute location of the attribute to disable\r\n     */\r\n    public disableInstanceAttribute(attributeLocation: number) {\r\n        let shouldClean = false;\r\n        let index: number;\r\n        while ((index = this._currentInstanceLocations.indexOf(attributeLocation)) !== -1) {\r\n            this._currentInstanceLocations.splice(index, 1);\r\n            this._currentInstanceBuffers.splice(index, 1);\r\n\r\n            shouldClean = true;\r\n            index = this._currentInstanceLocations.indexOf(attributeLocation);\r\n        }\r\n\r\n        if (shouldClean) {\r\n            this._gl.vertexAttribDivisor(attributeLocation, 0);\r\n            this.disableAttributeByIndex(attributeLocation);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Disable the attribute corresponding to the location in parameter\r\n     * @param attributeLocation defines the attribute location of the attribute to disable\r\n     */\r\n    public disableAttributeByIndex(attributeLocation: number) {\r\n        this._gl.disableVertexAttribArray(attributeLocation);\r\n        this._vertexAttribArraysEnabled[attributeLocation] = false;\r\n        this._currentBufferPointers[attributeLocation].active = false;\r\n    }\r\n\r\n    /**\r\n     * Send a draw order\r\n     * @param useTriangles defines if triangles must be used to draw (else wireframe will be used)\r\n     * @param indexStart defines the starting index\r\n     * @param indexCount defines the number of index to draw\r\n     * @param instancesCount defines the number of instances to draw (if instantiation is enabled)\r\n     */\r\n    public draw(useTriangles: boolean, indexStart: number, indexCount: number, instancesCount?: number): void {\r\n        this.drawElementsType(useTriangles ? Constants.MATERIAL_TriangleFillMode : Constants.MATERIAL_WireFrameFillMode, indexStart, indexCount, instancesCount);\r\n    }\r\n\r\n    /**\r\n     * Draw a list of points\r\n     * @param verticesStart defines the index of first vertex to draw\r\n     * @param verticesCount defines the count of vertices to draw\r\n     * @param instancesCount defines the number of instances to draw (if instantiation is enabled)\r\n     */\r\n    public drawPointClouds(verticesStart: number, verticesCount: number, instancesCount?: number): void {\r\n        this.drawArraysType(Constants.MATERIAL_PointFillMode, verticesStart, verticesCount, instancesCount);\r\n    }\r\n\r\n    /**\r\n     * Draw a list of unindexed primitives\r\n     * @param useTriangles defines if triangles must be used to draw (else wireframe will be used)\r\n     * @param verticesStart defines the index of first vertex to draw\r\n     * @param verticesCount defines the count of vertices to draw\r\n     * @param instancesCount defines the number of instances to draw (if instantiation is enabled)\r\n     */\r\n    public drawUnIndexed(useTriangles: boolean, verticesStart: number, verticesCount: number, instancesCount?: number): void {\r\n        this.drawArraysType(useTriangles ? Constants.MATERIAL_TriangleFillMode : Constants.MATERIAL_WireFrameFillMode, verticesStart, verticesCount, instancesCount);\r\n    }\r\n\r\n    /**\r\n     * Draw a list of indexed primitives\r\n     * @param fillMode defines the primitive to use\r\n     * @param indexStart defines the starting index\r\n     * @param indexCount defines the number of index to draw\r\n     * @param instancesCount defines the number of instances to draw (if instantiation is enabled)\r\n     */\r\n    public drawElementsType(fillMode: number, indexStart: number, indexCount: number, instancesCount?: number): void {\r\n        // Apply states\r\n        this.applyStates();\r\n\r\n        this._reportDrawCall();\r\n\r\n        // Render\r\n\r\n        const drawMode = this._drawMode(fillMode);\r\n        const indexFormat = this._uintIndicesCurrentlySet ? this._gl.UNSIGNED_INT : this._gl.UNSIGNED_SHORT;\r\n        const mult = this._uintIndicesCurrentlySet ? 4 : 2;\r\n        if (instancesCount) {\r\n            this._gl.drawElementsInstanced(drawMode, indexCount, indexFormat, indexStart * mult, instancesCount);\r\n        } else {\r\n            this._gl.drawElements(drawMode, indexCount, indexFormat, indexStart * mult);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Draw a list of unindexed primitives\r\n     * @param fillMode defines the primitive to use\r\n     * @param verticesStart defines the index of first vertex to draw\r\n     * @param verticesCount defines the count of vertices to draw\r\n     * @param instancesCount defines the number of instances to draw (if instantiation is enabled)\r\n     */\r\n    public drawArraysType(fillMode: number, verticesStart: number, verticesCount: number, instancesCount?: number): void {\r\n        // Apply states\r\n        this.applyStates();\r\n\r\n        this._reportDrawCall();\r\n\r\n        const drawMode = this._drawMode(fillMode);\r\n        if (instancesCount) {\r\n            this._gl.drawArraysInstanced(drawMode, verticesStart, verticesCount, instancesCount);\r\n        } else {\r\n            this._gl.drawArrays(drawMode, verticesStart, verticesCount);\r\n        }\r\n    }\r\n\r\n    private _drawMode(fillMode: number): number {\r\n        switch (fillMode) {\r\n            // Triangle views\r\n            case Constants.MATERIAL_TriangleFillMode:\r\n                return this._gl.TRIANGLES;\r\n            case Constants.MATERIAL_PointFillMode:\r\n                return this._gl.POINTS;\r\n            case Constants.MATERIAL_WireFrameFillMode:\r\n                return this._gl.LINES;\r\n            // Draw modes\r\n            case Constants.MATERIAL_PointListDrawMode:\r\n                return this._gl.POINTS;\r\n            case Constants.MATERIAL_LineListDrawMode:\r\n                return this._gl.LINES;\r\n            case Constants.MATERIAL_LineLoopDrawMode:\r\n                return this._gl.LINE_LOOP;\r\n            case Constants.MATERIAL_LineStripDrawMode:\r\n                return this._gl.LINE_STRIP;\r\n            case Constants.MATERIAL_TriangleStripDrawMode:\r\n                return this._gl.TRIANGLE_STRIP;\r\n            case Constants.MATERIAL_TriangleFanDrawMode:\r\n                return this._gl.TRIANGLE_FAN;\r\n            default:\r\n                return this._gl.TRIANGLES;\r\n        }\r\n    }\r\n\r\n    // Shaders\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _releaseEffect(effect: Effect): void {\r\n        if (this._compiledEffects[effect._key]) {\r\n            delete this._compiledEffects[effect._key];\r\n        }\r\n        const pipelineContext = effect.getPipelineContext();\r\n        if (pipelineContext) {\r\n            this._deletePipelineContext(pipelineContext);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _deletePipelineContext(pipelineContext: IPipelineContext): void {\r\n        const webGLPipelineContext = pipelineContext as WebGLPipelineContext;\r\n        if (webGLPipelineContext && webGLPipelineContext.program) {\r\n            webGLPipelineContext.program.__SPECTOR_rebuildProgram = null;\r\n            resetCachedPipeline(webGLPipelineContext);\r\n            if (this._gl) {\r\n                this._gl.deleteProgram(webGLPipelineContext.program);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public override _getGlobalDefines(defines?: { [key: string]: string }): string | undefined {\r\n        return _getGlobalDefines(defines, this.isNDCHalfZRange, this.useReverseDepthBuffer, this.useExactSrgbConversions);\r\n    }\r\n\r\n    /**\r\n     * Create a new effect (used to store vertex/fragment shaders)\r\n     * @param baseName defines the base name of the effect (The name of file without .fragment.fx or .vertex.fx)\r\n     * @param attributesNamesOrOptions defines either a list of attribute names or an IEffectCreationOptions object\r\n     * @param uniformsNamesOrEngine defines either a list of uniform names or the engine to use\r\n     * @param samplers defines an array of string used to represent textures\r\n     * @param defines defines the string containing the defines to use to compile the shaders\r\n     * @param fallbacks defines the list of potential fallbacks to use if shader compilation fails\r\n     * @param onCompiled defines a function to call when the effect creation is successful\r\n     * @param onError defines a function to call when the effect creation has failed\r\n     * @param indexParameters defines an object containing the index values to use to compile shaders (like the maximum number of simultaneous lights)\r\n     * @param shaderLanguage the language the shader is written in (default: GLSL)\r\n     * @param extraInitializationsAsync additional async code to run before preparing the effect\r\n     * @returns the new Effect\r\n     */\r\n    public createEffect(\r\n        baseName: string | (IShaderPath & { vertexToken?: string; fragmentToken?: string }),\r\n        attributesNamesOrOptions: string[] | IEffectCreationOptions,\r\n        uniformsNamesOrEngine: string[] | ThinEngine,\r\n        samplers?: string[],\r\n        defines?: string,\r\n        fallbacks?: IEffectFallbacks,\r\n        onCompiled?: Nullable<(effect: Effect) => void>,\r\n        onError?: Nullable<(effect: Effect, errors: string) => void>,\r\n        indexParameters?: any,\r\n        shaderLanguage = ShaderLanguage.GLSL,\r\n        extraInitializationsAsync?: () => Promise<void>\r\n    ): Effect {\r\n        const vertex = typeof baseName === \"string\" ? baseName : baseName.vertexToken || baseName.vertexSource || baseName.vertexElement || baseName.vertex;\r\n        const fragment = typeof baseName === \"string\" ? baseName : baseName.fragmentToken || baseName.fragmentSource || baseName.fragmentElement || baseName.fragment;\r\n        const globalDefines = this._getGlobalDefines()!;\r\n\r\n        const isOptions = (attributesNamesOrOptions as IEffectCreationOptions).attributes !== undefined;\r\n\r\n        let fullDefines = defines ?? (<IEffectCreationOptions>attributesNamesOrOptions).defines ?? \"\";\r\n\r\n        if (globalDefines) {\r\n            fullDefines += globalDefines;\r\n        }\r\n\r\n        const name = vertex + \"+\" + fragment + \"@\" + fullDefines;\r\n        if (this._compiledEffects[name]) {\r\n            const compiledEffect = <Effect>this._compiledEffects[name];\r\n            if (onCompiled && compiledEffect.isReady()) {\r\n                onCompiled(compiledEffect);\r\n            }\r\n            compiledEffect._refCount++;\r\n            return compiledEffect;\r\n        }\r\n        if (this._gl) {\r\n            getStateObject(this._gl);\r\n        }\r\n        const effect = new Effect(\r\n            baseName,\r\n            attributesNamesOrOptions,\r\n            isOptions ? this : uniformsNamesOrEngine,\r\n            samplers,\r\n            this,\r\n            defines,\r\n            fallbacks,\r\n            onCompiled,\r\n            onError,\r\n            indexParameters,\r\n            name,\r\n            (<IEffectCreationOptions>attributesNamesOrOptions).shaderLanguage ?? shaderLanguage,\r\n            (<IEffectCreationOptions>attributesNamesOrOptions).extraInitializationsAsync ?? extraInitializationsAsync\r\n        );\r\n        this._compiledEffects[name] = effect;\r\n\r\n        return effect;\r\n    }\r\n\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    protected static _ConcatenateShader = _ConcatenateShader;\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _getShaderSource(shader: WebGLShader): Nullable<string> {\r\n        return this._gl.getShaderSource(shader);\r\n    }\r\n\r\n    /**\r\n     * Directly creates a webGL program\r\n     * @param pipelineContext  defines the pipeline context to attach to\r\n     * @param vertexCode defines the vertex shader code to use\r\n     * @param fragmentCode defines the fragment shader code to use\r\n     * @param context defines the webGL context to use (if not set, the current one will be used)\r\n     * @param transformFeedbackVaryings defines the list of transform feedback varyings to use\r\n     * @returns the new webGL program\r\n     */\r\n    public createRawShaderProgram(\r\n        pipelineContext: IPipelineContext,\r\n        vertexCode: string,\r\n        fragmentCode: string,\r\n        context?: WebGLRenderingContext,\r\n        transformFeedbackVaryings: Nullable<string[]> = null\r\n    ): WebGLProgram {\r\n        const stateObject = getStateObject(this._gl);\r\n        stateObject._contextWasLost = this._contextWasLost;\r\n        stateObject.validateShaderPrograms = this.validateShaderPrograms;\r\n        return createRawShaderProgram(pipelineContext, vertexCode, fragmentCode, context || this._gl, transformFeedbackVaryings);\r\n    }\r\n\r\n    /**\r\n     * Creates a webGL program\r\n     * @param pipelineContext  defines the pipeline context to attach to\r\n     * @param vertexCode  defines the vertex shader code to use\r\n     * @param fragmentCode defines the fragment shader code to use\r\n     * @param defines defines the string containing the defines to use to compile the shaders\r\n     * @param context defines the webGL context to use (if not set, the current one will be used)\r\n     * @param transformFeedbackVaryings defines the list of transform feedback varyings to use\r\n     * @returns the new webGL program\r\n     */\r\n    public createShaderProgram(\r\n        pipelineContext: IPipelineContext,\r\n        vertexCode: string,\r\n        fragmentCode: string,\r\n        defines: Nullable<string>,\r\n        context?: WebGLRenderingContext,\r\n        transformFeedbackVaryings: Nullable<string[]> = null\r\n    ): WebGLProgram {\r\n        const stateObject = getStateObject(this._gl);\r\n        // assure the state object is correct\r\n        stateObject._contextWasLost = this._contextWasLost;\r\n        stateObject.validateShaderPrograms = this.validateShaderPrograms;\r\n        return createShaderProgram(pipelineContext, vertexCode, fragmentCode, defines, context || this._gl, transformFeedbackVaryings);\r\n    }\r\n\r\n    /**\r\n     * Inline functions in shader code that are marked to be inlined\r\n     * @param code code to inline\r\n     * @returns inlined code\r\n     */\r\n    public inlineShaderCode(code: string): string {\r\n        // no inlining needed in the WebGL engine\r\n        return code;\r\n    }\r\n\r\n    /**\r\n     * Creates a new pipeline context\r\n     * @param shaderProcessingContext defines the shader processing context used during the processing if available\r\n     * @returns the new pipeline\r\n     */\r\n    public createPipelineContext(shaderProcessingContext: Nullable<ShaderProcessingContext>): IPipelineContext {\r\n        if (this._gl) {\r\n            const stateObject = getStateObject(this._gl);\r\n            stateObject.parallelShaderCompile = this._caps.parallelShaderCompile;\r\n        }\r\n        const context = createPipelineContext(this._gl, shaderProcessingContext) as WebGLPipelineContext;\r\n        context.engine = this;\r\n        return context;\r\n    }\r\n\r\n    /**\r\n     * Creates a new material context\r\n     * @returns the new context\r\n     */\r\n    public createMaterialContext(): IMaterialContext | undefined {\r\n        return undefined;\r\n    }\r\n\r\n    /**\r\n     * Creates a new draw context\r\n     * @returns the new context\r\n     */\r\n    public createDrawContext(): IDrawContext | undefined {\r\n        return undefined;\r\n    }\r\n\r\n    protected _finalizePipelineContext(pipelineContext: WebGLPipelineContext) {\r\n        return _finalizePipelineContext(pipelineContext, this._gl, this.validateShaderPrograms);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _preparePipelineContext(\r\n        pipelineContext: IPipelineContext,\r\n        vertexSourceCode: string,\r\n        fragmentSourceCode: string,\r\n        createAsRaw: boolean,\r\n        rawVertexSourceCode: string,\r\n        rawFragmentSourceCode: string,\r\n        rebuildRebind: any,\r\n        defines: Nullable<string>,\r\n        transformFeedbackVaryings: Nullable<string[]>,\r\n        key: string,\r\n        onReady: () => void\r\n    ) {\r\n        const stateObject = getStateObject(this._gl);\r\n        stateObject._contextWasLost = this._contextWasLost;\r\n        stateObject.validateShaderPrograms = this.validateShaderPrograms;\r\n        stateObject._createShaderProgramInjection = this._createShaderProgram.bind(this);\r\n        stateObject.createRawShaderProgramInjection = this.createRawShaderProgram.bind(this);\r\n        stateObject.createShaderProgramInjection = this.createShaderProgram.bind(this);\r\n        stateObject.loadFileInjection = this._loadFile.bind(this);\r\n        return _preparePipelineContext(\r\n            pipelineContext as WebGLPipelineContext,\r\n            vertexSourceCode,\r\n            fragmentSourceCode,\r\n            createAsRaw,\r\n            rawVertexSourceCode,\r\n            rawFragmentSourceCode,\r\n            rebuildRebind,\r\n            defines,\r\n            transformFeedbackVaryings,\r\n            key,\r\n            onReady\r\n        );\r\n    }\r\n\r\n    protected _createShaderProgram(\r\n        pipelineContext: WebGLPipelineContext,\r\n        vertexShader: WebGLShader,\r\n        fragmentShader: WebGLShader,\r\n        context: WebGLRenderingContext,\r\n        transformFeedbackVaryings: Nullable<string[]> = null\r\n    ): WebGLProgram {\r\n        return _createShaderProgram(pipelineContext as WebGLPipelineContext, vertexShader, fragmentShader, context, transformFeedbackVaryings);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _isRenderingStateCompiled(pipelineContext: IPipelineContext): boolean {\r\n        if (this._isDisposed) {\r\n            return false;\r\n        }\r\n        return _isRenderingStateCompiled(pipelineContext, this._gl, this.validateShaderPrograms);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _executeWhenRenderingStateIsCompiled(pipelineContext: IPipelineContext, action: () => void) {\r\n        _executeWhenRenderingStateIsCompiled(pipelineContext as WebGLPipelineContext, action);\r\n    }\r\n\r\n    /**\r\n     * Gets the list of webGL uniform locations associated with a specific program based on a list of uniform names\r\n     * @param pipelineContext defines the pipeline context to use\r\n     * @param uniformsNames defines the list of uniform names\r\n     * @returns an array of webGL uniform locations\r\n     */\r\n    public getUniforms(pipelineContext: IPipelineContext, uniformsNames: string[]): Nullable<WebGLUniformLocation>[] {\r\n        const results = new Array<Nullable<WebGLUniformLocation>>();\r\n        const webGLPipelineContext = pipelineContext as WebGLPipelineContext;\r\n\r\n        for (let index = 0; index < uniformsNames.length; index++) {\r\n            results.push(this._gl.getUniformLocation(webGLPipelineContext.program!, uniformsNames[index]));\r\n        }\r\n\r\n        return results;\r\n    }\r\n\r\n    /**\r\n     * Gets the list of active attributes for a given webGL program\r\n     * @param pipelineContext defines the pipeline context to use\r\n     * @param attributesNames defines the list of attribute names to get\r\n     * @returns an array of indices indicating the offset of each attribute\r\n     */\r\n    public getAttributes(pipelineContext: IPipelineContext, attributesNames: string[]): number[] {\r\n        const results = [];\r\n        const webGLPipelineContext = pipelineContext as WebGLPipelineContext;\r\n\r\n        for (let index = 0; index < attributesNames.length; index++) {\r\n            try {\r\n                results.push(this._gl.getAttribLocation(webGLPipelineContext.program!, attributesNames[index]));\r\n            } catch (e) {\r\n                results.push(-1);\r\n            }\r\n        }\r\n\r\n        return results;\r\n    }\r\n\r\n    /**\r\n     * Activates an effect, making it the current one (ie. the one used for rendering)\r\n     * @param effect defines the effect to activate\r\n     */\r\n    public enableEffect(effect: Nullable<Effect | DrawWrapper>): void {\r\n        effect = effect !== null && IsWrapper(effect) ? effect.effect : effect; // get only the effect, we don't need a Wrapper in the WebGL engine\r\n\r\n        if (!effect || effect === this._currentEffect) {\r\n            return;\r\n        }\r\n\r\n        this._stencilStateComposer.stencilMaterial = undefined;\r\n\r\n        effect = effect as Effect;\r\n\r\n        // Use program\r\n        this.bindSamplers(effect);\r\n\r\n        this._currentEffect = effect;\r\n\r\n        if (effect.onBind) {\r\n            effect.onBind(effect);\r\n        }\r\n        if (effect._onBindObservable) {\r\n            effect._onBindObservable.notifyObservers(effect);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to a number (int)\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param value defines the int number to store\r\n     * @returns true if the value was set\r\n     */\r\n    public setInt(uniform: Nullable<WebGLUniformLocation>, value: number): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniform1i(uniform, value);\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to a int2\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param x defines the 1st component of the value\r\n     * @param y defines the 2nd component of the value\r\n     * @returns true if the value was set\r\n     */\r\n    public setInt2(uniform: Nullable<WebGLUniformLocation>, x: number, y: number): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniform2i(uniform, x, y);\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to a int3\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param x defines the 1st component of the value\r\n     * @param y defines the 2nd component of the value\r\n     * @param z defines the 3rd component of the value\r\n     * @returns true if the value was set\r\n     */\r\n    public setInt3(uniform: Nullable<WebGLUniformLocation>, x: number, y: number, z: number): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniform3i(uniform, x, y, z);\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to a int4\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param x defines the 1st component of the value\r\n     * @param y defines the 2nd component of the value\r\n     * @param z defines the 3rd component of the value\r\n     * @param w defines the 4th component of the value\r\n     * @returns true if the value was set\r\n     */\r\n    public setInt4(uniform: Nullable<WebGLUniformLocation>, x: number, y: number, z: number, w: number): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniform4i(uniform, x, y, z, w);\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to an array of int32\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param array defines the array of int32 to store\r\n     * @returns true if the value was set\r\n     */\r\n    public setIntArray(uniform: Nullable<WebGLUniformLocation>, array: Int32Array): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniform1iv(uniform, array);\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to an array of int32 (stored as vec2)\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param array defines the array of int32 to store\r\n     * @returns true if the value was set\r\n     */\r\n    public setIntArray2(uniform: Nullable<WebGLUniformLocation>, array: Int32Array): boolean {\r\n        if (!uniform || array.length % 2 !== 0) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniform2iv(uniform, array);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to an array of int32 (stored as vec3)\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param array defines the array of int32 to store\r\n     * @returns true if the value was set\r\n     */\r\n    public setIntArray3(uniform: Nullable<WebGLUniformLocation>, array: Int32Array): boolean {\r\n        if (!uniform || array.length % 3 !== 0) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniform3iv(uniform, array);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to an array of int32 (stored as vec4)\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param array defines the array of int32 to store\r\n     * @returns true if the value was set\r\n     */\r\n    public setIntArray4(uniform: Nullable<WebGLUniformLocation>, array: Int32Array): boolean {\r\n        if (!uniform || array.length % 4 !== 0) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniform4iv(uniform, array);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to a number (unsigned int)\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param value defines the unsigned int number to store\r\n     * @returns true if the value was set\r\n     */\r\n    public setUInt(uniform: Nullable<WebGLUniformLocation>, value: number): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniform1ui(uniform, value);\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to a unsigned int2\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param x defines the 1st component of the value\r\n     * @param y defines the 2nd component of the value\r\n     * @returns true if the value was set\r\n     */\r\n    public setUInt2(uniform: Nullable<WebGLUniformLocation>, x: number, y: number): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniform2ui(uniform, x, y);\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to a unsigned int3\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param x defines the 1st component of the value\r\n     * @param y defines the 2nd component of the value\r\n     * @param z defines the 3rd component of the value\r\n     * @returns true if the value was set\r\n     */\r\n    public setUInt3(uniform: Nullable<WebGLUniformLocation>, x: number, y: number, z: number): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniform3ui(uniform, x, y, z);\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to a unsigned int4\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param x defines the 1st component of the value\r\n     * @param y defines the 2nd component of the value\r\n     * @param z defines the 3rd component of the value\r\n     * @param w defines the 4th component of the value\r\n     * @returns true if the value was set\r\n     */\r\n    public setUInt4(uniform: Nullable<WebGLUniformLocation>, x: number, y: number, z: number, w: number): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniform4ui(uniform, x, y, z, w);\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to an array of unsigned int32\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param array defines the array of unsigned int32 to store\r\n     * @returns true if the value was set\r\n     */\r\n    public setUIntArray(uniform: Nullable<WebGLUniformLocation>, array: Uint32Array): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniform1uiv(uniform, array);\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to an array of unsigned int32 (stored as vec2)\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param array defines the array of unsigned int32 to store\r\n     * @returns true if the value was set\r\n     */\r\n    public setUIntArray2(uniform: Nullable<WebGLUniformLocation>, array: Uint32Array): boolean {\r\n        if (!uniform || array.length % 2 !== 0) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniform2uiv(uniform, array);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to an array of unsigned int32 (stored as vec3)\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param array defines the array of unsigned int32 to store\r\n     * @returns true if the value was set\r\n     */\r\n    public setUIntArray3(uniform: Nullable<WebGLUniformLocation>, array: Uint32Array): boolean {\r\n        if (!uniform || array.length % 3 !== 0) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniform3uiv(uniform, array);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to an array of unsigned int32 (stored as vec4)\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param array defines the array of unsigned int32 to store\r\n     * @returns true if the value was set\r\n     */\r\n    public setUIntArray4(uniform: Nullable<WebGLUniformLocation>, array: Uint32Array): boolean {\r\n        if (!uniform || array.length % 4 !== 0) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniform4uiv(uniform, array);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to an array of number\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param array defines the array of number to store\r\n     * @returns true if the value was set\r\n     */\r\n    public setArray(uniform: Nullable<WebGLUniformLocation>, array: FloatArray): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        if (array.length < 1) {\r\n            return false;\r\n        }\r\n        this._gl.uniform1fv(uniform, array);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to an array of number (stored as vec2)\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param array defines the array of number to store\r\n     * @returns true if the value was set\r\n     */\r\n    public setArray2(uniform: Nullable<WebGLUniformLocation>, array: FloatArray): boolean {\r\n        if (!uniform || array.length % 2 !== 0) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniform2fv(uniform, <any>array);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to an array of number (stored as vec3)\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param array defines the array of number to store\r\n     * @returns true if the value was set\r\n     */\r\n    public setArray3(uniform: Nullable<WebGLUniformLocation>, array: FloatArray): boolean {\r\n        if (!uniform || array.length % 3 !== 0) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniform3fv(uniform, <any>array);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to an array of number (stored as vec4)\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param array defines the array of number to store\r\n     * @returns true if the value was set\r\n     */\r\n    public setArray4(uniform: Nullable<WebGLUniformLocation>, array: FloatArray): boolean {\r\n        if (!uniform || array.length % 4 !== 0) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniform4fv(uniform, <any>array);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to an array of float32 (stored as matrices)\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param matrices defines the array of float32 to store\r\n     * @returns true if the value was set\r\n     */\r\n    public setMatrices(uniform: Nullable<WebGLUniformLocation>, matrices: DeepImmutable<FloatArray>): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniformMatrix4fv(uniform, false, matrices);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to a matrix (3x3)\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param matrix defines the Float32Array representing the 3x3 matrix to store\r\n     * @returns true if the value was set\r\n     */\r\n    public setMatrix3x3(uniform: Nullable<WebGLUniformLocation>, matrix: Float32Array): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniformMatrix3fv(uniform, false, matrix);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to a matrix (2x2)\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param matrix defines the Float32Array representing the 2x2 matrix to store\r\n     * @returns true if the value was set\r\n     */\r\n    public setMatrix2x2(uniform: Nullable<WebGLUniformLocation>, matrix: Float32Array): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniformMatrix2fv(uniform, false, matrix);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to a number (float)\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param value defines the float number to store\r\n     * @returns true if the value was transferred\r\n     */\r\n    public setFloat(uniform: Nullable<WebGLUniformLocation>, value: number): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniform1f(uniform, value);\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to a vec2\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param x defines the 1st component of the value\r\n     * @param y defines the 2nd component of the value\r\n     * @returns true if the value was set\r\n     */\r\n    public setFloat2(uniform: Nullable<WebGLUniformLocation>, x: number, y: number): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniform2f(uniform, x, y);\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to a vec3\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param x defines the 1st component of the value\r\n     * @param y defines the 2nd component of the value\r\n     * @param z defines the 3rd component of the value\r\n     * @returns true if the value was set\r\n     */\r\n    public setFloat3(uniform: Nullable<WebGLUniformLocation>, x: number, y: number, z: number): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniform3f(uniform, x, y, z);\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set the value of an uniform to a vec4\r\n     * @param uniform defines the webGL uniform location where to store the value\r\n     * @param x defines the 1st component of the value\r\n     * @param y defines the 2nd component of the value\r\n     * @param z defines the 3rd component of the value\r\n     * @param w defines the 4th component of the value\r\n     * @returns true if the value was set\r\n     */\r\n    public setFloat4(uniform: Nullable<WebGLUniformLocation>, x: number, y: number, z: number, w: number): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._gl.uniform4f(uniform, x, y, z, w);\r\n\r\n        return true;\r\n    }\r\n\r\n    // States\r\n\r\n    /**\r\n     * Apply all cached states (depth, culling, stencil and alpha)\r\n     */\r\n    public applyStates() {\r\n        this._depthCullingState.apply(this._gl);\r\n        this._stencilStateComposer.apply(this._gl);\r\n        this._alphaState.apply(this._gl);\r\n\r\n        if (this._colorWriteChanged) {\r\n            this._colorWriteChanged = false;\r\n            const enable = this._colorWrite;\r\n            this._gl.colorMask(enable, enable, enable, enable);\r\n        }\r\n    }\r\n\r\n    // Textures\r\n\r\n    /**\r\n     * Force the entire cache to be cleared\r\n     * You should not have to use this function unless your engine needs to share the webGL context with another engine\r\n     * @param bruteForce defines a boolean to force clearing ALL caches (including stencil, detoh and alpha states)\r\n     */\r\n    public wipeCaches(bruteForce?: boolean): void {\r\n        if (this.preventCacheWipeBetweenFrames && !bruteForce) {\r\n            return;\r\n        }\r\n        this._currentEffect = null;\r\n        this._viewportCached.x = 0;\r\n        this._viewportCached.y = 0;\r\n        this._viewportCached.z = 0;\r\n        this._viewportCached.w = 0;\r\n\r\n        // Done before in case we clean the attributes\r\n        this._unbindVertexArrayObject();\r\n\r\n        if (bruteForce) {\r\n            this._currentProgram = null;\r\n            this.resetTextureCache();\r\n\r\n            this._stencilStateComposer.reset();\r\n\r\n            this._depthCullingState.reset();\r\n            this._depthCullingState.depthFunc = this._gl.LEQUAL;\r\n\r\n            this._alphaState.reset();\r\n            this._alphaMode = Constants.ALPHA_ADD;\r\n            this._alphaEquation = Constants.ALPHA_DISABLE;\r\n\r\n            this._colorWrite = true;\r\n            this._colorWriteChanged = true;\r\n\r\n            this._unpackFlipYCached = null;\r\n\r\n            this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL, this._gl.NONE);\r\n            this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, 0);\r\n\r\n            this._mustWipeVertexAttributes = true;\r\n            this.unbindAllAttributes();\r\n        }\r\n\r\n        this._resetVertexBufferBinding();\r\n        this._cachedIndexBuffer = null;\r\n        this._cachedEffectForVertexBuffers = null;\r\n        this.bindIndexBuffer(null);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _getSamplingParameters(samplingMode: number, generateMipMaps: boolean): { min: number; mag: number } {\r\n        const gl = this._gl;\r\n        let magFilter: GLenum = gl.NEAREST;\r\n        let minFilter: GLenum = gl.NEAREST;\r\n\r\n        switch (samplingMode) {\r\n            case Constants.TEXTURE_LINEAR_LINEAR_MIPNEAREST:\r\n                magFilter = gl.LINEAR;\r\n                if (generateMipMaps) {\r\n                    minFilter = gl.LINEAR_MIPMAP_NEAREST;\r\n                } else {\r\n                    minFilter = gl.LINEAR;\r\n                }\r\n                break;\r\n            case Constants.TEXTURE_LINEAR_LINEAR_MIPLINEAR:\r\n                magFilter = gl.LINEAR;\r\n                if (generateMipMaps) {\r\n                    minFilter = gl.LINEAR_MIPMAP_LINEAR;\r\n                } else {\r\n                    minFilter = gl.LINEAR;\r\n                }\r\n                break;\r\n            case Constants.TEXTURE_NEAREST_NEAREST_MIPLINEAR:\r\n                magFilter = gl.NEAREST;\r\n                if (generateMipMaps) {\r\n                    minFilter = gl.NEAREST_MIPMAP_LINEAR;\r\n                } else {\r\n                    minFilter = gl.NEAREST;\r\n                }\r\n                break;\r\n            case Constants.TEXTURE_NEAREST_NEAREST_MIPNEAREST:\r\n                magFilter = gl.NEAREST;\r\n                if (generateMipMaps) {\r\n                    minFilter = gl.NEAREST_MIPMAP_NEAREST;\r\n                } else {\r\n                    minFilter = gl.NEAREST;\r\n                }\r\n                break;\r\n            case Constants.TEXTURE_NEAREST_LINEAR_MIPNEAREST:\r\n                magFilter = gl.NEAREST;\r\n                if (generateMipMaps) {\r\n                    minFilter = gl.LINEAR_MIPMAP_NEAREST;\r\n                } else {\r\n                    minFilter = gl.LINEAR;\r\n                }\r\n                break;\r\n            case Constants.TEXTURE_NEAREST_LINEAR_MIPLINEAR:\r\n                magFilter = gl.NEAREST;\r\n                if (generateMipMaps) {\r\n                    minFilter = gl.LINEAR_MIPMAP_LINEAR;\r\n                } else {\r\n                    minFilter = gl.LINEAR;\r\n                }\r\n                break;\r\n            case Constants.TEXTURE_NEAREST_LINEAR:\r\n                magFilter = gl.NEAREST;\r\n                minFilter = gl.LINEAR;\r\n                break;\r\n            case Constants.TEXTURE_NEAREST_NEAREST:\r\n                magFilter = gl.NEAREST;\r\n                minFilter = gl.NEAREST;\r\n                break;\r\n            case Constants.TEXTURE_LINEAR_NEAREST_MIPNEAREST:\r\n                magFilter = gl.LINEAR;\r\n                if (generateMipMaps) {\r\n                    minFilter = gl.NEAREST_MIPMAP_NEAREST;\r\n                } else {\r\n                    minFilter = gl.NEAREST;\r\n                }\r\n                break;\r\n            case Constants.TEXTURE_LINEAR_NEAREST_MIPLINEAR:\r\n                magFilter = gl.LINEAR;\r\n                if (generateMipMaps) {\r\n                    minFilter = gl.NEAREST_MIPMAP_LINEAR;\r\n                } else {\r\n                    minFilter = gl.NEAREST;\r\n                }\r\n                break;\r\n            case Constants.TEXTURE_LINEAR_LINEAR:\r\n                magFilter = gl.LINEAR;\r\n                minFilter = gl.LINEAR;\r\n                break;\r\n            case Constants.TEXTURE_LINEAR_NEAREST:\r\n                magFilter = gl.LINEAR;\r\n                minFilter = gl.NEAREST;\r\n                break;\r\n        }\r\n\r\n        return {\r\n            min: minFilter,\r\n            mag: magFilter,\r\n        };\r\n    }\r\n\r\n    /** @internal */\r\n    protected _createTexture(): WebGLTexture {\r\n        const texture = this._gl.createTexture();\r\n\r\n        if (!texture) {\r\n            throw new Error(\"Unable to create texture\");\r\n        }\r\n\r\n        return texture;\r\n    }\r\n\r\n    /** @internal */\r\n    public _createHardwareTexture(): HardwareTextureWrapper {\r\n        return new WebGLHardwareTexture(this._createTexture(), this._gl);\r\n    }\r\n\r\n    /**\r\n     * Creates an internal texture without binding it to a framebuffer\r\n     * @internal\r\n     * @param size defines the size of the texture\r\n     * @param options defines the options used to create the texture\r\n     * @param delayGPUTextureCreation true to delay the texture creation the first time it is really needed. false to create it right away\r\n     * @param source source type of the texture\r\n     * @returns a new internal texture\r\n     */\r\n    public _createInternalTexture(\r\n        size: TextureSize,\r\n        options: boolean | InternalTextureCreationOptions,\r\n        delayGPUTextureCreation = true,\r\n        source = InternalTextureSource.Unknown\r\n    ): InternalTexture {\r\n        let generateMipMaps = false;\r\n        let createMipMaps = false;\r\n        let type = Constants.TEXTURETYPE_UNSIGNED_BYTE;\r\n        let samplingMode = Constants.TEXTURE_TRILINEAR_SAMPLINGMODE;\r\n        let format = Constants.TEXTUREFORMAT_RGBA;\r\n        let useSRGBBuffer = false;\r\n        let samples = 1;\r\n        let label: string | undefined;\r\n        let createMSAATexture = false;\r\n        let comparisonFunction = 0;\r\n        if (options !== undefined && typeof options === \"object\") {\r\n            generateMipMaps = !!options.generateMipMaps;\r\n            createMipMaps = !!options.createMipMaps;\r\n            type = options.type === undefined ? Constants.TEXTURETYPE_UNSIGNED_BYTE : options.type;\r\n            samplingMode = options.samplingMode === undefined ? Constants.TEXTURE_TRILINEAR_SAMPLINGMODE : options.samplingMode;\r\n            format = options.format === undefined ? Constants.TEXTUREFORMAT_RGBA : options.format;\r\n            useSRGBBuffer = options.useSRGBBuffer === undefined ? false : options.useSRGBBuffer;\r\n            samples = options.samples ?? 1;\r\n            label = options.label;\r\n            createMSAATexture = !!options.createMSAATexture;\r\n            comparisonFunction = options.comparisonFunction || 0;\r\n        } else {\r\n            generateMipMaps = !!options;\r\n        }\r\n\r\n        useSRGBBuffer &&= this._caps.supportSRGBBuffers && (this.webGLVersion > 1 || this.isWebGPU);\r\n\r\n        if (type === Constants.TEXTURETYPE_FLOAT && !this._caps.textureFloatLinearFiltering) {\r\n            // if floating point linear (gl.FLOAT) then force to NEAREST_SAMPLINGMODE\r\n            samplingMode = Constants.TEXTURE_NEAREST_SAMPLINGMODE;\r\n        } else if (type === Constants.TEXTURETYPE_HALF_FLOAT && !this._caps.textureHalfFloatLinearFiltering) {\r\n            // if floating point linear (HALF_FLOAT) then force to NEAREST_SAMPLINGMODE\r\n            samplingMode = Constants.TEXTURE_NEAREST_SAMPLINGMODE;\r\n        }\r\n        if (type === Constants.TEXTURETYPE_FLOAT && !this._caps.textureFloat) {\r\n            type = Constants.TEXTURETYPE_UNSIGNED_BYTE;\r\n            Logger.Warn(\"Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE\");\r\n        }\r\n\r\n        const isDepthTexture = IsDepthTexture(format);\r\n        const hasStencil = HasStencilAspect(format);\r\n\r\n        const gl = this._gl;\r\n        const texture = new InternalTexture(this, source);\r\n        const width = (<{ width: number; height: number; depth?: number; layers?: number }>size).width || <number>size;\r\n        const height = (<{ width: number; height: number; depth?: number; layers?: number }>size).height || <number>size;\r\n        const depth = (<{ width: number; height: number; depth?: number; layers?: number }>size).depth || 0;\r\n        const layers = (<{ width: number; height: number; depth?: number; layers?: number }>size).layers || 0;\r\n        const filters = this._getSamplingParameters(samplingMode, (generateMipMaps || createMipMaps) && !isDepthTexture);\r\n        const target = layers !== 0 ? gl.TEXTURE_2D_ARRAY : depth !== 0 ? gl.TEXTURE_3D : gl.TEXTURE_2D;\r\n        const sizedFormat = isDepthTexture\r\n            ? this._getInternalFormatFromDepthTextureFormat(format, true, hasStencil)\r\n            : this._getRGBABufferInternalSizedFormat(type, format, useSRGBBuffer);\r\n        const internalFormat = isDepthTexture ? (hasStencil ? gl.DEPTH_STENCIL : gl.DEPTH_COMPONENT) : this._getInternalFormat(format);\r\n        const textureType = isDepthTexture ? this._getWebGLTextureTypeFromDepthTextureFormat(format) : this._getWebGLTextureType(type);\r\n\r\n        // Bind\r\n        this._bindTextureDirectly(target, texture);\r\n\r\n        if (layers !== 0) {\r\n            texture.is2DArray = true;\r\n            gl.texImage3D(target, 0, sizedFormat, width, height, layers, 0, internalFormat, textureType, null);\r\n        } else if (depth !== 0) {\r\n            texture.is3D = true;\r\n            gl.texImage3D(target, 0, sizedFormat, width, height, depth, 0, internalFormat, textureType, null);\r\n        } else {\r\n            gl.texImage2D(target, 0, sizedFormat, width, height, 0, internalFormat, textureType, null);\r\n        }\r\n\r\n        gl.texParameteri(target, gl.TEXTURE_MAG_FILTER, filters.mag);\r\n        gl.texParameteri(target, gl.TEXTURE_MIN_FILTER, filters.min);\r\n        gl.texParameteri(target, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n        gl.texParameteri(target, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n\r\n        if (isDepthTexture && this.webGLVersion > 1) {\r\n            if (comparisonFunction === 0) {\r\n                gl.texParameteri(target, gl.TEXTURE_COMPARE_FUNC, Constants.LEQUAL);\r\n                gl.texParameteri(target, gl.TEXTURE_COMPARE_MODE, gl.NONE);\r\n            } else {\r\n                gl.texParameteri(target, gl.TEXTURE_COMPARE_FUNC, comparisonFunction);\r\n                gl.texParameteri(target, gl.TEXTURE_COMPARE_MODE, gl.COMPARE_REF_TO_TEXTURE);\r\n            }\r\n        }\r\n\r\n        // MipMaps\r\n        if (generateMipMaps || createMipMaps) {\r\n            this._gl.generateMipmap(target);\r\n        }\r\n\r\n        this._bindTextureDirectly(target, null);\r\n\r\n        texture._useSRGBBuffer = useSRGBBuffer;\r\n        texture.baseWidth = width;\r\n        texture.baseHeight = height;\r\n        texture.width = width;\r\n        texture.height = height;\r\n        texture.depth = layers || depth;\r\n        texture.isReady = true;\r\n        texture.samples = samples;\r\n        texture.generateMipMaps = generateMipMaps;\r\n        texture.samplingMode = samplingMode;\r\n        texture.type = type;\r\n        texture.format = format;\r\n        texture.label = label;\r\n        texture.comparisonFunction = comparisonFunction;\r\n\r\n        this._internalTexturesCache.push(texture);\r\n\r\n        if (createMSAATexture) {\r\n            let renderBuffer: Nullable<WebGLRenderbuffer> = null;\r\n\r\n            if (IsDepthTexture(texture.format)) {\r\n                renderBuffer = this._setupFramebufferDepthAttachments(\r\n                    HasStencilAspect(texture.format),\r\n                    texture.format !== Constants.TEXTUREFORMAT_STENCIL8,\r\n                    texture.width,\r\n                    texture.height,\r\n                    samples,\r\n                    texture.format,\r\n                    true\r\n                );\r\n            } else {\r\n                renderBuffer = this._createRenderBuffer(\r\n                    texture.width,\r\n                    texture.height,\r\n                    samples,\r\n                    -1 /* not used */,\r\n                    this._getRGBABufferInternalSizedFormat(texture.type, texture.format, texture._useSRGBBuffer),\r\n                    -1 /* attachment */\r\n                );\r\n            }\r\n\r\n            if (!renderBuffer) {\r\n                throw new Error(\"Unable to create render buffer\");\r\n            }\r\n\r\n            texture._autoMSAAManagement = true;\r\n\r\n            let hardwareTexture = texture._hardwareTexture as Nullable<WebGLHardwareTexture>;\r\n            if (!hardwareTexture) {\r\n                hardwareTexture = texture._hardwareTexture = this._createHardwareTexture() as WebGLHardwareTexture;\r\n            }\r\n\r\n            hardwareTexture.addMSAARenderBuffer(renderBuffer);\r\n        }\r\n\r\n        return texture;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _getUseSRGBBuffer(useSRGBBuffer: boolean, noMipmap: boolean): boolean {\r\n        // Generating mipmaps for sRGB textures is not supported in WebGL1 so we must disable the support if mipmaps is enabled\r\n        return useSRGBBuffer && this._caps.supportSRGBBuffers && (this.webGLVersion > 1 || noMipmap);\r\n    }\r\n\r\n    /**\r\n     * Usually called from Texture.ts.\r\n     * Passed information to create a WebGLTexture\r\n     * @param url defines a value which contains one of the following:\r\n     * * A conventional http URL, e.g. 'http://...' or 'file://...'\r\n     * * A base64 string of in-line texture data, e.g. 'data:image/jpg;base64,/...'\r\n     * * An indicator that data being passed using the buffer parameter, e.g. 'data:mytexture.jpg'\r\n     * @param noMipmap defines a boolean indicating that no mipmaps shall be generated.  Ignored for compressed textures.  They must be in the file\r\n     * @param invertY when true, image is flipped when loaded.  You probably want true. Certain compressed textures may invert this if their default is inverted (eg. ktx)\r\n     * @param scene needed for loading to the correct scene\r\n     * @param samplingMode mode with should be used sample / access the texture (Default: Texture.TRILINEAR_SAMPLINGMODE)\r\n     * @param onLoad optional callback to be called upon successful completion\r\n     * @param onError optional callback to be called upon failure\r\n     * @param buffer a source of a file previously fetched as either a base64 string, an ArrayBuffer (compressed or image format), HTMLImageElement (image format), or a Blob\r\n     * @param fallback an internal argument in case the function must be called again, due to etc1 not having alpha capabilities\r\n     * @param format internal format.  Default: RGB when extension is '.jpg' else RGBA.  Ignored for compressed textures\r\n     * @param forcedExtension defines the extension to use to pick the right loader\r\n     * @param mimeType defines an optional mime type\r\n     * @param loaderOptions options to be passed to the loader\r\n     * @param creationFlags specific flags to use when creating the texture (Constants.TEXTURE_CREATIONFLAG_STORAGE for storage textures, for eg)\r\n     * @param useSRGBBuffer defines if the texture must be loaded in a sRGB GPU buffer (if supported by the GPU).\r\n     * @returns a InternalTexture for assignment back into BABYLON.Texture\r\n     */\r\n    public createTexture(\r\n        url: Nullable<string>,\r\n        noMipmap: boolean,\r\n        invertY: boolean,\r\n        scene: Nullable<ISceneLike>,\r\n        samplingMode: number = Constants.TEXTURE_TRILINEAR_SAMPLINGMODE,\r\n        onLoad: Nullable<(texture: InternalTexture) => void> = null,\r\n        onError: Nullable<(message: string, exception: any) => void> = null,\r\n        buffer: Nullable<string | ArrayBuffer | ArrayBufferView | HTMLImageElement | Blob | ImageBitmap> = null,\r\n        fallback: Nullable<InternalTexture> = null,\r\n        format: Nullable<number> = null,\r\n        forcedExtension: Nullable<string> = null,\r\n        mimeType?: string,\r\n        loaderOptions?: any,\r\n        creationFlags?: number,\r\n        useSRGBBuffer?: boolean\r\n    ): InternalTexture {\r\n        return this._createTextureBase(\r\n            url,\r\n            noMipmap,\r\n            invertY,\r\n            scene,\r\n            samplingMode,\r\n            onLoad,\r\n            onError,\r\n            (...args: Parameters<PrepareTextureFunction>) => this._prepareWebGLTexture(...args, format),\r\n            (potWidth, potHeight, img, extension, texture, continuationCallback) => {\r\n                const gl = this._gl;\r\n                const isPot = img.width === potWidth && img.height === potHeight;\r\n\r\n                texture._creationFlags = creationFlags ?? 0;\r\n\r\n                const tip = this._getTexImageParametersForCreateTexture(texture.format, texture._useSRGBBuffer);\r\n                if (isPot) {\r\n                    gl.texImage2D(gl.TEXTURE_2D, 0, tip.internalFormat, tip.format, tip.type, img as any);\r\n                    return false;\r\n                }\r\n\r\n                const maxTextureSize = this._caps.maxTextureSize;\r\n\r\n                if (img.width > maxTextureSize || img.height > maxTextureSize || !this._supportsHardwareTextureRescaling) {\r\n                    this._prepareWorkingCanvas();\r\n                    if (!this._workingCanvas || !this._workingContext) {\r\n                        return false;\r\n                    }\r\n\r\n                    this._workingCanvas.width = potWidth;\r\n                    this._workingCanvas.height = potHeight;\r\n\r\n                    this._workingContext.drawImage(img as any, 0, 0, img.width, img.height, 0, 0, potWidth, potHeight);\r\n                    gl.texImage2D(gl.TEXTURE_2D, 0, tip.internalFormat, tip.format, tip.type, this._workingCanvas as TexImageSource);\r\n\r\n                    texture.width = potWidth;\r\n                    texture.height = potHeight;\r\n\r\n                    return false;\r\n                } else {\r\n                    // Using shaders when possible to rescale because canvas.drawImage is lossy\r\n                    const source = new InternalTexture(this, InternalTextureSource.Temp);\r\n                    this._bindTextureDirectly(gl.TEXTURE_2D, source, true);\r\n                    gl.texImage2D(gl.TEXTURE_2D, 0, tip.internalFormat, tip.format, tip.type, img as any);\r\n\r\n                    this._rescaleTexture(source, texture, scene, tip.format, () => {\r\n                        this._releaseTexture(source);\r\n                        this._bindTextureDirectly(gl.TEXTURE_2D, texture, true);\r\n\r\n                        continuationCallback();\r\n                    });\r\n                }\r\n\r\n                return true;\r\n            },\r\n            buffer,\r\n            fallback,\r\n            format,\r\n            forcedExtension,\r\n            mimeType,\r\n            loaderOptions,\r\n            useSRGBBuffer\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Calls to the GL texImage2D and texImage3D functions require three arguments describing the pixel format of the texture.\r\n     * createTexture derives these from the babylonFormat and useSRGBBuffer arguments and also the file extension of the URL it's working with.\r\n     * This function encapsulates that derivation for easy unit testing.\r\n     * @param babylonFormat Babylon's format enum, as specified in ITextureCreationOptions.\r\n     * @param fileExtension The file extension including the dot, e.g. .jpg.\r\n     * @param useSRGBBuffer Use SRGB not linear.\r\n     * @returns The options to pass to texImage2D or texImage3D calls.\r\n     * @internal\r\n     */\r\n    public _getTexImageParametersForCreateTexture(babylonFormat: number, useSRGBBuffer: boolean): TexImageParameters {\r\n        let format: number, internalFormat: number;\r\n        if (this.webGLVersion === 1) {\r\n            // In WebGL 1, format and internalFormat must be the same and taken from a limited set of values, see https://docs.gl/es2/glTexImage2D.\r\n            // The SRGB extension (https://developer.mozilla.org/en-US/docs/Web/API/EXT_sRGB) adds some extra values, hence passing useSRGBBuffer\r\n            // to getInternalFormat.\r\n            format = this._getInternalFormat(babylonFormat, useSRGBBuffer);\r\n            internalFormat = format;\r\n        } else {\r\n            // In WebGL 2, format has a wider range of values and internal format can be one of the sized formats, see\r\n            // https://registry.khronos.org/OpenGL-Refpages/es3.0/html/glTexImage2D.xhtml.\r\n            // SRGB is included in the sized format and should not be passed in \"format\", hence always passing useSRGBBuffer as false.\r\n            format = this._getInternalFormat(babylonFormat, false);\r\n            internalFormat = this._getRGBABufferInternalSizedFormat(Constants.TEXTURETYPE_UNSIGNED_BYTE, babylonFormat, useSRGBBuffer);\r\n        }\r\n\r\n        return {\r\n            internalFormat,\r\n            format,\r\n            type: this._gl.UNSIGNED_BYTE,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _rescaleTexture(source: InternalTexture, destination: InternalTexture, scene: Nullable<any>, internalFormat: number, onComplete: () => void): void {}\r\n\r\n    private _unpackFlipYCached: Nullable<boolean> = null;\r\n\r\n    /**\r\n     * In case you are sharing the context with other applications, it might\r\n     * be interested to not cache the unpack flip y state to ensure a consistent\r\n     * value would be set.\r\n     */\r\n    public enableUnpackFlipYCached = true;\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _unpackFlipY(value: boolean): void {\r\n        if (this._unpackFlipYCached !== value) {\r\n            this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL, value ? 1 : 0);\r\n\r\n            if (this.enableUnpackFlipYCached) {\r\n                this._unpackFlipYCached = value;\r\n            }\r\n        }\r\n    }\r\n\r\n    /** @internal */\r\n    public _getUnpackAlignement(): number {\r\n        return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT);\r\n    }\r\n\r\n    /** @internal */\r\n    public _getTextureTarget(texture: InternalTexture): number {\r\n        if (texture.isCube) {\r\n            return this._gl.TEXTURE_CUBE_MAP;\r\n        } else if (texture.is3D) {\r\n            return this._gl.TEXTURE_3D;\r\n        } else if (texture.is2DArray || texture.isMultiview) {\r\n            return this._gl.TEXTURE_2D_ARRAY;\r\n        }\r\n        return this._gl.TEXTURE_2D;\r\n    }\r\n\r\n    /**\r\n     * Update the sampling mode of a given texture\r\n     * @param samplingMode defines the required sampling mode\r\n     * @param texture defines the texture to update\r\n     * @param generateMipMaps defines whether to generate mipmaps for the texture\r\n     */\r\n    public updateTextureSamplingMode(samplingMode: number, texture: InternalTexture, generateMipMaps: boolean = false): void {\r\n        const target = this._getTextureTarget(texture);\r\n        const filters = this._getSamplingParameters(samplingMode, texture.useMipMaps || generateMipMaps);\r\n\r\n        this._setTextureParameterInteger(target, this._gl.TEXTURE_MAG_FILTER, filters.mag, texture);\r\n        this._setTextureParameterInteger(target, this._gl.TEXTURE_MIN_FILTER, filters.min);\r\n\r\n        if (generateMipMaps) {\r\n            texture.generateMipMaps = true;\r\n            this._gl.generateMipmap(target);\r\n        }\r\n\r\n        this._bindTextureDirectly(target, null);\r\n\r\n        texture.samplingMode = samplingMode;\r\n    }\r\n\r\n    /**\r\n     * Update the dimensions of a texture\r\n     * @param texture texture to update\r\n     * @param width new width of the texture\r\n     * @param height new height of the texture\r\n     * @param depth new depth of the texture\r\n     */\r\n    public updateTextureDimensions(texture: InternalTexture, width: number, height: number, depth: number = 1): void {}\r\n\r\n    /**\r\n     * Update the sampling mode of a given texture\r\n     * @param texture defines the texture to update\r\n     * @param wrapU defines the texture wrap mode of the u coordinates\r\n     * @param wrapV defines the texture wrap mode of the v coordinates\r\n     * @param wrapR defines the texture wrap mode of the r coordinates\r\n     */\r\n    public updateTextureWrappingMode(texture: InternalTexture, wrapU: Nullable<number>, wrapV: Nullable<number> = null, wrapR: Nullable<number> = null): void {\r\n        const target = this._getTextureTarget(texture);\r\n\r\n        if (wrapU !== null) {\r\n            this._setTextureParameterInteger(target, this._gl.TEXTURE_WRAP_S, this._getTextureWrapMode(wrapU), texture);\r\n            texture._cachedWrapU = wrapU;\r\n        }\r\n        if (wrapV !== null) {\r\n            this._setTextureParameterInteger(target, this._gl.TEXTURE_WRAP_T, this._getTextureWrapMode(wrapV), texture);\r\n            texture._cachedWrapV = wrapV;\r\n        }\r\n        if ((texture.is2DArray || texture.is3D) && wrapR !== null) {\r\n            this._setTextureParameterInteger(target, this._gl.TEXTURE_WRAP_R, this._getTextureWrapMode(wrapR), texture);\r\n            texture._cachedWrapR = wrapR;\r\n        }\r\n\r\n        this._bindTextureDirectly(target, null);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _uploadCompressedDataToTextureDirectly(\r\n        texture: InternalTexture,\r\n        internalFormat: number,\r\n        width: number,\r\n        height: number,\r\n        data: ArrayBufferView,\r\n        faceIndex: number = 0,\r\n        lod: number = 0\r\n    ) {\r\n        const gl = this._gl;\r\n\r\n        let target: GLenum = gl.TEXTURE_2D;\r\n        if (texture.isCube) {\r\n            target = gl.TEXTURE_CUBE_MAP_POSITIVE_X + faceIndex;\r\n        }\r\n\r\n        if (texture._useSRGBBuffer) {\r\n            switch (internalFormat) {\r\n                case Constants.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2:\r\n                case Constants.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL:\r\n                    // Note, if using ETC1 and sRGB is requested, this will use ETC2 if available.\r\n                    if (this._caps.etc2) {\r\n                        internalFormat = gl.COMPRESSED_SRGB8_ETC2;\r\n                    } else {\r\n                        texture._useSRGBBuffer = false;\r\n                    }\r\n                    break;\r\n                case Constants.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC:\r\n                    if (this._caps.etc2) {\r\n                        internalFormat = gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC;\r\n                    } else {\r\n                        texture._useSRGBBuffer = false;\r\n                    }\r\n                    break;\r\n                case Constants.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM:\r\n                    internalFormat = gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;\r\n                    break;\r\n                case Constants.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4:\r\n                    internalFormat = gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;\r\n                    break;\r\n                case Constants.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1:\r\n                    if (this._caps.s3tc_srgb) {\r\n                        internalFormat = gl.COMPRESSED_SRGB_S3TC_DXT1_EXT;\r\n                    } else {\r\n                        // S3TC sRGB extension not supported\r\n                        texture._useSRGBBuffer = false;\r\n                    }\r\n                    break;\r\n                case Constants.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1:\r\n                    if (this._caps.s3tc_srgb) {\r\n                        internalFormat = gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;\r\n                    } else {\r\n                        // S3TC sRGB extension not supported\r\n                        texture._useSRGBBuffer = false;\r\n                    }\r\n                    break;\r\n                case Constants.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5:\r\n                    if (this._caps.s3tc_srgb) {\r\n                        internalFormat = gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;\r\n                    } else {\r\n                        // S3TC sRGB extension not supported\r\n                        texture._useSRGBBuffer = false;\r\n                    }\r\n                    break;\r\n                default:\r\n                    // We don't support a sRGB format corresponding to internalFormat, so revert to non sRGB format\r\n                    texture._useSRGBBuffer = false;\r\n                    break;\r\n            }\r\n        }\r\n\r\n        this._gl.compressedTexImage2D(target, lod, internalFormat, width, height, 0, <DataView>data);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _uploadDataToTextureDirectly(\r\n        texture: InternalTexture,\r\n        imageData: ArrayBufferView,\r\n        faceIndex: number = 0,\r\n        lod: number = 0,\r\n        babylonInternalFormat?: number,\r\n        useTextureWidthAndHeight = false\r\n    ): void {\r\n        const gl = this._gl;\r\n\r\n        const textureType = this._getWebGLTextureType(texture.type);\r\n        const format = this._getInternalFormat(texture.format);\r\n        const internalFormat =\r\n            babylonInternalFormat === undefined\r\n                ? this._getRGBABufferInternalSizedFormat(texture.type, texture.format, texture._useSRGBBuffer)\r\n                : this._getInternalFormat(babylonInternalFormat, texture._useSRGBBuffer);\r\n\r\n        this._unpackFlipY(texture.invertY);\r\n\r\n        let target: GLenum = gl.TEXTURE_2D;\r\n        if (texture.isCube) {\r\n            target = gl.TEXTURE_CUBE_MAP_POSITIVE_X + faceIndex;\r\n        }\r\n\r\n        const lodMaxWidth = Math.round(Math.log(texture.width) * Math.LOG2E);\r\n        const lodMaxHeight = Math.round(Math.log(texture.height) * Math.LOG2E);\r\n        const width = useTextureWidthAndHeight ? texture.width : Math.pow(2, Math.max(lodMaxWidth - lod, 0));\r\n        const height = useTextureWidthAndHeight ? texture.height : Math.pow(2, Math.max(lodMaxHeight - lod, 0));\r\n\r\n        gl.texImage2D(target, lod, internalFormat, width, height, 0, format, textureType, imageData);\r\n    }\r\n\r\n    /**\r\n     * Update a portion of an internal texture\r\n     * @param texture defines the texture to update\r\n     * @param imageData defines the data to store into the texture\r\n     * @param xOffset defines the x coordinates of the update rectangle\r\n     * @param yOffset defines the y coordinates of the update rectangle\r\n     * @param width defines the width of the update rectangle\r\n     * @param height defines the height of the update rectangle\r\n     * @param faceIndex defines the face index if texture is a cube (0 by default)\r\n     * @param lod defines the lod level to update (0 by default)\r\n     * @param generateMipMaps defines whether to generate mipmaps or not\r\n     */\r\n    public updateTextureData(\r\n        texture: InternalTexture,\r\n        imageData: ArrayBufferView,\r\n        xOffset: number,\r\n        yOffset: number,\r\n        width: number,\r\n        height: number,\r\n        faceIndex: number = 0,\r\n        lod: number = 0,\r\n        generateMipMaps = false\r\n    ): void {\r\n        const gl = this._gl;\r\n\r\n        const textureType = this._getWebGLTextureType(texture.type);\r\n        const format = this._getInternalFormat(texture.format);\r\n\r\n        this._unpackFlipY(texture.invertY);\r\n\r\n        let targetForBinding: GLenum = gl.TEXTURE_2D;\r\n        let target: GLenum = gl.TEXTURE_2D;\r\n        if (texture.isCube) {\r\n            target = gl.TEXTURE_CUBE_MAP_POSITIVE_X + faceIndex;\r\n            targetForBinding = gl.TEXTURE_CUBE_MAP;\r\n        }\r\n\r\n        this._bindTextureDirectly(targetForBinding, texture, true);\r\n\r\n        gl.texSubImage2D(target, lod, xOffset, yOffset, width, height, format, textureType, imageData);\r\n\r\n        if (generateMipMaps) {\r\n            this._gl.generateMipmap(target);\r\n        }\r\n\r\n        this._bindTextureDirectly(targetForBinding, null);\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _uploadArrayBufferViewToTexture(texture: InternalTexture, imageData: ArrayBufferView, faceIndex: number = 0, lod: number = 0): void {\r\n        const gl = this._gl;\r\n        const bindTarget = texture.isCube ? gl.TEXTURE_CUBE_MAP : gl.TEXTURE_2D;\r\n\r\n        this._bindTextureDirectly(bindTarget, texture, true);\r\n\r\n        this._uploadDataToTextureDirectly(texture, imageData, faceIndex, lod);\r\n\r\n        this._bindTextureDirectly(bindTarget, null, true);\r\n    }\r\n\r\n    protected _prepareWebGLTextureContinuation(texture: InternalTexture, scene: Nullable<ISceneLike>, noMipmap: boolean, isCompressed: boolean, samplingMode: number): void {\r\n        const gl = this._gl;\r\n        if (!gl) {\r\n            return;\r\n        }\r\n\r\n        const filters = this._getSamplingParameters(samplingMode, !noMipmap);\r\n\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, filters.mag);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, filters.min);\r\n\r\n        if (!noMipmap && !isCompressed) {\r\n            gl.generateMipmap(gl.TEXTURE_2D);\r\n        }\r\n\r\n        this._bindTextureDirectly(gl.TEXTURE_2D, null);\r\n\r\n        // this.resetTextureCache();\r\n        if (scene) {\r\n            scene.removePendingData(texture);\r\n        }\r\n\r\n        texture.onLoadedObservable.notifyObservers(texture);\r\n        texture.onLoadedObservable.clear();\r\n    }\r\n\r\n    private _prepareWebGLTexture(\r\n        texture: InternalTexture,\r\n        extension: string,\r\n        scene: Nullable<ISceneLike>,\r\n        img: HTMLImageElement | ImageBitmap | { width: number; height: number },\r\n        invertY: boolean,\r\n        noMipmap: boolean,\r\n        isCompressed: boolean,\r\n        processFunction: PrepareTextureProcessFunction,\r\n        samplingMode: number,\r\n        format: Nullable<number>\r\n    ): void {\r\n        const maxTextureSize = this.getCaps().maxTextureSize;\r\n        const potWidth = Math.min(maxTextureSize, this.needPOTTextures ? GetExponentOfTwo(img.width, maxTextureSize) : img.width);\r\n        const potHeight = Math.min(maxTextureSize, this.needPOTTextures ? GetExponentOfTwo(img.height, maxTextureSize) : img.height);\r\n\r\n        const gl = this._gl;\r\n        if (!gl) {\r\n            return;\r\n        }\r\n\r\n        if (!texture._hardwareTexture) {\r\n            //  this.resetTextureCache();\r\n            if (scene) {\r\n                scene.removePendingData(texture);\r\n            }\r\n\r\n            return;\r\n        }\r\n\r\n        this._bindTextureDirectly(gl.TEXTURE_2D, texture, true);\r\n        this._unpackFlipY(invertY === undefined ? true : invertY ? true : false);\r\n\r\n        texture.baseWidth = img.width;\r\n        texture.baseHeight = img.height;\r\n        texture.width = potWidth;\r\n        texture.height = potHeight;\r\n        texture.isReady = true;\r\n        texture.type = texture.type !== -1 ? texture.type : Constants.TEXTURETYPE_UNSIGNED_BYTE;\r\n        texture.format =\r\n            texture.format !== -1 ? texture.format : (format ?? (extension === \".jpg\" && !texture._useSRGBBuffer ? Constants.TEXTUREFORMAT_RGB : Constants.TEXTUREFORMAT_RGBA));\r\n\r\n        if (\r\n            processFunction(potWidth, potHeight, img, extension, texture, () => {\r\n                this._prepareWebGLTextureContinuation(texture, scene, noMipmap, isCompressed, samplingMode);\r\n            })\r\n        ) {\r\n            // Returning as texture needs extra async steps\r\n            return;\r\n        }\r\n\r\n        this._prepareWebGLTextureContinuation(texture, scene, noMipmap, isCompressed, samplingMode);\r\n    }\r\n\r\n    public _getInternalFormatFromDepthTextureFormat(textureFormat: number, hasDepth: boolean, hasStencil: boolean): number {\r\n        const gl = this._gl;\r\n\r\n        if (!hasDepth) {\r\n            return gl.STENCIL_INDEX8;\r\n        }\r\n\r\n        const format: GLenum = hasStencil ? gl.DEPTH_STENCIL : gl.DEPTH_COMPONENT;\r\n        let internalFormat = format;\r\n        if (this.webGLVersion > 1) {\r\n            if (textureFormat === Constants.TEXTUREFORMAT_DEPTH16) {\r\n                internalFormat = gl.DEPTH_COMPONENT16;\r\n            } else if (textureFormat === Constants.TEXTUREFORMAT_DEPTH24) {\r\n                internalFormat = gl.DEPTH_COMPONENT24;\r\n            } else if (textureFormat === Constants.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8 || textureFormat === Constants.TEXTUREFORMAT_DEPTH24_STENCIL8) {\r\n                internalFormat = hasStencil ? gl.DEPTH24_STENCIL8 : gl.DEPTH_COMPONENT24;\r\n            } else if (textureFormat === Constants.TEXTUREFORMAT_DEPTH32_FLOAT) {\r\n                internalFormat = gl.DEPTH_COMPONENT32F;\r\n            } else if (textureFormat === Constants.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8) {\r\n                internalFormat = hasStencil ? gl.DEPTH32F_STENCIL8 : gl.DEPTH_COMPONENT32F;\r\n            }\r\n        } else {\r\n            internalFormat = gl.DEPTH_COMPONENT16;\r\n        }\r\n\r\n        return internalFormat;\r\n    }\r\n\r\n    public _getWebGLTextureTypeFromDepthTextureFormat(textureFormat: number): GLenum {\r\n        const gl = this._gl;\r\n\r\n        let type: GLenum = gl.UNSIGNED_INT;\r\n        if (textureFormat === Constants.TEXTUREFORMAT_DEPTH16) {\r\n            type = gl.UNSIGNED_SHORT;\r\n        } else if (textureFormat === Constants.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8 || textureFormat === Constants.TEXTUREFORMAT_DEPTH24_STENCIL8) {\r\n            type = gl.UNSIGNED_INT_24_8;\r\n        } else if (textureFormat === Constants.TEXTUREFORMAT_DEPTH32_FLOAT) {\r\n            type = gl.FLOAT;\r\n        } else if (textureFormat === Constants.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8) {\r\n            type = gl.FLOAT_32_UNSIGNED_INT_24_8_REV;\r\n        } else if (textureFormat === Constants.TEXTUREFORMAT_STENCIL8) {\r\n            type = gl.UNSIGNED_BYTE;\r\n        }\r\n\r\n        return type;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _setupFramebufferDepthAttachments(\r\n        generateStencilBuffer: boolean,\r\n        generateDepthBuffer: boolean,\r\n        width: number,\r\n        height: number,\r\n        samples = 1,\r\n        depthTextureFormat?: number,\r\n        dontBindRenderBufferToFrameBuffer = false\r\n    ): Nullable<WebGLRenderbuffer> {\r\n        const gl = this._gl;\r\n\r\n        depthTextureFormat = depthTextureFormat ?? (generateStencilBuffer ? Constants.TEXTUREFORMAT_DEPTH24_STENCIL8 : Constants.TEXTUREFORMAT_DEPTH32_FLOAT);\r\n\r\n        const internalFormat = this._getInternalFormatFromDepthTextureFormat(depthTextureFormat, generateDepthBuffer, generateStencilBuffer);\r\n\r\n        // Create the depth/stencil buffer\r\n        if (generateStencilBuffer && generateDepthBuffer) {\r\n            return this._createRenderBuffer(width, height, samples, gl.DEPTH_STENCIL, internalFormat, dontBindRenderBufferToFrameBuffer ? -1 : gl.DEPTH_STENCIL_ATTACHMENT);\r\n        }\r\n        if (generateDepthBuffer) {\r\n            return this._createRenderBuffer(width, height, samples, internalFormat, internalFormat, dontBindRenderBufferToFrameBuffer ? -1 : gl.DEPTH_ATTACHMENT);\r\n        }\r\n        if (generateStencilBuffer) {\r\n            return this._createRenderBuffer(width, height, samples, internalFormat, internalFormat, dontBindRenderBufferToFrameBuffer ? -1 : gl.STENCIL_ATTACHMENT);\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _createRenderBuffer(\r\n        width: number,\r\n        height: number,\r\n        samples: number,\r\n        internalFormat: number,\r\n        msInternalFormat: number,\r\n        attachment: number,\r\n        unbindBuffer = true\r\n    ): Nullable<WebGLRenderbuffer> {\r\n        const gl = this._gl;\r\n        const renderBuffer = gl.createRenderbuffer();\r\n        return this._updateRenderBuffer(renderBuffer, width, height, samples, internalFormat, msInternalFormat, attachment, unbindBuffer);\r\n    }\r\n\r\n    public _updateRenderBuffer(\r\n        renderBuffer: Nullable<WebGLRenderbuffer>,\r\n        width: number,\r\n        height: number,\r\n        samples: number,\r\n        internalFormat: number,\r\n        msInternalFormat: number,\r\n        attachment: number,\r\n        unbindBuffer = true\r\n    ): Nullable<WebGLRenderbuffer> {\r\n        const gl = this._gl;\r\n\r\n        gl.bindRenderbuffer(gl.RENDERBUFFER, renderBuffer);\r\n\r\n        if (samples > 1 && gl.renderbufferStorageMultisample) {\r\n            gl.renderbufferStorageMultisample(gl.RENDERBUFFER, samples, msInternalFormat, width, height);\r\n        } else {\r\n            gl.renderbufferStorage(gl.RENDERBUFFER, internalFormat, width, height);\r\n        }\r\n\r\n        if (attachment !== -1) {\r\n            gl.framebufferRenderbuffer(gl.FRAMEBUFFER, attachment, gl.RENDERBUFFER, renderBuffer);\r\n        }\r\n\r\n        if (unbindBuffer) {\r\n            gl.bindRenderbuffer(gl.RENDERBUFFER, null);\r\n        }\r\n\r\n        return renderBuffer;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _releaseTexture(texture: InternalTexture): void {\r\n        this._deleteTexture(texture._hardwareTexture as Nullable<WebGLHardwareTexture>);\r\n\r\n        // Unbind channels\r\n        this.unbindAllTextures();\r\n\r\n        const index = this._internalTexturesCache.indexOf(texture);\r\n        if (index !== -1) {\r\n            this._internalTexturesCache.splice(index, 1);\r\n        }\r\n\r\n        // Integrated fixed lod samplers.\r\n        if (texture._lodTextureHigh) {\r\n            texture._lodTextureHigh.dispose();\r\n        }\r\n        if (texture._lodTextureMid) {\r\n            texture._lodTextureMid.dispose();\r\n        }\r\n        if (texture._lodTextureLow) {\r\n            texture._lodTextureLow.dispose();\r\n        }\r\n\r\n        // Integrated irradiance map.\r\n        if (texture._irradianceTexture) {\r\n            texture._irradianceTexture.dispose();\r\n        }\r\n    }\r\n\r\n    protected _deleteTexture(texture: Nullable<WebGLHardwareTexture>): void {\r\n        texture?.release();\r\n    }\r\n\r\n    protected _setProgram(program: WebGLProgram): void {\r\n        if (this._currentProgram !== program) {\r\n            _setProgram(program, this._gl);\r\n            this._currentProgram = program;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _boundUniforms: { [key: number]: WebGLUniformLocation } = {};\r\n\r\n    /**\r\n     * Binds an effect to the webGL context\r\n     * @param effect defines the effect to bind\r\n     */\r\n    public bindSamplers(effect: Effect): void {\r\n        const webGLPipelineContext = effect.getPipelineContext() as WebGLPipelineContext;\r\n        this._setProgram(webGLPipelineContext.program!);\r\n        const samplers = effect.getSamplers();\r\n        for (let index = 0; index < samplers.length; index++) {\r\n            const uniform = effect.getUniform(samplers[index]);\r\n\r\n            if (uniform) {\r\n                this._boundUniforms[index] = uniform;\r\n            }\r\n        }\r\n        this._currentEffect = null;\r\n    }\r\n\r\n    private _activateCurrentTexture() {\r\n        if (this._currentTextureChannel !== this._activeChannel) {\r\n            this._gl.activeTexture(this._gl.TEXTURE0 + this._activeChannel);\r\n            this._currentTextureChannel = this._activeChannel;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _bindTextureDirectly(target: number, texture: Nullable<InternalTexture>, forTextureDataUpdate = false, force = false): boolean {\r\n        let wasPreviouslyBound = false;\r\n        const isTextureForRendering = texture && texture._associatedChannel > -1;\r\n        if (forTextureDataUpdate && isTextureForRendering) {\r\n            this._activeChannel = texture!._associatedChannel;\r\n        }\r\n\r\n        const currentTextureBound = this._boundTexturesCache[this._activeChannel];\r\n\r\n        if (currentTextureBound !== texture || force) {\r\n            this._activateCurrentTexture();\r\n\r\n            if (texture && texture.isMultiview) {\r\n                //this._gl.bindTexture(target, texture ? texture._colorTextureArray : null);\r\n                Logger.Error([\"_bindTextureDirectly called with a multiview texture!\", target, texture]);\r\n                // eslint-disable-next-line no-throw-literal\r\n                throw \"_bindTextureDirectly called with a multiview texture!\";\r\n            } else {\r\n                this._gl.bindTexture(target, texture?._hardwareTexture?.underlyingResource ?? null);\r\n            }\r\n\r\n            this._boundTexturesCache[this._activeChannel] = texture;\r\n\r\n            if (texture) {\r\n                texture._associatedChannel = this._activeChannel;\r\n            }\r\n        } else if (forTextureDataUpdate) {\r\n            wasPreviouslyBound = true;\r\n            this._activateCurrentTexture();\r\n        }\r\n\r\n        if (isTextureForRendering && !forTextureDataUpdate) {\r\n            this._bindSamplerUniformToChannel(texture!._associatedChannel, this._activeChannel);\r\n        }\r\n\r\n        return wasPreviouslyBound;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _bindTexture(channel: number, texture: Nullable<InternalTexture>, name: string): void {\r\n        if (channel === undefined) {\r\n            return;\r\n        }\r\n\r\n        if (texture) {\r\n            texture._associatedChannel = channel;\r\n        }\r\n\r\n        this._activeChannel = channel;\r\n        const target = texture ? this._getTextureTarget(texture) : this._gl.TEXTURE_2D;\r\n        this._bindTextureDirectly(target, texture);\r\n    }\r\n\r\n    /**\r\n     * Unbind all textures from the webGL context\r\n     */\r\n    public unbindAllTextures(): void {\r\n        for (let channel = 0; channel < this._maxSimultaneousTextures; channel++) {\r\n            this._activeChannel = channel;\r\n            this._bindTextureDirectly(this._gl.TEXTURE_2D, null);\r\n            this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP, null);\r\n            if (this.webGLVersion > 1) {\r\n                this._bindTextureDirectly(this._gl.TEXTURE_3D, null);\r\n                this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY, null);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets a texture to the according uniform.\r\n     * @param channel The texture channel\r\n     * @param uniform The uniform to set\r\n     * @param texture The texture to apply\r\n     * @param name The name of the uniform in the effect\r\n     */\r\n    public setTexture(channel: number, uniform: Nullable<WebGLUniformLocation>, texture: Nullable<ThinTexture>, name: string): void {\r\n        if (channel === undefined) {\r\n            return;\r\n        }\r\n\r\n        if (uniform) {\r\n            this._boundUniforms[channel] = uniform;\r\n        }\r\n\r\n        this._setTexture(channel, texture);\r\n    }\r\n\r\n    private _bindSamplerUniformToChannel(sourceSlot: number, destination: number) {\r\n        const uniform = this._boundUniforms[sourceSlot];\r\n        if (!uniform || uniform._currentState === destination) {\r\n            return;\r\n        }\r\n        this._gl.uniform1i(uniform, destination);\r\n        uniform._currentState = destination;\r\n    }\r\n\r\n    private _getTextureWrapMode(mode: number): number {\r\n        switch (mode) {\r\n            case Constants.TEXTURE_WRAP_ADDRESSMODE:\r\n                return this._gl.REPEAT;\r\n            case Constants.TEXTURE_CLAMP_ADDRESSMODE:\r\n                return this._gl.CLAMP_TO_EDGE;\r\n            case Constants.TEXTURE_MIRROR_ADDRESSMODE:\r\n                return this._gl.MIRRORED_REPEAT;\r\n        }\r\n        return this._gl.REPEAT;\r\n    }\r\n\r\n    public override _setTexture(channel: number, texture: Nullable<ThinTexture>, isPartOfTextureArray = false, depthStencilTexture = false, name = \"\"): boolean {\r\n        // Not ready?\r\n        if (!texture) {\r\n            if (this._boundTexturesCache[channel] != null) {\r\n                this._activeChannel = channel;\r\n                this._bindTextureDirectly(this._gl.TEXTURE_2D, null);\r\n                this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP, null);\r\n                if (this.webGLVersion > 1) {\r\n                    this._bindTextureDirectly(this._gl.TEXTURE_3D, null);\r\n                    this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY, null);\r\n                }\r\n            }\r\n            return false;\r\n        }\r\n\r\n        // Video\r\n        if ((<VideoTexture>texture).video) {\r\n            this._activeChannel = channel;\r\n            const videoInternalTexture = (<VideoTexture>texture).getInternalTexture();\r\n            if (videoInternalTexture) {\r\n                videoInternalTexture._associatedChannel = channel;\r\n            }\r\n            (<VideoTexture>texture).update();\r\n        } else if (texture.delayLoadState === Constants.DELAYLOADSTATE_NOTLOADED) {\r\n            // Delay loading\r\n            texture.delayLoad();\r\n            return false;\r\n        }\r\n\r\n        let internalTexture: InternalTexture;\r\n        if (depthStencilTexture) {\r\n            internalTexture = (<RenderTargetTexture>texture).depthStencilTexture!;\r\n        } else if (texture.isReady()) {\r\n            internalTexture = <InternalTexture>texture.getInternalTexture();\r\n        } else if (texture.isCube) {\r\n            internalTexture = this.emptyCubeTexture;\r\n        } else if (texture.is3D) {\r\n            internalTexture = this.emptyTexture3D;\r\n        } else if (texture.is2DArray) {\r\n            internalTexture = this.emptyTexture2DArray;\r\n        } else {\r\n            internalTexture = this.emptyTexture;\r\n        }\r\n\r\n        if (!isPartOfTextureArray && internalTexture) {\r\n            internalTexture._associatedChannel = channel;\r\n        }\r\n\r\n        let needToBind = true;\r\n        if (this._boundTexturesCache[channel] === internalTexture) {\r\n            if (!isPartOfTextureArray) {\r\n                this._bindSamplerUniformToChannel(internalTexture._associatedChannel, channel);\r\n            }\r\n\r\n            needToBind = false;\r\n        }\r\n\r\n        this._activeChannel = channel;\r\n        const target = this._getTextureTarget(internalTexture);\r\n        if (needToBind) {\r\n            this._bindTextureDirectly(target, internalTexture, isPartOfTextureArray);\r\n        }\r\n\r\n        if (internalTexture && !internalTexture.isMultiview) {\r\n            // CUBIC_MODE and SKYBOX_MODE both require CLAMP_TO_EDGE.  All other modes use REPEAT.\r\n            if (internalTexture.isCube && internalTexture._cachedCoordinatesMode !== texture.coordinatesMode) {\r\n                internalTexture._cachedCoordinatesMode = texture.coordinatesMode;\r\n\r\n                const textureWrapMode =\r\n                    texture.coordinatesMode !== Constants.TEXTURE_CUBIC_MODE && texture.coordinatesMode !== Constants.TEXTURE_SKYBOX_MODE\r\n                        ? Constants.TEXTURE_WRAP_ADDRESSMODE\r\n                        : Constants.TEXTURE_CLAMP_ADDRESSMODE;\r\n                texture.wrapU = textureWrapMode;\r\n                texture.wrapV = textureWrapMode;\r\n            }\r\n\r\n            if (internalTexture._cachedWrapU !== texture.wrapU) {\r\n                internalTexture._cachedWrapU = texture.wrapU;\r\n                this._setTextureParameterInteger(target, this._gl.TEXTURE_WRAP_S, this._getTextureWrapMode(texture.wrapU), internalTexture);\r\n            }\r\n\r\n            if (internalTexture._cachedWrapV !== texture.wrapV) {\r\n                internalTexture._cachedWrapV = texture.wrapV;\r\n                this._setTextureParameterInteger(target, this._gl.TEXTURE_WRAP_T, this._getTextureWrapMode(texture.wrapV), internalTexture);\r\n            }\r\n\r\n            if (internalTexture.is3D && internalTexture._cachedWrapR !== texture.wrapR) {\r\n                internalTexture._cachedWrapR = texture.wrapR;\r\n                this._setTextureParameterInteger(target, this._gl.TEXTURE_WRAP_R, this._getTextureWrapMode(texture.wrapR), internalTexture);\r\n            }\r\n\r\n            this._setAnisotropicLevel(target, internalTexture, texture.anisotropicFilteringLevel);\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Sets an array of texture to the webGL context\r\n     * @param channel defines the channel where the texture array must be set\r\n     * @param uniform defines the associated uniform location\r\n     * @param textures defines the array of textures to bind\r\n     * @param name name of the channel\r\n     */\r\n    public setTextureArray(channel: number, uniform: Nullable<WebGLUniformLocation>, textures: ThinTexture[], name: string): void {\r\n        if (channel === undefined || !uniform) {\r\n            return;\r\n        }\r\n\r\n        if (!this._textureUnits || this._textureUnits.length !== textures.length) {\r\n            this._textureUnits = new Int32Array(textures.length);\r\n        }\r\n        for (let i = 0; i < textures.length; i++) {\r\n            const texture = textures[i].getInternalTexture();\r\n\r\n            if (texture) {\r\n                this._textureUnits[i] = channel + i;\r\n                texture._associatedChannel = channel + i;\r\n            } else {\r\n                this._textureUnits[i] = -1;\r\n            }\r\n        }\r\n        this._gl.uniform1iv(uniform, this._textureUnits);\r\n\r\n        for (let index = 0; index < textures.length; index++) {\r\n            this._setTexture(this._textureUnits[index], textures[index], true);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _setAnisotropicLevel(target: number, internalTexture: InternalTexture, anisotropicFilteringLevel: number) {\r\n        const anisotropicFilterExtension = this._caps.textureAnisotropicFilterExtension;\r\n        if (\r\n            internalTexture.samplingMode !== Constants.TEXTURE_LINEAR_LINEAR_MIPNEAREST &&\r\n            internalTexture.samplingMode !== Constants.TEXTURE_LINEAR_LINEAR_MIPLINEAR &&\r\n            internalTexture.samplingMode !== Constants.TEXTURE_LINEAR_LINEAR\r\n        ) {\r\n            anisotropicFilteringLevel = 1; // Forcing the anisotropic to 1 because else webgl will force filters to linear\r\n        }\r\n\r\n        if (anisotropicFilterExtension && internalTexture._cachedAnisotropicFilteringLevel !== anisotropicFilteringLevel) {\r\n            this._setTextureParameterFloat(\r\n                target,\r\n                anisotropicFilterExtension.TEXTURE_MAX_ANISOTROPY_EXT,\r\n                Math.min(anisotropicFilteringLevel, this._caps.maxAnisotropy),\r\n                internalTexture\r\n            );\r\n            internalTexture._cachedAnisotropicFilteringLevel = anisotropicFilteringLevel;\r\n        }\r\n    }\r\n\r\n    private _setTextureParameterFloat(target: number, parameter: number, value: number, texture: InternalTexture): void {\r\n        this._bindTextureDirectly(target, texture, true, true);\r\n        this._gl.texParameterf(target, parameter, value);\r\n    }\r\n\r\n    private _setTextureParameterInteger(target: number, parameter: number, value: number, texture?: InternalTexture) {\r\n        if (texture) {\r\n            this._bindTextureDirectly(target, texture, true, true);\r\n        }\r\n        this._gl.texParameteri(target, parameter, value);\r\n    }\r\n\r\n    /**\r\n     * Unbind all vertex attributes from the webGL context\r\n     */\r\n    public unbindAllAttributes() {\r\n        if (this._mustWipeVertexAttributes) {\r\n            this._mustWipeVertexAttributes = false;\r\n\r\n            for (let i = 0; i < this._caps.maxVertexAttribs; i++) {\r\n                this.disableAttributeByIndex(i);\r\n            }\r\n            return;\r\n        }\r\n\r\n        for (let i = 0, ul = this._vertexAttribArraysEnabled.length; i < ul; i++) {\r\n            if (i >= this._caps.maxVertexAttribs || !this._vertexAttribArraysEnabled[i]) {\r\n                continue;\r\n            }\r\n\r\n            this.disableAttributeByIndex(i);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Force the engine to release all cached effects. This means that next effect compilation will have to be done completely even if a similar effect was already compiled\r\n     */\r\n    public releaseEffects() {\r\n        this._compiledEffects = {};\r\n        this.onReleaseEffectsObservable.notifyObservers(this);\r\n    }\r\n\r\n    /**\r\n     * Dispose and release all associated resources\r\n     */\r\n    public override dispose(): void {\r\n        // Events\r\n        if (IsWindowObjectExist()) {\r\n            if (this._renderingCanvas) {\r\n                this._renderingCanvas.removeEventListener(\"webglcontextlost\", this._onContextLost);\r\n\r\n                if (this._onContextRestored) {\r\n                    this._renderingCanvas.removeEventListener(\"webglcontextrestored\", this._onContextRestored);\r\n                }\r\n            }\r\n        }\r\n\r\n        // Should not be moved up of renderingCanvas will be null.\r\n        super.dispose();\r\n\r\n        if (this._dummyFramebuffer) {\r\n            this._gl.deleteFramebuffer(this._dummyFramebuffer);\r\n        }\r\n\r\n        // Unbind\r\n        this.unbindAllAttributes();\r\n        this._boundUniforms = {};\r\n\r\n        this._workingCanvas = null;\r\n        this._workingContext = null;\r\n        this._currentBufferPointers.length = 0;\r\n        this._currentProgram = null;\r\n\r\n        if ((this._creationOptions as EngineOptions).loseContextOnDispose) {\r\n            this._gl.getExtension(\"WEBGL_lose_context\")?.loseContext();\r\n        }\r\n        // clear the state object\r\n        deleteStateObject(this._gl);\r\n    }\r\n\r\n    /**\r\n     * Attach a new callback raised when context lost event is fired\r\n     * @param callback defines the callback to call\r\n     */\r\n    public attachContextLostEvent(callback: (event: WebGLContextEvent) => void): void {\r\n        if (this._renderingCanvas) {\r\n            this._renderingCanvas.addEventListener(\"webglcontextlost\", <any>callback, false);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Attach a new callback raised when context restored event is fired\r\n     * @param callback defines the callback to call\r\n     */\r\n    public attachContextRestoredEvent(callback: (event: WebGLContextEvent) => void): void {\r\n        if (this._renderingCanvas) {\r\n            this._renderingCanvas.addEventListener(\"webglcontextrestored\", <any>callback, false);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get the current error code of the webGL context\r\n     * @returns the error code\r\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/getError\r\n     */\r\n    public getError(): number {\r\n        return this._gl.getError();\r\n    }\r\n\r\n    private _canRenderToFloatFramebuffer(): boolean {\r\n        if (this._webGLVersion > 1) {\r\n            return this._caps.colorBufferFloat;\r\n        }\r\n        return this._canRenderToFramebuffer(Constants.TEXTURETYPE_FLOAT);\r\n    }\r\n\r\n    private _canRenderToHalfFloatFramebuffer(): boolean {\r\n        if (this._webGLVersion > 1) {\r\n            return this._caps.colorBufferFloat;\r\n        }\r\n        return this._canRenderToFramebuffer(Constants.TEXTURETYPE_HALF_FLOAT);\r\n    }\r\n\r\n    // Thank you : http://stackoverflow.com/questions/28827511/webgl-ios-render-to-floating-point-texture\r\n    private _canRenderToFramebuffer(type: number): boolean {\r\n        const gl = this._gl;\r\n\r\n        //clear existing errors\r\n        // eslint-disable-next-line no-empty\r\n        while (gl.getError() !== gl.NO_ERROR) {}\r\n\r\n        let successful = true;\r\n\r\n        const texture = gl.createTexture();\r\n        gl.bindTexture(gl.TEXTURE_2D, texture);\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, this._getRGBABufferInternalSizedFormat(type), 1, 1, 0, gl.RGBA, this._getWebGLTextureType(type), null);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n\r\n        const fb = gl.createFramebuffer();\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, fb);\r\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\r\n        const status = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\r\n\r\n        successful = successful && status === gl.FRAMEBUFFER_COMPLETE;\r\n        successful = successful && gl.getError() === gl.NO_ERROR;\r\n\r\n        //try render by clearing frame buffer's color buffer\r\n        if (successful) {\r\n            gl.clear(gl.COLOR_BUFFER_BIT);\r\n            successful = successful && gl.getError() === gl.NO_ERROR;\r\n        }\r\n\r\n        //try reading from frame to ensure render occurs (just creating the FBO is not sufficient to determine if rendering is supported)\r\n        if (successful) {\r\n            //in practice it's sufficient to just read from the backbuffer rather than handle potentially issues reading from the texture\r\n            gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n            const readFormat = gl.RGBA;\r\n            const readType = gl.UNSIGNED_BYTE;\r\n            const buffer = new Uint8Array(4);\r\n            gl.readPixels(0, 0, 1, 1, readFormat, readType, buffer);\r\n            successful = successful && gl.getError() === gl.NO_ERROR;\r\n        }\r\n\r\n        //clean up\r\n        gl.deleteTexture(texture);\r\n        gl.deleteFramebuffer(fb);\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n\r\n        //clear accumulated errors\r\n        // eslint-disable-next-line no-empty\r\n        while (!successful && gl.getError() !== gl.NO_ERROR) {}\r\n\r\n        return successful;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _getWebGLTextureType(type: number): number {\r\n        if (this._webGLVersion === 1) {\r\n            switch (type) {\r\n                case Constants.TEXTURETYPE_FLOAT:\r\n                    return this._gl.FLOAT;\r\n                case Constants.TEXTURETYPE_HALF_FLOAT:\r\n                    return this._gl.HALF_FLOAT_OES;\r\n                case Constants.TEXTURETYPE_UNSIGNED_BYTE:\r\n                    return this._gl.UNSIGNED_BYTE;\r\n                case Constants.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:\r\n                    return this._gl.UNSIGNED_SHORT_4_4_4_4;\r\n                case Constants.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:\r\n                    return this._gl.UNSIGNED_SHORT_5_5_5_1;\r\n                case Constants.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:\r\n                    return this._gl.UNSIGNED_SHORT_5_6_5;\r\n            }\r\n            return this._gl.UNSIGNED_BYTE;\r\n        }\r\n\r\n        switch (type) {\r\n            case Constants.TEXTURETYPE_BYTE:\r\n                return this._gl.BYTE;\r\n            case Constants.TEXTURETYPE_UNSIGNED_BYTE:\r\n                return this._gl.UNSIGNED_BYTE;\r\n            case Constants.TEXTURETYPE_SHORT:\r\n                return this._gl.SHORT;\r\n            case Constants.TEXTURETYPE_UNSIGNED_SHORT:\r\n                return this._gl.UNSIGNED_SHORT;\r\n            case Constants.TEXTURETYPE_INT:\r\n                return this._gl.INT;\r\n            case Constants.TEXTURETYPE_UNSIGNED_INTEGER: // Refers to UNSIGNED_INT\r\n                return this._gl.UNSIGNED_INT;\r\n            case Constants.TEXTURETYPE_FLOAT:\r\n                return this._gl.FLOAT;\r\n            case Constants.TEXTURETYPE_HALF_FLOAT:\r\n                return this._gl.HALF_FLOAT;\r\n            case Constants.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:\r\n                return this._gl.UNSIGNED_SHORT_4_4_4_4;\r\n            case Constants.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:\r\n                return this._gl.UNSIGNED_SHORT_5_5_5_1;\r\n            case Constants.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:\r\n                return this._gl.UNSIGNED_SHORT_5_6_5;\r\n            case Constants.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV:\r\n                return this._gl.UNSIGNED_INT_2_10_10_10_REV;\r\n            case Constants.TEXTURETYPE_UNSIGNED_INT_24_8:\r\n                return this._gl.UNSIGNED_INT_24_8;\r\n            case Constants.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV:\r\n                return this._gl.UNSIGNED_INT_10F_11F_11F_REV;\r\n            case Constants.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV:\r\n                return this._gl.UNSIGNED_INT_5_9_9_9_REV;\r\n            case Constants.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV:\r\n                return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV;\r\n        }\r\n\r\n        return this._gl.UNSIGNED_BYTE;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _getInternalFormat(format: number, useSRGBBuffer = false): number {\r\n        let internalFormat: GLenum = useSRGBBuffer ? this._glSRGBExtensionValues.SRGB8_ALPHA8 : this._gl.RGBA;\r\n\r\n        switch (format) {\r\n            case Constants.TEXTUREFORMAT_ALPHA:\r\n                internalFormat = this._gl.ALPHA;\r\n                break;\r\n            case Constants.TEXTUREFORMAT_LUMINANCE:\r\n                internalFormat = this._gl.LUMINANCE;\r\n                break;\r\n            case Constants.TEXTUREFORMAT_LUMINANCE_ALPHA:\r\n                internalFormat = this._gl.LUMINANCE_ALPHA;\r\n                break;\r\n            case Constants.TEXTUREFORMAT_RED:\r\n            case Constants.TEXTUREFORMAT_R16_UNORM:\r\n            case Constants.TEXTUREFORMAT_R16_SNORM:\r\n                internalFormat = this._gl.RED;\r\n                break;\r\n            case Constants.TEXTUREFORMAT_RG:\r\n            case Constants.TEXTUREFORMAT_RG16_UNORM:\r\n            case Constants.TEXTUREFORMAT_RG16_SNORM:\r\n                internalFormat = this._gl.RG;\r\n                break;\r\n            case Constants.TEXTUREFORMAT_RGB:\r\n            case Constants.TEXTUREFORMAT_RGB16_UNORM:\r\n            case Constants.TEXTUREFORMAT_RGB16_SNORM:\r\n                internalFormat = useSRGBBuffer ? this._glSRGBExtensionValues.SRGB : this._gl.RGB;\r\n                break;\r\n            case Constants.TEXTUREFORMAT_RGBA:\r\n            case Constants.TEXTUREFORMAT_RGBA16_UNORM:\r\n            case Constants.TEXTUREFORMAT_RGBA16_SNORM:\r\n                internalFormat = useSRGBBuffer ? this._glSRGBExtensionValues.SRGB8_ALPHA8 : this._gl.RGBA;\r\n                break;\r\n        }\r\n\r\n        if (this._webGLVersion > 1) {\r\n            switch (format) {\r\n                case Constants.TEXTUREFORMAT_RED_INTEGER:\r\n                    internalFormat = this._gl.RED_INTEGER;\r\n                    break;\r\n                case Constants.TEXTUREFORMAT_RG_INTEGER:\r\n                    internalFormat = this._gl.RG_INTEGER;\r\n                    break;\r\n                case Constants.TEXTUREFORMAT_RGB_INTEGER:\r\n                    internalFormat = this._gl.RGB_INTEGER;\r\n                    break;\r\n                case Constants.TEXTUREFORMAT_RGBA_INTEGER:\r\n                    internalFormat = this._gl.RGBA_INTEGER;\r\n                    break;\r\n            }\r\n        }\r\n\r\n        return internalFormat;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _getRGBABufferInternalSizedFormat(type: number, format?: number, useSRGBBuffer = false): number {\r\n        if (this._webGLVersion === 1) {\r\n            if (format !== undefined) {\r\n                switch (format) {\r\n                    case Constants.TEXTUREFORMAT_ALPHA:\r\n                        return this._gl.ALPHA;\r\n                    case Constants.TEXTUREFORMAT_LUMINANCE:\r\n                        return this._gl.LUMINANCE;\r\n                    case Constants.TEXTUREFORMAT_LUMINANCE_ALPHA:\r\n                        return this._gl.LUMINANCE_ALPHA;\r\n                    case Constants.TEXTUREFORMAT_RGB:\r\n                        return useSRGBBuffer ? this._glSRGBExtensionValues.SRGB : this._gl.RGB;\r\n                }\r\n            }\r\n            return this._gl.RGBA;\r\n        }\r\n\r\n        switch (type) {\r\n            case Constants.TEXTURETYPE_BYTE:\r\n                switch (format) {\r\n                    case Constants.TEXTUREFORMAT_RED:\r\n                        return this._gl.R8_SNORM;\r\n                    case Constants.TEXTUREFORMAT_RG:\r\n                        return this._gl.RG8_SNORM;\r\n                    case Constants.TEXTUREFORMAT_RGB:\r\n                        return this._gl.RGB8_SNORM;\r\n                    case Constants.TEXTUREFORMAT_RED_INTEGER:\r\n                        return this._gl.R8I;\r\n                    case Constants.TEXTUREFORMAT_RG_INTEGER:\r\n                        return this._gl.RG8I;\r\n                    case Constants.TEXTUREFORMAT_RGB_INTEGER:\r\n                        return this._gl.RGB8I;\r\n                    case Constants.TEXTUREFORMAT_RGBA_INTEGER:\r\n                        return this._gl.RGBA8I;\r\n                    default:\r\n                        return this._gl.RGBA8_SNORM;\r\n                }\r\n            case Constants.TEXTURETYPE_UNSIGNED_BYTE:\r\n                switch (format) {\r\n                    case Constants.TEXTUREFORMAT_RED:\r\n                        return this._gl.R8;\r\n                    case Constants.TEXTUREFORMAT_RG:\r\n                        return this._gl.RG8;\r\n                    case Constants.TEXTUREFORMAT_RGB:\r\n                        return useSRGBBuffer ? this._glSRGBExtensionValues.SRGB8 : this._gl.RGB8; // By default. Other possibilities are RGB565, SRGB8.\r\n                    case Constants.TEXTUREFORMAT_RGBA:\r\n                        return useSRGBBuffer ? this._glSRGBExtensionValues.SRGB8_ALPHA8 : this._gl.RGBA8; // By default. Other possibilities are RGB5_A1, RGBA4, SRGB8_ALPHA8.\r\n                    case Constants.TEXTUREFORMAT_RED_INTEGER:\r\n                        return this._gl.R8UI;\r\n                    case Constants.TEXTUREFORMAT_RG_INTEGER:\r\n                        return this._gl.RG8UI;\r\n                    case Constants.TEXTUREFORMAT_RGB_INTEGER:\r\n                        return this._gl.RGB8UI;\r\n                    case Constants.TEXTUREFORMAT_RGBA_INTEGER:\r\n                        return this._gl.RGBA8UI;\r\n                    case Constants.TEXTUREFORMAT_ALPHA:\r\n                        return this._gl.ALPHA;\r\n                    case Constants.TEXTUREFORMAT_LUMINANCE:\r\n                        return this._gl.LUMINANCE;\r\n                    case Constants.TEXTUREFORMAT_LUMINANCE_ALPHA:\r\n                        return this._gl.LUMINANCE_ALPHA;\r\n                    default:\r\n                        return this._gl.RGBA8;\r\n                }\r\n            case Constants.TEXTURETYPE_SHORT:\r\n                switch (format) {\r\n                    case Constants.TEXTUREFORMAT_RED_INTEGER:\r\n                        return this._gl.R16I;\r\n                    case Constants.TEXTUREFORMAT_R16_SNORM:\r\n                        return this._gl.R16_SNORM_EXT;\r\n                    case Constants.TEXTUREFORMAT_RG16_SNORM:\r\n                        return this._gl.RG16_SNORM_EXT;\r\n                    case Constants.TEXTUREFORMAT_RGB16_SNORM:\r\n                        return this._gl.RGB16_SNORM_EXT;\r\n                    case Constants.TEXTUREFORMAT_RGBA16_SNORM:\r\n                        return this._gl.RGBA16_SNORM_EXT;\r\n                    case Constants.TEXTUREFORMAT_RG_INTEGER:\r\n                        return this._gl.RG16I;\r\n                    case Constants.TEXTUREFORMAT_RGB_INTEGER:\r\n                        return this._gl.RGB16I;\r\n                    case Constants.TEXTUREFORMAT_RGBA_INTEGER:\r\n                        return this._gl.RGBA16I;\r\n                    default:\r\n                        return this._gl.RGBA16I;\r\n                }\r\n            case Constants.TEXTURETYPE_UNSIGNED_SHORT:\r\n                switch (format) {\r\n                    case Constants.TEXTUREFORMAT_RED_INTEGER:\r\n                        return this._gl.R16UI;\r\n                    case Constants.TEXTUREFORMAT_R16_UNORM:\r\n                        return this._gl.R16_EXT;\r\n                    case Constants.TEXTUREFORMAT_RG16_UNORM:\r\n                        return this._gl.RG16_EXT;\r\n                    case Constants.TEXTUREFORMAT_RGB16_UNORM:\r\n                        return this._gl.RGB16_EXT;\r\n                    case Constants.TEXTUREFORMAT_RGBA16_UNORM:\r\n                        return this._gl.RGBA16_EXT;\r\n                    case Constants.TEXTUREFORMAT_RG_INTEGER:\r\n                        return this._gl.RG16UI;\r\n                    case Constants.TEXTUREFORMAT_RGB_INTEGER:\r\n                        return this._gl.RGB16UI;\r\n                    case Constants.TEXTUREFORMAT_RGBA_INTEGER:\r\n                        return this._gl.RGBA16UI;\r\n                    default:\r\n                        return this._gl.RGBA16UI;\r\n                }\r\n            case Constants.TEXTURETYPE_INT:\r\n                switch (format) {\r\n                    case Constants.TEXTUREFORMAT_RED_INTEGER:\r\n                        return this._gl.R32I;\r\n                    case Constants.TEXTUREFORMAT_RG_INTEGER:\r\n                        return this._gl.RG32I;\r\n                    case Constants.TEXTUREFORMAT_RGB_INTEGER:\r\n                        return this._gl.RGB32I;\r\n                    case Constants.TEXTUREFORMAT_RGBA_INTEGER:\r\n                        return this._gl.RGBA32I;\r\n                    default:\r\n                        return this._gl.RGBA32I;\r\n                }\r\n            case Constants.TEXTURETYPE_UNSIGNED_INTEGER: // Refers to UNSIGNED_INT\r\n                switch (format) {\r\n                    case Constants.TEXTUREFORMAT_RED_INTEGER:\r\n                        return this._gl.R32UI;\r\n                    case Constants.TEXTUREFORMAT_RG_INTEGER:\r\n                        return this._gl.RG32UI;\r\n                    case Constants.TEXTUREFORMAT_RGB_INTEGER:\r\n                        return this._gl.RGB32UI;\r\n                    case Constants.TEXTUREFORMAT_RGBA_INTEGER:\r\n                        return this._gl.RGBA32UI;\r\n                    default:\r\n                        return this._gl.RGBA32UI;\r\n                }\r\n            case Constants.TEXTURETYPE_FLOAT:\r\n                switch (format) {\r\n                    case Constants.TEXTUREFORMAT_RED:\r\n                        return this._gl.R32F; // By default. Other possibility is R16F.\r\n                    case Constants.TEXTUREFORMAT_RG:\r\n                        return this._gl.RG32F; // By default. Other possibility is RG16F.\r\n                    case Constants.TEXTUREFORMAT_RGB:\r\n                        return this._gl.RGB32F; // By default. Other possibilities are RGB16F, R11F_G11F_B10F, RGB9_E5.\r\n                    case Constants.TEXTUREFORMAT_RGBA:\r\n                        return this._gl.RGBA32F; // By default. Other possibility is RGBA16F.\r\n                    default:\r\n                        return this._gl.RGBA32F;\r\n                }\r\n            case Constants.TEXTURETYPE_HALF_FLOAT:\r\n                switch (format) {\r\n                    case Constants.TEXTUREFORMAT_RED:\r\n                        return this._gl.R16F;\r\n                    case Constants.TEXTUREFORMAT_RG:\r\n                        return this._gl.RG16F;\r\n                    case Constants.TEXTUREFORMAT_RGB:\r\n                        return this._gl.RGB16F; // By default. Other possibilities are R11F_G11F_B10F, RGB9_E5.\r\n                    case Constants.TEXTUREFORMAT_RGBA:\r\n                        return this._gl.RGBA16F;\r\n                    default:\r\n                        return this._gl.RGBA16F;\r\n                }\r\n            case Constants.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:\r\n                return this._gl.RGB565;\r\n            case Constants.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV:\r\n                return this._gl.R11F_G11F_B10F;\r\n            case Constants.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV:\r\n                return this._gl.RGB9_E5;\r\n            case Constants.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:\r\n                return this._gl.RGBA4;\r\n            case Constants.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:\r\n                return this._gl.RGB5_A1;\r\n            case Constants.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV:\r\n                switch (format) {\r\n                    case Constants.TEXTUREFORMAT_RGBA:\r\n                        return this._gl.RGB10_A2; // By default. Other possibility is RGB5_A1.\r\n                    case Constants.TEXTUREFORMAT_RGBA_INTEGER:\r\n                        return this._gl.RGB10_A2UI;\r\n                    default:\r\n                        return this._gl.RGB10_A2;\r\n                }\r\n        }\r\n\r\n        return useSRGBBuffer ? this._glSRGBExtensionValues.SRGB8_ALPHA8 : this._gl.RGBA8;\r\n    }\r\n\r\n    /**\r\n     * Reads pixels from the current frame buffer. Please note that this function can be slow\r\n     * @param x defines the x coordinate of the rectangle where pixels must be read\r\n     * @param y defines the y coordinate of the rectangle where pixels must be read\r\n     * @param width defines the width of the rectangle where pixels must be read\r\n     * @param height defines the height of the rectangle where pixels must be read\r\n     * @param hasAlpha defines whether the output should have alpha or not (defaults to true)\r\n     * @param flushRenderer true to flush the renderer from the pending commands before reading the pixels\r\n     * @param data defines the data to fill with the read pixels (if not provided, a new one will be created)\r\n     * @returns a ArrayBufferView promise (Uint8Array) containing RGBA colors\r\n     */\r\n    public readPixels(x: number, y: number, width: number, height: number, hasAlpha = true, flushRenderer = true, data: Nullable<Uint8Array> = null): Promise<ArrayBufferView> {\r\n        const numChannels = hasAlpha ? 4 : 3;\r\n        const format = hasAlpha ? this._gl.RGBA : this._gl.RGB;\r\n\r\n        const dataLength = width * height * numChannels;\r\n        if (!data) {\r\n            data = new Uint8Array(dataLength);\r\n        } else if (data.length < dataLength) {\r\n            Logger.Error(`Data buffer is too small to store the read pixels (${data.length} should be more than ${dataLength})`);\r\n            return Promise.resolve(data);\r\n        }\r\n\r\n        if (flushRenderer) {\r\n            this.flushFramebuffer();\r\n        }\r\n        this._gl.readPixels(x, y, width, height, format, this._gl.UNSIGNED_BYTE, data);\r\n        return Promise.resolve(data);\r\n    }\r\n\r\n    // Statics\r\n\r\n    private static _IsSupported: Nullable<boolean> = null;\r\n    private static _HasMajorPerformanceCaveat: Nullable<boolean> = null;\r\n\r\n    /**\r\n     * Gets a Promise<boolean> indicating if the engine can be instantiated (ie. if a webGL context can be found)\r\n     */\r\n    public static get IsSupportedAsync(): Promise<boolean> {\r\n        return Promise.resolve(this.isSupported());\r\n    }\r\n\r\n    /**\r\n     * Gets a boolean indicating if the engine can be instantiated (ie. if a webGL context can be found)\r\n     */\r\n    public static get IsSupported(): boolean {\r\n        return this.isSupported(); // Backward compat\r\n    }\r\n\r\n    /**\r\n     * Gets a boolean indicating if the engine can be instantiated (ie. if a webGL context can be found)\r\n     * @returns true if the engine can be created\r\n     * @ignorenaming\r\n     */\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    public static isSupported(): boolean {\r\n        if (this._HasMajorPerformanceCaveat !== null) {\r\n            return !this._HasMajorPerformanceCaveat; // We know it is performant so WebGL is supported\r\n        }\r\n\r\n        if (this._IsSupported === null) {\r\n            try {\r\n                const tempcanvas = AbstractEngine._CreateCanvas(1, 1);\r\n                const gl = tempcanvas.getContext(\"webgl\") || (tempcanvas as any).getContext(\"experimental-webgl\");\r\n\r\n                this._IsSupported = gl != null && !!window.WebGLRenderingContext;\r\n            } catch (e) {\r\n                this._IsSupported = false;\r\n            }\r\n        }\r\n\r\n        return this._IsSupported;\r\n    }\r\n\r\n    /**\r\n     * Gets a boolean indicating if the engine can be instantiated on a performant device (ie. if a webGL context can be found and it does not use a slow implementation)\r\n     */\r\n    public static get HasMajorPerformanceCaveat(): boolean {\r\n        if (this._HasMajorPerformanceCaveat === null) {\r\n            try {\r\n                const tempcanvas = AbstractEngine._CreateCanvas(1, 1);\r\n                const gl =\r\n                    tempcanvas.getContext(\"webgl\", { failIfMajorPerformanceCaveat: true }) ||\r\n                    (tempcanvas as any).getContext(\"experimental-webgl\", { failIfMajorPerformanceCaveat: true });\r\n\r\n                this._HasMajorPerformanceCaveat = !gl;\r\n            } catch (e) {\r\n                this._HasMajorPerformanceCaveat = false;\r\n            }\r\n        }\r\n\r\n        return this._HasMajorPerformanceCaveat;\r\n    }\r\n}\r\n\r\ninterface TexImageParameters {\r\n    internalFormat: number;\r\n    format: number;\r\n    type: number;\r\n}\r\n"],
  "mappings": "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",
  "names": []
}
